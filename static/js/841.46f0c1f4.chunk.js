(()=>{"use strict";function t(t,n){let e=-1/0,r=1/0;if("min"===n){for(let n=0;n<t.length;n++)t[n]<r&&(r=t[n]);return r}if("max"===n){for(let n=0;n<t.length;n++)t[n]>e&&(e=t[n]);return e}}const n=[[7.8,15.7],[15.7,23.5],[23.5,31.3],[31.3,39.2]],e=(t,n,e)=>Math.max(n,Math.min(e,t)),r=t=>0===t?1:Math.sin(Math.PI*t)/(Math.PI*t);function a(t,n){n=e(n,0,1);const a=t-1,o=function(t){const n=new Array(t);for(let e=0;e<t;e++)n[e]=.54-.46*Math.cos(2*Math.PI*e/(t-1));return n}(t),l=new Array(t);for(let e=0;e<t;e++){const t=e-a/2;l[e]=2*n*r(2*n*t)*o[e]}return l}function o(t,n,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;const l=e(n/(o/2),0,1),s=e(r/(o/2),0,1),h=Math.min(l,s),i=a(t,Math.max(l,s)),f=h>0?a(t,h):new Array(t),c=new Array(t);for(let e=0;e<t;e++)c[e]=i[e]-f[e];return c}function l(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const r=n.map(t=>{let[n,r]=t;return{band:[n,r],h:o(200,n,r,e)}}).map(n=>{let{h:e}=n;const r=function(t,n){const e=t.length,r=n.length,a=new Array(e),o=Math.floor(r/2);for(let l=0;l<e;l++){let s=0;for(let a=0;a<r;a++){const r=l+a-o;r>=0&&r<e&&(s+=t[r]*n[a])}a[l]=s}return a}(t,e);return r}),a=r.map(t=>function(t,n){const e=new Array(Math.ceil(t.length/n));let r=0;for(let a=0;a<t.length;a+=n)e[r++]=t[a];return e}(t,32));return{filtered:r,decimated:a}}const s=n=>{const e=n.map(t=>t[0]),r=n.map(t=>t[1]),a=t=>e.map((n,e)=>[n,t[e]]),[o,s,h,i]=l(r).filtered,f=function(n,e){const r=400,a=32,o=.08,l=1e-12,s=(t,n,e)=>Math.max(n,Math.min(e,t)),h=(t,n)=>{const e=[];for(let r=0;r<t.length;r+=n)e.push(t[r]);return e},i=(t,n)=>(1-.8)*n+.8*t,f=t=>{if(!t.length)return 0;const n=[...t].sort((t,n)=>t-n),e=Math.floor(n.length/2);return n.length%2?n[e]:.5*(n[e-1]+n[e])},c=t=>{const n=f(t);return f(t.map(t=>Math.abs(t-n)))||1},u=(t,n,e,r,a)=>Math.abs(n[t])+Math.abs(e[t])+Math.abs(r[t])+Math.abs(a[t]);function g(t,n,e){let r=-1/0,a=-1;const o=s(n,1,t.length-2),l=s(e,1,t.length-2);for(let s=o;s<=l;s++)t[s]>0&&t[s]>=t[s-1]&&t[s]>t[s+1]&&t[s]>r&&(r=t[s],a=s);return a}function m(t,n,e){const r=Math.max(1,Math.round(.012*e));let a=0,o=0;for(let l=1;l<=r;l++){const e=n-l,r=n+l;e>=0&&r<t.length&&(a+=Math.abs(t[r]-t[e]),o++)}return o?a/o:0}const[M,p,d,y]=e||[];if(!M||!p||!d||!y)return[];const b=Math.min(n.length,M.length,p.length,d.length,y.length);let x=0,A=0;for(let t=0;t<b;t++){const e=n[t];Number.isNaN(e)||(x+=e,A++)}const w=A?x/A:0,F=Array.from({length:b},(t,e)=>Number.isNaN(n[e])?w:n[e]),v=c(M),k=c(p),B=c(d),P=c(y),S=M.map(t=>t/(v+1e-12)),I=p.map(t=>t/(k+1e-12)),_=d.map(t=>t/(B+1e-12)),R=y.map(t=>t/(P+1e-12)),C=h(S.slice(0,b),a),N=h(I.slice(0,b),a),D=h(_.slice(0,b),a),T=h(R.slice(0,b),a),q=Math.min(C.length,N.length,D.length,T.length);C.length=q,N.length=q,D.length=q,T.length=q;const z=new Array(q),E=new Array(q),W=new Array(q);for(let t=0;t<q;t++){const n=Math.abs(C[t]),e=Math.abs(N[t]),r=Math.abs(D[t]),a=Math.abs(T[t]);z[t]=n+e+r,E[t]=n+e+r+a,W[t]=e+r+a}const H=t=>{const n=new Array(t.length+1);n[0]=t[0]/2;for(let e=0;e<t.length-1;e++)n[e+1]=(t[e]+t[e+1])/2;return n[n.length-1]=t[t.length-1]/2,n},L=H(z),K=H(E),V=H(W),O=(t=>{const n=[];for(let e=1;e<t.length-1;e++)t[e]>=t[e-1]&&t[e]>t[e+1]&&n.push(e);return n})(L);if(!O.length)return[];const Q=Math.max(1,Math.round(16)),U=[];for(const t of O){const n=s(t*a,0,b-1);-1!==g(F,n-64,n+64)&&U.push(t)}if(!U.length)return[];const j=U.reduce((t,n)=>t+K[n],0)/U.length;let G=.9*j,$=1.1*j;function J(t,n,e,r,a){let o=e,s=r,h=r,i=e;const f=[],c=[],u=[],g=[];for(let m=0;m<n.length;m++){const e=n[m],r=Math.min(1,Math.max(0,(t[e]-o)/Math.max(l,s-o)));u.push(r),r>a?(f.push(e),g.push(1),h+=t[e],s=h/(f.length+1)):(c.push(e),g.push(0),i+=t[e],o=i/(c.length+1))}return{Signal:f,Noise:c,VDs:u,Class:g}}const X=J(K,U,G,$,o),Y=J(K,U,G,$,.7),Z=U.map((t,n)=>{const e=X.Class[n],r=Y.Class[n];return 1===e&&1===r?1:0===e&&0===r?0:1===e&&0===r?(X.VDs[n]-o)/.92>(.7-Y.VDs[n])/.7?1:0:1}),tt=[],nt=[];for(let t=0;t<U.length;t++)(Z[t]?tt:nt).push(U[t]);let et=tt.length?tt.reduce((t,n)=>t+V[n],0)/tt.length:U.reduce((t,n)=>t+V[n],0)/U.length,rt=nt.length?nt.reduce((t,n)=>t+V[n],0)/nt.length:U.reduce((t,n)=>t+V[n],0)/U.length*.5;const at=[],ot=[];for(let t=0;t<U.length;t++){const n=U[t],e=Math.min(1,Math.max(0,(V[n]-rt)/Math.max(l,et-rt)));1===Z[t]||e>.3?(at.push(n),et=i(et,V[n])):(ot.push(n),rt=i(rt,V[n]))}const lt=at.slice(),st=[];for(let t=0;t<at.length-1;t++)st.push(at[t+1]-at[t]);const ht=((t,n)=>{const e=new Array(t.length).fill(0);let r=0;for(let a=0;a<t.length;a++)r+=t[a],a>=n&&(r-=t[a-n]),e[a]=r/Math.min(a+1,n);return e})(st,100);for(let t=0;t<st.length;t++)if(st[t]>1.5*(ht[t]||st[t])){const n=at[t],e=at[t+1];for(const t of ot)t>n&&t<e&&Math.min(1,Math.max(0,(V[t]-rt)/Math.max(l,et-rt)))>.2&&lt.push(t)}lt.sort((t,n)=>t-n);const it=[];for(const t of lt){const n=s(t*a,0,b-1),e=s(n-64,0,b-1),r=s(n+64,0,b-1);let o=e,l=u(e,S,I,_,R);for(let t=e;t<=r;t++){const n=u(t,S,I,_,R);n>l&&(l=n,o=t)}const h=g(F,o-Q,o+Q);-1!==h&&it.push(h)}let ft=[...new Set(it)].sort((t,n)=>t-n);const ct=Math.round(100);if(ft.length>1){const t=new Array(ft.length).fill(!0);for(let n=0;n<ft.length-1;n++){if(!t[n])continue;const e=n+1;ft[e]-ft[n]<ct&&(F[ft[n]]<F[ft[e]]?t[n]=!1:t[e]=!1)}ft=ft.filter((n,e)=>t[e]).sort((t,n)=>t-n)}const ut=t=>Math.min(1,Math.max(0,(V[t]-rt)/Math.max(l,et-rt)));let gt=function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!n.length)return.2;const r=t(n,"min"),a=t(n,"max");if(a-r<1e-12)return r;const o=new Array(e).fill(0);for(const t of n)o[Math.max(0,Math.min(e-1,Math.floor((t-r)/(a-r+1e-12)*e)))]++;const l=n.length,s=new Array(e).fill(0),h=new Array(e).fill(0);s[0]=o[0],h[0]=0*o[0];for(let t=1;t<e;t++)s[t]=s[t-1]+o[t],h[t]=h[t-1]+t*o[t];const i=h[e-1];let f=0,c=-1;for(let t=0;t<e-1;t++){const n=s[t],e=l-n;if(0===n||0===e)continue;const r=h[t]/n,a=(i-h[t])/e,o=n*e*(r-a)*(r-a);o>c&&(c=o,f=t)}return r+(f+.5)*(a-r)/e}(U.map(ut));gt=Math.max(.1,Math.min(.15,.8*gt));const mt=ft.map(t=>F[t]),Mt=f(mt)||1,pt=ft.map(t=>m(F,t,r)),dt=.4*(f(pt)||1);function yt(t){if(!ft.length)return Mt;let n=0,e=ft.length-1,r=ft.length;for(;n<=e;){const a=n+e>>1;ft[a]>=t?(r=a,e=a-1):n=a+1}const a=Math.max(0,r-3),o=Math.min(ft.length-1,r+3),l=[];for(let s=a;s<=o;s++)l.push(F[ft[s]]);return f(l)||Mt}const bt=[];for(const t of ot){const n=s(t*a,0,b-1),e=s(n-64,0,b-1),o=s(n+64,0,b-1);let l=e,h=u(e,S,I,_,R);for(let t=e;t<=o;t++){const n=u(t,S,I,_,R);n>h&&(h=n,l=t)}const i=g(F,l-Q,l+Q);if(-1===i)continue;const f=ut(t)>=gt,c=yt(i),M=F[i]>=.03*c,p=m(F,i,r)>=dt;if(!(f&&M&&p))continue;let d=1/0,y=0,x=ft.length-1;for(;y<=x;){const t=y+x>>1,n=i-ft[t];d=Math.min(d,Math.abs(n)),n<0?x=t-1:y=t+1}d>=Math.round(.9*ct)&&bt.push(i)}if(bt.length&&(ft=[...new Set(ft.concat(bt))].sort((t,n)=>t-n),ft.length>1)){const t=new Array(ft.length).fill(!0);for(let n=0;n<ft.length-1;n++){if(!t[n])continue;const e=n+1;ft[e]-ft[n]<ct&&(F[ft[n]]<F[ft[e]]?t[n]=!1:t[e]=!1)}ft=ft.filter((n,e)=>t[e])}return ft}(r,l(r).filtered);return{filteredSignal1:a(o),filteredSignal2:a(s),filteredSignal3:a(h),filteredSignal4:a(i),peaks:{series:e.map((t,n)=>[t,f.includes(n)?50:0]),data:f}}};function h(t,n){const e=Math.min(3*(n.length-1),t.length-1),r=function(t,n){const e=t.length,r=new Float64Array(e+2*n);for(let l=0;l<n;l++){var a;r[n-1-l]=null!==(a=t[l+1])&&void 0!==a?a:t[0]}for(let l=0;l<e;l++)r[n+l]=t[l];for(let l=0;l<n;l++){var o;r[n+e+l]=null!==(o=t[e-2-l])&&void 0!==o?o:t[e-1]}return r}(t,e),a=i(r,n);a.reverse();const o=i(a,n);return o.reverse(),o.subarray(e,e+t.length)}function i(t,n){const e=t.length,r=n.length,a=new Float64Array(e);for(let o=0;o<e;o++){let e=0;for(let a=0;a<r;a++){const r=o-a;r>=0&&(e+=n[a]*t[r])}a[o]=e}return a}function f(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{fs:e=400,band:r=[5,20],firTaps:a=81,mwiSec:o=.12,refractorySec:l=.2,refineSec:s=.08}=n,i=t instanceof Float64Array?t:Float64Array.from(t),f=i.length;if(0===f)return{indices:[],stages:{}};const c=new Float64Array(f),u=new Float64Array(f),g=new Float64Array(f),m=new Float64Array(f),M=new Float64Array(f).fill(NaN),p=function(t,n,e,r){const a=r,o=(a-1)/2,l=new Float64Array(a);for(let h=0;h<a;h++){const r=h-o,s=.54-.46*Math.cos(2*Math.PI*h/(a-1)),i=n=>0===r?2*n/t:Math.sin(2*Math.PI*n*r/t)/(Math.PI*r);l[h]=(i(e)-i(n))*s}const s=l.reduce((t,n)=>t+n,0);for(let h=0;h<a;h++)l[h]/=s||1;return l}(e,r[0],r[1],a),d=h(i,p);c&&c.set(d);const y=Math.max(1,Math.round(o*e)),b=new Float64Array(5);let x=0,A=0;const w=new Float64Array(y);let F=0,v=0,k=0;const B=Math.max(y+1,Math.round(3*e)),P=new Float64Array(B);let S=0,I=0,_=0,R=!1,C=0,N=0;const D=Math.round(2*e),T=[];let q=-1/0;const z=[];let E=0,W=0,H=0,L=!1;for(let h=0;h<f;h++){b[x]=d[h],x=(x+1)%5,A++;let t=0;if(A>=5){const n=(x+3)%5,e=(x+1)%5,r=(x+0)%5;t=(2*b[(x+4)%5]+b[n]-b[e]-2*b[r])/8}u&&(u[h]=t);const n=t*t;g&&(g[h]=n),k<y?(v+=n,w[F]=n,F=(F+1)%y,k++):(v+=n-w[F],w[F]=n,F=(F+1)%y);const r=v/Math.min(y,k||1);if(m&&(m[h]=r),k<y)continue;const a=v/y;if(P[h%B]=a,L)if(E=W,W=H,H=a,R){if(M&&(M[h]=_),W>E&&W>=H){const t=h-1,n=z.length?z.reduce((t,n)=>t+n,0)/z.length:Math.round(.8*e),r=Math.round(1.6*n);if(t-q>r){const n=Math.max(q+Math.max(1,Math.round(.2*e)),t-r),a=t-Math.max(1,Math.round(.08*e));let o=-1/0,l=-1;for(let t=n;t<a;t++){const n=P[t%B];n>o&&(o=n,l=t)}l>=0&&o>=.5*_&&K(l,o)}W>=_&&t-q>=Math.max(1,Math.round(.2*e))?K(t,W):(I=.125*W+.875*I,_=I+.2*(S-I))}}else C=Math.max(C,W),++N>=D&&(S=.25*C,I=.125*C,_=I+.2*(S-I),R=!0),M&&(M[h]=R?_:h>0?M[h-1]:0);else E=W=H=a,L=!0}return{indices:T,bandpass:c,differentiated:u,squared:g,mwi:m};function K(t,r){var a;const o=Math.round((y-1)/2+2),l=Math.max(1,Math.round((null!==(a=n.refineSec)&&void 0!==a?a:.08)*e));let s=t-o;s<0&&(s=0),s>=f&&(s=f-1);const h=Math.max(0,s-l),i=Math.min(f-1,s+l);let c=-1,u=-1/0;for(let n=h;n<=i;n++){const t=d[n];t>0&&t>u&&(u=t,c=n)}if(c<0)return I=.125*r+.875*I,void(_=I+.2*(S-I));if(c>0&&c<f-1){const t=d[c-1],n=d[c],e=d[c+1],r=t-2*n+e;if(0!==r){const a=.5*(t-e)/r,o=Math.round(c+Math.max(-1,Math.min(1,a)));o>=h&&o<=i&&d[o]>=n&&d[o]>0&&(c=o)}}T.push(c),q>-1/0&&(z.push(c-q),z.length>8&&z.shift()),q=c,S=.125*r+.875*S,_=I+.2*(S-I)}}function c(n){const e=Array.from(n).map(Number),r=e.length,a=t=>t.reduce((t,n)=>t+n,0)/t.length,o=t=>{const n=a(t);return t.reduce((t,e)=>t+(e-n)**2,0)/t.length},l=t=>{const n=t.sort((t,n)=>t-n),e=n.length;if(!e)return 0;const r=e>>1;return e%2?n[r]:.5*(n[r-1]+n[r])},s=(t,n)=>{if(1===n)return 0;const e=2*n-2;let r=(t%e+e)%e;return r>=n?e-r:r};function h(t,n){if(n<=1)return t.slice();const e=new Array(t.length),r=Math.floor((n-1)/2);for(let a=0;a<t.length;a++){const o=new Array(n),h=a-r;for(let e=0;e<n;e++)o[e]=t[s(h+e,t.length)];e[a]=l(o)}return e}function i(t,n,e){const r=t.length;if(!r)return e.map(()=>0);if(1===r)return e.map(()=>n[0]);if(2===r){const[r,a]=t,[o,l]=n,s=(l-o)/(a-r||1e-12);return e.map(t=>o+s*(t-r))}const a=Array.from({length:r-1},(n,e)=>t[e+1]-t[e]),o=new Array(r).fill(0);for(let u=1;u<r-1;u++)o[u]=3/a[u]*(n[u+1]-n[u])-3/a[u-1]*(n[u]-n[u-1]);const l=new Array(r),s=new Array(r),h=new Array(r);l[0]=1,s[0]=h[0]=0;for(let u=1;u<r-1;u++)l[u]=2*(t[u+1]-t[u-1])-a[u-1]*s[u-1],s[u]=a[u]/(l[u]||1e-12),h[u]=(o[u]-a[u-1]*h[u-1])/(l[u]||1e-12);l[r-1]=1,h[r-1]=0;const i=new Array(r-1),f=new Array(r),c=new Array(r-1);f[r-1]=0;for(let u=r-2;u>=0;u--)f[u]=h[u]-s[u]*(f[u+1]||0),i[u]=(n[u+1]-n[u])/(a[u]||1e-12)-a[u]*(f[u+1]+2*f[u])/3,c[u]=(f[u+1]-f[u])/(3*(a[u]||1e-12));return e.map(e=>{let a=0;if(e<=t[0])a=0;else if(e>=t[r-1])a=r-2;else for(let n=0;n<r-1;n++)if(e>=t[n]&&e<=t[n+1]){a=n;break}const o=e-t[a];return n[a]+i[a]*o+f[a]*o*o+c[a]*o*o*o})}function f(t){const n=[],e=[],r=t.length;for(let a=1;a<r-1;a++)t[a]>t[a-1]&&t[a]>=t[a+1]&&n.push(a),t[a]<t[a-1]&&t[a]<=t[a+1]&&e.push(a);return r>=2&&(t[0]>t[1]&&n.unshift(0),t[0]<t[1]&&e.unshift(0),t[r-1]>t[r-2]&&n.push(r-1),t[r-1]<t[r-2]&&e.push(r-1)),{maxima:n,minima:e}}function c(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;const r=[],l=t.length;let s=t.slice();const h=.05*Math.max(1e-12,(c=t,Math.sqrt(o(c))));for(var c;r.length<n;){const t=f(s);if(t.maxima.length+t.minima.length<2)break;let n=s.slice(),o=0;for(;o<e;){const t=f(n);if(t.maxima.length+t.minima.length<2)break;const e=t.maxima.length>=2?i(t.maxima,t.maxima.map(t=>n[t]),Array.from({length:l},(t,n)=>n)):Array(l).fill(t.maxima.length?n[t.maxima[0]]:0),r=t.minima.length>=2?i(t.minima,t.minima.map(t=>n[t]),Array.from({length:l},(t,n)=>n)):Array(l).fill(t.minima.length?n[t.minima[0]]:0),s=new Array(l);for(let n=0;n<l;n++)s[n]=.5*(e[n]+r[n]);const c=new Array(l);for(let a=0;a<l;a++)c[a]=n[a]-s[a];if(a(s.map(Math.abs))<h){n=c;break}n=c,o++}r.push(n.slice());for(let e=0;e<l;e++)s[e]-=n[e];const c=f(s);if(c.maxima.length+c.minima.length<2)break}return r.push(s.slice()),r}function u(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const e=new Array(t);for(let r=0;r<t;r+=2){const a=Math.random()||1e-12,o=Math.random(),l=Math.sqrt(-2*Math.log(a)),s=l*Math.cos(2*Math.PI*o),h=l*Math.sin(2*Math.PI*o);e[r]=s*n,r+1<t&&(e[r+1]=h*n)}return e}let g=e.slice();const m=a(g);for(let t=0;t<r;t++)g[t]-=m;const M=t(g.map(t=>Math.abs(t)),"max")||1e-12;for(let t=0;t<r;t++)g[t]/=M;const p=h(g,Math.max(1,Math.round(240))),d=h(g,Math.max(1,Math.round(80))),y=new Array(r);for(let t=0;t<r;t++)y[t]=g[t]-.5*p[t]-.5*d[t];const b=[],x=.2*(Math.max(y.map(Math.abs))||1e-12);for(let t=0;t<r;t++)Math.abs(y[t])>x&&b.push(y[t]);const A=(b.length?l(b):a(y))<0?y.map(t=>-t):y.slice(),w=function(t,n,e,r,a){const o=t.length,l=[];let s=0;for(let i=0;i<e;i++){const e=u(o,n),h=new Array(o);for(let n=0;n<o;n++)h[n]=t[n]+e[n];const i=c(h,r,a);l.push(i),i.length>s&&(s=i.length)}const h=[];for(let i=0;i<s;i++){const t=new Array(o).fill(0);let n=0;for(let r=0;r<e;r++){const e=l[r];if(i<e.length){const r=e[i];for(let n=0;n<o;n++)t[n]+=r[n];n++}}if(n)for(let e=0;e<o;e++)t[e]/=n;h.push(t)}return h}(A,2*Math.sqrt(o(A)),10,10,100),F=Math.min(4,w.length),v=new Array(r).fill(0);for(let t=0;t<F;t++)for(let n=0;n<r;n++)v[n]+=w[t][n];const k=v.map(t=>t>0?t:0),B=k.filter(t=>t>0),P=B.length?a(B):0,S=B.length?Math.sqrt(o(B)):0;const I=function(t,n,e,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;const o=t.length,l=[];for(let i=1;i<o-1;i++)t[i]>0&&t[i]>t[i-1]&&t[i]>=t[i+1]&&t[i]>=n&&l.push({idx:i,val:t[i]});l.sort((t,n)=>n.val-t.val);const s=[];for(const i of l)s.some(t=>Math.abs(t-i.idx)<e)||s.push(i.idx);const h=[];for(const i of s){const n=Math.max(0,i-a),e=Math.min(o-1,i+a);let l=t[i],s=t[i];for(let r=n;r<=i;r++)t[r]<l&&(l=t[r]);for(let r=i;r<=e;r++)t[r]<s&&(s=t[r]);const f=t[i]-Math.max(l,s);f>=(r||0)&&h.push({idx:i,val:t[i],prom:f})}return h.sort((t,n)=>t.idx-n.idx)}(k,P+2*S,Math.round(80),.5*S);return{locs:I.map(t=>t.idx),y_signal:v,y_pos:k}}const u=(t,n)=>{const e=t.map(t=>t[0]),r=t.map(t=>t[1]),a=t=>e.map((n,e)=>[n,t.includes(e)?100:0]);let o;if(1===n){const t=function(t,n){const e=Math.max(1,Math.floor(.1*n)),r=0|t.length;if(r<3)return[];const a=t instanceof Float32Array?t:new Float32Array(t),o=t=>new Float32Array(t);function l(t){let n=0,e=t[0];for(let a=1;a<r;a++){const r=t[a];(e>=0&&r<0||e<0&&r>=0)&&n++,e=r}return n}function s(t){let n=0;for(let e=1;e<r-1;e++){const r=t[e-1],a=t[e],o=t[e+1];(a>r&&a>o||a<r&&a<o)&&n++}return n}function h(t,n,e){if(0===n.length)return void e.fill(t[0]);const a=n[0],o=t[a];for(let r=0;r<a;r++)e[r]=o;for(let r=0;r<n.length-1;r++){const a=n[r],o=n[r+1],l=t[a],s=t[o],h=(s-l)/(o-a);let i=l;e[a]=l;for(let t=a+1;t<o;t++)i+=h,e[t]=i;e[o]=s}const l=n[n.length-1],s=t[l];for(let h=l+1;h<r;h++)e[h]=s}function i(t,n,e,a){const o=[],l=[];for(let s=1;s<r-1;s++){const n=t[s-1],e=t[s],r=t[s+1];e>n&&e>r?o.push(s):e<n&&e<r&&l.push(s)}if(o.length+l.length<2)return!1;t[0]>t[1]?o.unshift(0):t[0]<t[1]&&l.unshift(0),t[r-1]>t[r-2]?o.push(r-1):t[r-1]<t[r-2]&&l.push(r-1),h(t,o,n),h(t,l,e);for(let s=0;s<r;s++)a[s]=.5*(n[s]+e[s]),t[s]=t[s]-a[s];return!0}function f(t,n){let e=0;for(let a=0;a<r;a++){const r=t[a]-n[a];e+=r*r/(t[a]*t[a]+1e-12)}return e}function c(t,n,e,a,h){h.set(t);let c=h,u=o(r),g=!0;for(let r=0;r<8&&(u.set(c),g=i(c,n,e,a),g);r++){const t=f(u,c),n=s(c),e=l(c),r=Math.abs(n-e)<=1;if(t<.2&&r)break}if(!g)return{imf:null,residue:t};const m=o(r);for(let o=0;o<r;o++)m[o]=c[o],t[o]=t[o]-m[o];return{imf:m,residue:t}}const u=o(r),g=o(r),m=o(r),M=o(r);let p=o(r);p.set(a);const d=[];for(let z=0;z<10;z++){const{imf:t,residue:n}=c(p,u,g,m,M);if(p=n,!t)break;if(d.push(t),s(p)<2)break}if(0===d.length)return[];const y=d.length,b=Math.min(1,y-1),x=Math.max(y-1,b+1),A=o(r);let w=0;for(let z=b;z<x;z++){A.set(d[z],0),w=1;break}for(let z=b+1;z<x&&w<5;z++,w++){const t=d[z];for(let n=0;n<r;n++)A[n]+=t[n]}0===w&&A.set(d[0]);const F=[],v=[];for(let z=1;z<r-1;z++){const t=A[z-1],n=A[z],e=A[z+1];n>t&&n>e&&n>0&&(F.push(z),v.push(n))}if(0===F.length)return[];let k=-1/0;for(let z=0;z<v.length;z++)v[z]>k&&(k=v[z]);const B=v.slice().sort((t,n)=>t-n),P=B.length%2?B[B.length-1>>1]:.5*(B[B.length/2-1]+B[B.length/2]),S=Math.max(.3*k,.6*P),I=[],_=[];for(let z=0;z<F.length;z++)v[z]>=S&&(I.push(F[z]),_.push(v[z]));if(0===I.length)return[];const R=[],C=[];let N=I[0],D=_[0];for(let z=1;z<I.length;z++){const t=I[z],n=_[z];t-N<e?n>D&&(N=t,D=n):(R.push(N),C.push(D),N=t,D=n)}R.push(N),C.push(D);const T=[];for(let z=0;z<R.length;z++){const t=R[z];let n=t,e=a[t];const o=Math.max(0,t-3),l=Math.min(r-1,t+3);for(let r=o;r<=l;r++){const t=a[r];t>e&&(e=t,n=r)}e>0&&T.push(n)}T.sort((t,n)=>t-n);const q=[];for(let z=0;z<T.length;z++)0!==z&&T[z]===T[z-1]||q.push(T[z]);return q}(r,400);o={peaks:a(t),data:t}}else if(2===n){const t=f(r);o={peaks:a(t.indices),data:t.indices}}else if(3===n){const t=c(r);o={peaks:a(t.locs),data:t.locs}}return o};function g(t){return t instanceof Float32Array?t:Float32Array.from(t)}function m(t){return t%2===0?t+1:t}function M(t,n,e){const r=2*Math.PI*t/n,a=Math.cos(r),o=Math.sin(r)/(2*e);let l=(1+a)/2,s=-(1+a),h=(1+a)/2,i=1+o,f=-2*a,c=1-o;return l/=i,s/=i,h/=i,f/=i,c/=i,{b0:l,b1:s,b2:h,a1:f,a2:c}}function p(t,n,e){if(2===e)return[M(t,n,1/Math.SQRT2)];return[.5411961,1.30656296].map(e=>M(t,n,e))}function d(t,n){let e=new Float32Array(t.length);t=g(t);for(let r=0;r<n.length;r++){const{b0:a,b1:o,b2:l,a1:s,a2:h}=n[r];let i=0,f=0;for(let n=0;n<t.length;n++){const r=t[n],c=a*r+i;i=o*r-s*c+f,f=l*r-h*c,e[n]=c}r<n.length-1&&(t=e,e=new Float32Array(t.length))}return e}function y(t,n){const e=t.length,r=new Float32Array(e+2*n);for(let a=0;a<n;a++)r[a]=2*t[0]-t[n-a];r.set(t,n);for(let a=0;a<n;a++)r[n+e+a]=2*t[e-1]-t[e-2-a];return r}function b(t,n){const e=t.length,r=Math.max(1,Math.min(6*n.length,e-1));let a=d(y(t,r),n);return a.reverse(),a=d(a,n),a.reverse(),a.subarray(r,r+e).slice()}function x(t,n,e){const r=2*Math.PI*t/n,a=Math.cos(r),o=Math.sin(r)/(2*e);let l=(1-a)/2,s=1-a,h=(1-a)/2,i=1+o,f=-2*a,c=1-o;return l/=i,s/=i,h/=i,f/=i,c/=i,{b0:l,b1:s,b2:h,a1:f,a2:c}}function A(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=Math.abs(t[r]-n);return e}function w(t,n){const e=t.length;if(0===e)return NaN;if(n<=0)return function(t){let n=1/0;for(let e=0;e<t.length;e++)t[e]<n&&(n=t[e]);return n}(t);if(n>=1)return function(t){let n=-1/0;for(let e=0;e<t.length;e++)t[e]>n&&(n=t[e]);return n}(t);const r=Float32Array.from(t),a=(e-1)*n,o=Math.floor(a),l=a-o,s=F(r,o);if(0===l)return s;return s+(F(r,o+1)-s)*l}function F(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1;for(;;){if(e===r)return t[e];const a=e+(r-e>>1);t[r]<t[e]&&v(t,e,r),t[a]<t[e]&&v(t,a,e),t[r]<t[a]&&v(t,r,a);let o=t[a],l=e,s=r;for(;l<=s;){for(;t[l]<o;)l++;for(;t[s]>o;)s--;l<=s&&(v(t,l,s),l++,s--)}if(n<=s)r=s;else{if(!(n>=l))return t[n];e=l}}}function v(t,n,e){const r=t[n];t[n]=t[e],t[e]=r}function k(t,n){const e=t.length;if(e<=n)return g(t);const r=Math.max(1,Math.floor(e/n)),a=Math.random()*r|0,o=Math.ceil((e-a)/r),l=new Float32Array(Math.min(n,o));for(let s=a,h=0;s<e&&h<l.length;s+=r,h++)l[h]=t[s];return l}function B(t,n){if(n<3)return g(t).slice();const e=y(t,(n=m(n))-1>>1),r=t.length,a=new Float64Array(e.length+1);for(let l=0;l<e.length;l++)a[l+1]=a[l]+e[l];const o=new Float32Array(r);for(let l=0;l<r;l++){const t=a[l+n]-a[l];o[l]=t/n}return o}function P(t,n){return Math.max(1,Math.round(n*t/1e3))}function S(t){return t.length?w(Float32Array.from(t),.5):0}function I(t,n){t.push(n),t.length>8&&t.shift()}function _(t,n,e){return t<n?n:t>e?e:t}function R(t,n,e){const r=n;let a=0;for(let o=Math.max(1,n-e);o<=r;o++){const n=Math.abs(t[o]-t[o-1]);n>a&&(a=n)}return a}function C(t){const n=Array.from(t);n.sort((t,n)=>t-n);const e=[];let r=null;for(let a=0;a<n.length;a++){const t=0|n[a];null!==r&&t===r||(e.push(t),r=t)}return Int32Array.from(e)}function N(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=Math.abs(t[r]-n);return e}function D(t,n,e,r){let a=n,o=t[n];for(let l=n+1;l<=e;l++){const n=t[l];(n>o||n===o&&Math.abs(l-r)<Math.abs(a-r)||n===o&&Math.abs(l-r)===Math.abs(a-r)&&l<a)&&(o=n,a=l)}return a}function T(t,n,e){const r=Math.max(1,n-e),a=Math.min(t.length-2,n+e);let o=-1,l=1e9;for(let s=r;s<=a;s++){const e=t[s]-t[s-1],r=t[s+1]-t[s],a=t[s+1]-2*t[s]+t[s-1];if(e>0&&r<=0&&a<0){const t=Math.abs(s-n);t<l&&(o=s,l=t)}}return o>=0?o:n}function q(t,n,e){const r=e-1>>1,a=Math.max(0,n-r),o=Math.min(t.length-1,n+r),l=t.subarray?t.subarray(a,o+1):t.slice(a,o+1),s=w(l,.5),h=w(N(l,s),.5)||0,i=Math.max(.03,1.5*h),f=n-a,c=w(l.subarray?l.subarray(0,Math.max(1,f)):l.slice(0,Math.max(1,f)),.5),u=w(l.subarray?l.subarray(Math.min(l.length-1,f+1)):l.slice(Math.min(l.length-1,f+1)),.5),g=Math.max(c,u);return t[n]>=g+i}function z(t,n,e,r){const a=Math.max(1,n-e),o=Math.min(t.length-1,n+r);let l=0,s=0;for(let f=a;f<=n;f++){const n=t[f]-t[f-1];0!==n&&(s++,n>0&&l++)}let h=0,i=0;for(let f=n+1;f<=o;f++){const n=t[f]-t[f-1];0!==n&&(i++,n<0&&h++)}return(s?l/s:0)>=.55&&(i?h/i:0)>=.55}function E(t,n){if(n<3)return t.slice();const e=function(t,n){n=m(n);const e=t.length-n+1;if(e<=0)return new Float32Array(0);function r(t){this.cmp=t,this.a=[]}r.prototype.size=function(){return this.a.length},r.prototype.peek=function(){return this.a[0]},r.prototype.push=function(t){const n=this.a;n.push(t);let e=n.length-1;for(;e>0;){const t=e-1>>1;if(!this.cmp(n[e],n[t]))break;const r=n[e];n[e]=n[t],n[t]=r,e=t}},r.prototype.pop=function(){const t=this.a,n=t[0],e=t.pop();if(t.length){t[0]=e;let n=0;for(;;){let e=2*n+1,r=e+1,a=n;if(e<t.length&&this.cmp(t[e],t[a])&&(a=e),r<t.length&&this.cmp(t[r],t[a])&&(a=r),a===n)break;const o=t[n];t[n]=t[a],t[a]=o,n=a}}return n};const a=new r((t,n)=>t.val>n.val||t.val===n.val&&t.idx>n.idx),o=new r((t,n)=>t.val<n.val||t.val===n.val&&t.idx<n.idx),l=new Map;let s=0,h=0;function i(t){for(;t.size();){const n=t.peek(),e=l.get(n.idx);if(!e)break;1===e?l.delete(n.idx):l.set(n.idx,e-1),t.pop()}}function f(){s>h+1?(i(a),o.push(a.pop()),s--,h++,i(a)):s<h&&(i(o),a.push(o.pop()),s++,h--,i(o))}function c(t,n){!a.size()||t<=a.peek().val?(a.push({val:t,idx:n}),s++):(o.push({val:t,idx:n}),h++),f()}function u(t,n){l.set(n,(l.get(n)||0)+1),a.size()&&t<=a.peek().val?s--:h--,i(a),i(o),f()}const g=new Float32Array(e);for(let m=0;m<n;m++)c(t[m],m);i(a),g[0]=a.peek().val;for(let m=n;m<t.length;m++){c(t[m],m);const e=m-n;u(t[e],e),i(a),g[m-n+1]=a.peek().val}return g}(y(t,(n=m(n))-1>>1),n);return e.subarray(0,t.length).slice()}function W(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null!=e.hp?e.hp:8,a=null!=e.lp?e.lp:40,o=2===e.orderHP?2:4,l=2===e.orderLP?2:4,s=g(t);if(s.length<4)return s.slice();const h=p(r,n,o),i=function(t,n,e){return 2===e?[x(t,n,1/Math.SQRT2)]:[.5411961,1.30656296].map(e=>x(t,n,e))}(a,n,l);return b(s,h.concat(i))}function H(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=g(t),r=e.length;if(!r)return n.returnStats?{signal:new Float32Array(0),stats:{}}:new Float32Array(0);const a=n.center||"median",o=n.scale||"mad",l=k(e,null!=n.maxSample?n.maxSample:2e5),s="mean"===a?function(t){let n=0,e=t.length;for(let r=0;r<e;r++)n+=t[r];return n/Math.max(1,e)}(l):w(l,.5);let h,i={centerMode:a,scaleMode:o,center:s};if("none"===o)h=1;else if("std"===o)h=function(t,n){let e=0,r=t.length;for(let a=0;a<r;a++){const r=t[a]-n;e+=r*r}return Math.sqrt(e/Math.max(1,r))}(l,s);else if("iqr"===o){const t=w(l,.25),n=w(l,.75);i.q1=t,i.q3=n,h=Math.max(1e-12,(n-t)/1.349)}else if("p95"===o){const t=w(A(l,s),.95);i.p95abs=t,h=Math.max(1e-12,t)}else{const t=w(A(l,s),.5);i.mad=t,h=Math.max(1e-12,1.4826*t)}const f=1/(h||1),c=new Float32Array(r);if(null!=n.clipNsigma&&isFinite(n.clipNsigma)){const t=Math.abs(n.clipNsigma);for(let n=0;n<r;n++){let r=(e[n]-s)*f;r>t&&(r=t),r<-t&&(r=-t),c[n]=r}i.clipNsigma=t}else for(let u=0;u<r;u++)c[u]=(e[u]-s)*f;return i.scale=h,n.returnStats?{signal:c,stats:i}:c}function L(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=g(t),a=r.length;if(!a)return new Float32Array(0);const o="diff1"===(e.deriv||"diff5")?function(t){const n=t.length,e=y(t,1),r=new Float32Array(n);for(let a=0;a<n;a++){const t=a+1;r[a]=.5*(e[t+1]-e[t-1])}return r}(r):function(t){const n=t.length,e=y(t,2),r=new Float32Array(n);for(let a=0;a<n;a++){const t=a+2;r[a]=.125*(-e[t-2]-2*e[t-1]+2*e[t+1]+e[t+2])}return r}(r);for(let l=0;l<a;l++)o[l]=o[l]*o[l];return B(o,m(Math.max(3,Math.round((null!=e.mwiMs?e.mwiMs:150)*n/1e3))))}function K(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=g(t),o=a.length,l=function(t){if(t instanceof Int32Array)return t;const n=new Int32Array(t.length);for(let e=0;e<t.length;e++)n[e]=0|t[e];return n}(n),s=P(e,null!=r.winMs?r.winMs:75),h=Math.max(1,null!=r.microWin?r.microWin:3),i=P(e,40),f=P(e,40),c=Math.max(21,1|P(e,200)),u=Math.max(2,P(e,12)),m=r.xBandpass&&r.xBandpass.length===o?r.xBandpass:a,M=[];for(let g=0;g<l.length;g++){const t=_(l[g],0,o-1),n=Math.max(0,t-s),e=Math.min(o-1,t+s),r=D(m,n,e,t);let p=D(a,Math.max(n,r-h),Math.min(e,r+h),r);p=T(m,p,u),p<1||p>o-2||q(a,p,c)&&z(m,p,i,f)&&M.push(p)}return Int32Array.from(M)}function V(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=g(t),a=r.length;if(!a)return new Float32Array(0);const o=y(r,1),l=new Float32Array(a);for(let s=0;s<a;s++){const t=o[s+1],n=o[s],e=o[s+2];l[s]=Math.abs(t*t-n*e)}return B(l,m(Math.max(3,Math.round((null!=e.winMs?e.winMs:120)*n/1e3))))}function O(t){const n=400,e=t.map(t=>t[1]),r=t.map(t=>t[0]),a=g(e),o=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.method||"hp",a=g(t);if(a.length<4)return e.returnBaseline?{signal:a.slice(),baseline:new Float32Array(a.length)}:a.slice();if("median"===r){const t=m(Math.max(3,Math.round(e.win1Ms?e.win1Ms*n/1e3:.2*n))),r=m(Math.max(3,Math.round(e.win2Ms?e.win2Ms*n/1e3:.6*n))),o=E(a,t),l=E(o,r),s=new Float32Array(a.length);for(let n=0;n<a.length;n++)s[n]=a[n]-l[n];return e.returnBaseline?{signal:s,baseline:l}:s}const o=b(a,p(null!=e.hpHz?e.hpHz:.7,n,2===e.order?2:4));if(e.returnBaseline){const t=new Float32Array(a.length);for(let n=0;n<a.length;n++)t[n]=a[n]-o[n];return{signal:o,baseline:t}}return o}(a,n,{method:"hp"}),l=W(o,n,{hp:8,lp:40}),s=H(l,{}).signal||H(l,{}),h=L(s,n,{}),i=V(s,n,{}),f=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=g(t),a=r.length;if(a<3)return new Int32Array(0);const o=P(n,null!=e.refractoryMs?e.refractoryMs:200),l=Math.min(a,Math.max(1,Math.round((null!=e.initWinSec?e.initWinSec:2)*n))),s=null!=e.thrAlpha?e.thrAlpha:.25,h=null!=e.searchBackFactor?e.searchBackFactor:1.66,i=r.subarray(0,l);let f=w(i,.2),c=w(i,.9),u=f+s*(c-f);const m=[],M=[];let p=-1,d=-1,y=-1/0;const b=[];for(let g=1;g<a-1;g++){if(!(r[g]>r[g-1]&&r[g]>=r[g+1]))continue;const t=g,n=r[g];if(m.length){const n=t-p,e=S(b);e>0&&n>Math.round(h*e)&&d>p+o&&(m.push(d),M.push(y),I(b,d-p),p=d,c=.125*y+.875*c,u=f+s*(c-f),d=-1,y=-1/0)}n>u?(p>=0&&t-p<=o?n>M[M.length-1]&&(m[m.length-1]=t,M[M.length-1]=n,p=t):(m.push(t),M.push(n),p>=0&&I(b,t-p),p=t),c=.125*n+.875*c,u=f+s*(c-f),d=-1,y=-1/0):(f=.125*n+.875*f,u=f+s*(c-f),n>y&&(y=n,d=t))}return Int32Array.from(m)}(h,n,{}),c=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=V(t,n,{winMs:e.winMs}),a=k(r,null!=e.maxSample?e.maxSample:2e5),o=w(a,.5),l=w(A(a,o),.5),s=o+(null!=e.k?e.k:4)*(l||0),h=r.length,i=P(n,null!=e.refractoryMs?e.refractoryMs:200),f=[],c=[];let u=-1;for(let m=1;m<h-1;m++)r[m]>r[m-1]&&r[m]>=r[m+1]&&(r[m]<s||(u>=0&&m-u<=i?r[m]>c[c.length-1]&&(f[f.length-1]=m,c[c.length-1]=r[m],u=m):(f.push(m),c.push(r[m]),u=m)));const g=Int32Array.from(f);return e.returnFeature?{indices:g,feature:r,thr:s}:g}(s,n,Object.assign({returnFeature:!1},{})),u=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=P(n,null!=e.mergeTolMs?e.mergeTolMs:100),a=Array.isArray(e.feats)?e.feats:null,o=e.xRef||null,l=[];for(let u=0;u<t.length;u++){const n=C(t[u]||[]);for(let t=0;t<n.length;t++){const e=n[t],r=a&&a[u]&&a[u].length>e?Math.abs(a[u][e]):o&&o.length>e?Math.abs(o[e]):0;l.push({idx:e,src:u,score:r})}}if(!l.length)return e.returnMeta?{indices:new Int32Array(0),meta:[]}:new Int32Array(0);l.sort((t,n)=>t.idx-n.idx);const s=[],h=[];let i=[l[0]];for(let u=1;u<l.length;u++){const t=i[i.length-1],n=l[u];n.idx-t.idx<=r?i.push(n):(c(i,s,h),i=[n])}c(i,s,h);const f=Int32Array.from(s);return e.returnMeta?{indices:f,meta:h}:f;function c(t,n,r){if(!t||!t.length)return;let a=t[0];for(let e=1;e<t.length;e++)t[e].score>a.score&&(a=t[e]);if(n.push(a.idx),e.returnMeta){const n=new Set;for(const e of t)n.add(e.src);r.push({i:a.idx,votes:Array.from(n).length,sources:Array.from(n).sort((t,n)=>t-n)})}}}([f,c],n,{feats:[h,i],xRef:s,mergeTolMs:100,returnMeta:!0}),M=function(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=t instanceof Float32Array?t:Float32Array.from(t);let o=C(n);const l=a.length;if(!o.length)return o;const s=r.feat&&r.feat.length===l?r.feat:null,h=P(e,null!=r.refractoryMs?r.refractoryMs:200),i=P(e,null!=r.minRRMs?r.minRRMs:240),f=P(e,null!=r.tSuppressMs?r.tSuppressMs:200),c=P(e,null!=r.preSlopeMs?r.preSlopeMs:40),u=null!=r.tSlopeFrac?r.tSlopeFrac:.4,g=null!=r.sbFactor?r.sbFactor:1.5,m=null!=r.sbK?r.sbK:3;{const t=[],n=s||a;let e=o[0];for(let r=1;r<o.length;r++){const a=o[r];a-e<i?e=n[e]>=n[a]?e:a:(t.push(e),e=a)}t.push(e),o=Int32Array.from(t)}if(o.length<=1)return o;{const t=[o[0]];for(let n=1;n<o.length;n++){const e=t[t.length-1],r=o[n];if(r-e<=f){const t=R(a,e,c);if(R(a,r,c)<u*t)continue}t.push(r)}o=Int32Array.from(t)}if(o.length<=1)return o;{const t=s||a,n=[o[0]],r=[];for(let a=1;a<o.length;a++){const l=n[n.length-1],s=o[a],i=s-l,f=S(r);if(f>0&&i>Math.round(g*f)){const a=Math.max(l+h,l+1),o=Math.min(s-h,s-1);if(o>a+2){let h=D(t,a,o,a+o>>1);if(h=T(t,h,Math.max(2,P(e,12))),q(t,h,Math.max(21,1|P(e,200)))){const e=t.subarray?t.subarray(a,o+1):t.slice(a,o+1),i=w(e,.5),f=i+m*(w(N(e,i),.5)||0);if(t[h]>f){n.push(h),I(r,h-l),I(r,s-h),n.push(s);continue}}}}I(r,i),n.push(s)}o=C(n)}return o}(s,K(a,u.indices,n,{xBandpass:l}),n,{feat:h}),d=function(t,n,e){const r=g(t),a=C(n),o=r.length;if(!o||!a.length)return new Int32Array(0);const l=Math.max(1,P(e,8)),s=Math.max(1,P(e,40)),h=Math.max(1,P(e,40)),i=Math.max(3,m(P(e,12))),f=Math.max(21,m(P(e,200))),c=function(t,n){const e=t.length,r=n-1>>1,a=y(t,r),o=new Float32Array(e);for(let l=0;l<e;l++){const t=l+r;let e=0;for(let n=1;n<=r;n++)e+=a[t+n]-a[t-n];o[l]=e/n}return o}(r,i),u=[];for(let g=0;g<a.length;g++){const t=0|a[g];if(t<=0||t>=o-1)continue;if(!M(r,t,Math.max(0,t-l),Math.min(o-1,t+l)))continue;const n=Math.max(1,t-s),e=Math.min(o-1,t+h);let i=0,m=0;for(let r=n;r<=t;r++){const t=c[r];0!==t&&(m++,t>0&&i++)}let p=0,d=0;for(let r=t+1;r<=e;r++){const t=c[r];0!==t&&(d++,t<0&&p++)}if((m?i/m:0)<.55||(d?p/d:0)<.55)continue;const y=Math.max(0,t-(f-1>>1)),b=Math.min(o-1,t+(f-1>>1)),x=r.subarray?r.subarray(y,b+1):r.slice(y,b+1),A=w(x,.5),F=w(N(x,A),.5),v=Math.max(.03,1.5*(F||0)),k=t-y,B=w(x.subarray?x.subarray(0,Math.max(1,k)):x.slice(0,Math.max(1,k)),.5),P=w(x.subarray?x.subarray(Math.min(x.length-1,k+1)):x.slice(Math.min(x.length-1,k+1)),.5),S=Math.max(B,P);r[t]-S<v||u.push(t)}return Int32Array.from(u);function M(t,n,e,r){const a=t[n];for(let o=e;o<=r;o++)if(t[o]>a)return!1;return!0}}(s,M,n);return{series:r.map((t,n)=>[t,d.includes(n)?100:0]),data:Array.from(d)}}function Q(t){return new Array(t).fill(0)}function U(t){const n=new Array(t);for(let e=0;e<t;e++)n[e]=.54-.46*Math.cos(2*Math.PI*e/(t-1));return n}function j(t){if(0===t)return 1;const n=Math.PI*t;return Math.sin(n)/n}function G(){let{A:t=26,fs:n=400,f1:e=5,f2:r=30}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=n/2;return function(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"hamming";var a;Array.isArray(n)||(e=arguments[2],r=null!==(a=arguments[3])&&void 0!==a?a:"hamming");const o=Array.isArray(n)?n[0]:n,l=Array.isArray(n)?n[1]:e,s=t+1,h=t/2,i=U(s),f=new Array(s);for(let c=0;c<s;c++){const t=c-h,n=2*l*j(2*l*t)-2*o*j(2*o*t);f[c]=n*i[c]}return f}(t,[e/a,r/a])}G({A:26,fs:400,f1:5,f2:30});function $(t){const n=function(t,n){const e=n/2;return t.slice(e,t.length-e)}(function(t,n){const e=t.length,r=n.length,a=Q(e+r-1);for(let o=0;o<a.length;o++){let l=0;const s=Math.max(0,o-(r-1)),h=Math.min(o,e-1);for(let e=s;e<=h;e++)l+=t[e]*n[o-e];a[o]=l}return a}(G({A:26,fs:arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,f1:5,f2:30}),t),26),e=n.map(t=>{return(0===(n=t)?0:n>0?1:-1)*t**2;var n}),r=Q(e.length);for(let l=0;l<e.length-1;l++)r[l+1]=.99*r[l]+4*(1-.99)*Math.abs(e[l+1]);const a=r.map((t,n)=>(n%2===0?1:-1)*t),o=e.map((t,n)=>t+a[n]);return{filter_signal:n,nonlinear:e,new_signal:o}}const J=t=>{const n=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const e=Math.round(.1*n),r=Math.round(.4*n),a=Math.floor(e/2),o=Math.floor(r/2),l=t.length,s=Array.from(t,Number),h=c(s,a),i=c(h,o),f=new Array(l);for(let u=0;u<l;u++)f[u]=s[u]-i[u];return f;function c(t,n){const e=new Array(t.length);for(let r=0;r<t.length;r++){const a=Math.max(0,r-n),o=Math.min(t.length-1,r+n),l=t.slice(a,o+1).sort((t,n)=>t-n),s=Math.floor(l.length/2);e[r]=l.length%2===1?l[s]:.5*(l[s-1]+l[s])}return e}}(t.map(t=>t[1]));return n};function X(n){const e=n.map(t=>t[0]),r=n.map(t=>t[1]),a=t=>e.map((n,e)=>[n,t[e]]),o=J(n),{filter_signal:l,nonlinear:s,new_signal:h}=$(o,400),{finalPeaks:i,D:f}=function(n,e){const r=new Array(n.length).fill(0);for(let t=0;t<n.length-1;t++)r[t+1]=.5*Math.abs(Math.sign(n[t+1])-Math.sign(n[t]));const a=new Array(n.length).fill(0);for(let t=0;t<n.length-1;t++)a[t+1]=.99*a[t]+(1-.99)*r[t+1];const o=new Array(n.length).fill(0);for(let t=0;t<n.length-1;t++)o[t+1]=.97*o[t]+(1-.97)*a[t+1];const l=new Array(a.length).fill(0),s=new Array(a.length).fill(0);for(let t=0;t<r.length;t++)r[t]<o[t]?l[t]=1:s[t]=1;const h=[],i=[];for(let t=0;t<l.length;t++)1===l[t]&&h.push(t),1===s[t]&&i.push(t);const f=[];for(let t=1;t<h.length;t++)f.push(h[t]-h[t-1]);const c=[];for(let t=1;t<i.length;t++)c.push(i[t]-i[t-1]);const u=[];f.forEach((t,n)=>{t>1&&u.push(n)});const g=[];c.forEach((t,n)=>{t>1&&g.push(n)});const m=u.map(t=>h[t+1]),M=g.map(t=>i[t+1]),p=[];for(let t=0;t<m.length;t++)p.push([M[t],m[t]]);const d=[],y=[];for(let t=0;t<p.length-1;t++)y.push(p[t+1][0]-p[t][1]),y[t]<=30?d.push([p[t][0],p[t+1][1]]):(d.push(p[t]),t===p.length-2&&d.push(p[p.length-1]));const b=[],x=[];for(let t=0;t<d.length-1;t++)x.push(d[t+1][0]-d[t][1]),b.push(d[t]),t===d.length-2&&b.push(d[d.length-1]);const A=b.filter(t=>null!==t);for(let t=0;t<b.length-1;t++)A[t][1]===A[t+1][1]&&(b[t+1]=null);const w=b.filter(t=>null!==t),F=[];for(let t=0;t<w.length;t++){const n=w[t][0],e=w[t][1];e-n>=30&&F.push([n,e])}const v=[],k=[];for(let R=0;R<F.length;R++){const[n,r]=F[R],a=e.slice(n,r+1).filter(t=>t>0);v.push(t(a,"max")),k.push(t(a,"min"))}const B=[];for(let t=0;t<F.length;t++)k[t]-v[t]>10?B.push(k[t]):B.push(v[t]);const P=e.map(t=>t>0?t:0),S=[];for(let t=0;t<F.length;t++){const[n,e]=F[t],r=P.slice(n,e+1).findIndex(n=>n===B[t]);S.push(n+r)}const I=S.map(t=>P[t]);let _=[...S];for(let t=0;t<_.length-1;t++){const n=100;_[t+1]-_[t]<n&&(I[t]<I[t+1]?_[t]=null:_[t+1]=null)}return{finalPeaks:_=_.filter(t=>null!==t),d:r,D:a,threshold:o}}(h,s);return{filteredSignal:a(l),nonlinearizedSignal:a(s),HFSignal:a(h),zeroCrossingSignal:a(f),preFiltered:a(o),peaks:{series:e.map((t,n)=>[t,i.includes(n)&&r[n]>0?50:0]),data:i}}}function Y(n){const e=t(n,"max")||1,r=t(n,"min")||1,a=Math.abs(e)>Math.abs(r)?e:r;return n.map(t=>t/a)}const Z=Math.round;function tt(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length;const r=Math.max(0,e-n);if(!r)return 0;let a=0;for(let o=n;o<e;o++)a+=t[o];return a/r}function nt(t){const n=t.length;if(!n)return 0;const e=new Float64Array(n);for(let a=0;a<n;a++)e[a]=t[a];e.sort();const r=n>>1;return 1&n?e[r]:.5*(e[r-1]+e[r])}function et(t){const n=function(t){let n=0;for(let e=0;e<t.length;e++){const r=Math.abs(t[e]);r>n&&(n=r)}return n}(t);if(!n)return;const e=1/n;for(let r=0;r<t.length;r++)t[r]*=e}function rt(t,n,e){if(n|=0,(e=Math.min(0|e,t.length))<=n)return{idx:-1,val:-1/0};let r=n,a=t[n];for(let o=n+1;o<e;o++){const n=t[o];n>a&&(a=n,r=o)}return{idx:r,val:a}}function at(t,n){if(0===t.length)return[];const e=[t[0]];for(let r=1;r<t.length;r++)t[r]-e[e.length-1]>=n&&e.push(t[r]);return e}function ot(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;const a=Math.max(0,n-e),o=Math.min(t.length-1,n+r);return o-a<3||t[n]-t[a]>0&&t[o]-t[n]<0}function lt(t,n,e){const r=Math.max(0,n-e),a=Math.min(t.length-1,n+e);let o=1/0,l=1/0;for(let s=r;s<=n;s++)t[s]<o&&(o=t[s]);for(let s=n;s<=a;s++)t[s]<l&&(l=t[s]);return t[n]-Math.max(o,l)}function st(t,n,e){const r=Math.max(0,n-e),a=Math.min(t.length-1,n+e);let o=1/0,l=-1/0;for(let h=r;h<=a;h++){const n=t[h];n<o&&(o=n),n>l&&(l=n)}const s=l-o;return s>1e-9?s:1e-9}function ht(t,n,e,r,a){const o=Z(.12*e),l=Z(.02*e),s=lt(t,n,o),h=st(t,n,o),i=function(t,n,e){const r=t[n]-.5*lt(t,n,e),a=Math.max(0,n-e),o=Math.min(t.length-1,n+e);let l=n,s=n;for(;l>a&&t[l]>=r;)l--;for(;s<o&&t[s]>=r;)s++;return s-l}(t,n,o),f=Math.max(1,n-1),c=Math.min(t.length-2,n+1),u=-(t[f]-2*t[n]+t[c])/h,{up:g,down:m}=function(t,n,e){const r=Math.max(0,n-e),a=Math.min(t.length-2,n+e);let o=0,l=0;for(let s=r;s<n;s++){const n=t[s+1]-t[s];n>o&&(o=n)}for(let s=n;s<=a;s++){const n=t[s+1]-t[s];n<l&&(l=n)}return{up:o,down:l}}(t,n,l),M=Math.max(.12*Math.max(1e-9,r-a),.06*Math.max(1e-9,r)),p=Z(.012*e),d=Z(.12*e),y=.06*h;return!(s<M||i<p||i>d||u<.03||g<y||-m<y)}function it(t,n,e){const r=Z(.05*e),a=Math.min(t.length-1,n+r);let o=1/0;for(let l=n;l<=a;l++){const n=t[l];n<o&&(o=n)}return t[n]-o>=.18*st(t,n,Z(.12*e))}const ft={b:new Float32Array([.00475052,.01425157,.01425157,.00475052]),a:new Float32Array([1,-2.25008508,1.75640138,-.46831211])},ct={b:new Float32Array([.85449723,-2.56349169,2.56349169,-.85449723]),a:new Float32Array([1,-2.6861574,2.41965511,-.73016535])};function ut(t,n,e,r){const a=t[0],o=t[1],l=t[2],s=t[3],h=n[1],i=n[2],f=n[3];let c=0,u=0,g=0,m=0,M=0,p=0;for(let d=0;d<e.length;d++){const t=e[d],n=a*t+o*c+l*u+s*g-(h*m+i*M+f*p);r[d]=n,g=u,u=c,c=t,p=M,M=m,m=n}}function gt(t,n,e){const r=t.length;for(let a=0;a<n.length;a++){let o=0;for(let e=0;e<r;e++){const r=a-e;if(!(r>=0))break;o+=t[e]*n[r]}e[a]=o}}function mt(t,n,e,r){const a=t.length,o=n.length,l=n[0];for(let s=0;s<e.length;s++){let h=0;for(let n=0;n<a;n++)s-n>=0&&(h+=t[n]*e[s-n]);for(let t=1;t<o;t++)s-t>=0&&(h-=n[t]*r[s-t]);r[s]=h/l}}class Mt{constructor(){this.padBuf1=new Float32Array(0),this.padBuf2=new Float32Array(0)}_ensurePad(t){this.padBuf1.length<t&&(this.padBuf1=new Float32Array(t),this.padBuf2=new Float32Array(t))}filtfilt(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=Math.max(t.length,n.length)-1,o=null==r?3*a:r,l=e.length,s=o+l+o;this._ensurePad(s);const h=this.padBuf1,i=this.padBuf2;for(let f=0;f<o;f++)h[f]=2*e[0]-e[Math.min(o-f,l-1)];h.set(e,o);for(let f=0;f<o;f++)h[o+l+f]=2*e[l-1]-e[Math.max(l-2-f,0)];1===n.length?gt(t,h.subarray(0,s),i.subarray(0,s)):4===n.length&&4===t.length?ut(t,n,h.subarray(0,s),i.subarray(0,s)):mt(t,n,h.subarray(0,s),i.subarray(0,s));for(let f=0;f<s;f++)h[f]=i[s-1-f];1===n.length?gt(t,h.subarray(0,s),i.subarray(0,s)):4===n.length&&4===t.length?ut(t,n,h.subarray(0,s),i.subarray(0,s)):mt(t,n,h.subarray(0,s),i.subarray(0,s));for(let f=0;f<l;f++)e[f]=i[s-1-(o+f)];return e}}function pt(t,n,e,r){const a=t.length,o=Math.max(1,Math.min(0|n,a-1)),l=o;let s=r.get(l);s||(s=function(t){const n=t-1,e=new Float32Array(t);for(let o=0;o<t;o++){const t=2*Math.PI*o/n;e[o]=1-1.93*Math.cos(t)+1.29*Math.cos(2*t)-.388*Math.cos(3*t)+.028*Math.cos(4*t)}let r=0;for(let o=0;o<t;o++)r+=e[o];const a=1/r;for(let o=0;o<t;o++)e[o]*=a;return e}(o),r.set(l,s));const h=o-1>>1;for(let i=0;i<a;i++){let n=0;for(let e=0;e<o;e++){let r=i+e-h;r<0&&(r=-r),r>=a&&(r=2*a-2-r),n+=t[r]*s[e]}e[i]=n}}class dt{constructor(){this.bufA=new Float32Array(0),this.bufB=new Float32Array(0),this.bufC=new Float32Array(0),this.bufD=new Float32Array(0),this.bufE=new Float32Array(0),this.fr=new Mt,this.winCache=new Map,this.boxWinCache=new Map,this.diffByFs=new Map,this.h129_400=function(t,n,e){const r=t-1,a=new Float32Array(t);for(let i=0;i<t;i++)a[i]=.54-.46*Math.cos(2*Math.PI*i/r);const o=new Float32Array(t),l=2*n/e;for(let i=0;i<t;i++){const t=l*(i-r/2),n=0===t?1:Math.sin(Math.PI*t)/(Math.PI*t);o[i]=l*n*a[i]}let s=0;for(let i=0;i<t;i++)s+=o[i];const h=1/s;for(let i=0;i<t;i++)o[i]*=h;return o}(129,80,400),this.minRRsamples=null,this.minRRsec=null,this.minRRms=null}get_name(){return"Pan_Tompkins_Plus_Plus_Plus"}_ensure(t){this.bufA.length<t&&(this.bufA=new Float32Array(t),this.bufB=new Float32Array(t),this.bufC=new Float32Array(t),this.bufD=new Float32Array(t),this.bufE=new Float32Array(t))}_getDiff(t){let n=this.diffByFs.get(t);return n||(n=new Float32Array([1,2,0,-2,-1].map(n=>n*t/8)),this.diffByFs.set(t,n)),n}_getBoxWinLen(t,n){return Math.max(1,Z(n*t))}downsample400to200(t){const n=t.length;this._ensure(n),this.bufA.set(t,0);const e=3*(this.h129_400.length-1);this.fr.filtfilt(this.h129_400,new Float32Array([1]),this.bufA.subarray(0,n),e);const r=n>>1,a=new Float32Array(r);for(let o=0;o<r;o++)a[o]=this.bufA[2*o];return a}rpeak_detection_200_pos(t,n){const e=t.length;this._ensure(e);const r=tt(t);for(let P=0;P<e;P++)this.bufA[P]=t[P]-r;this.bufB.set(this.bufA.subarray(0,e),0),this.fr.filtfilt(ft.b,ft.a,this.bufB.subarray(0,e)),et(this.bufB.subarray(0,e)),this.bufC.set(this.bufB.subarray(0,e),0);const a=3*(Math.max(ct.b.length,ct.a.length)-1);this.fr.filtfilt(ct.b,ct.a,this.bufC.subarray(0,e),a),et(this.bufC.subarray(0,e));const o=this._getDiff(n),l=3*(Math.max(o.length,1)-1);this.bufD.set(this.bufC.subarray(0,e),0),this.fr.filtfilt(o,new Float32Array([1]),this.bufD.subarray(0,e),l),et(this.bufD.subarray(0,e));for(let P=0;P<e;P++)this.bufE[P]=this.bufD[P]*this.bufD[P];pt(this.bufE.subarray(0,e),Z(.06*n),this.bufA.subarray(0,e),this.winCache);const s=this._getBoxWinLen(n,.15);!function(t,n,e){const r=t.length,a=Math.max(1,0|n),o=a-1>>1,l=a-1-o;for(let s=0;s<r;s++){let n=s-o,a=s+l;n<0&&(n=0),a>=r&&(a=r-1);let h=0;for(let e=n;e<=a;e++)h+=t[e];e[s]=h/(a-n+1)}}(this.bufA.subarray(0,e),s,this.bufB.subarray(0,e));const h=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=t.length;if(r<3)return[];const[a,o]=function(t){let n=1/0,e=-1/0;for(let r=0;r<t.length;r++){const a=t[r];a<n&&(n=a),a>e&&(e=a)}return[n,e]}(t),l=a+n*(o-a),s=[];for(let f=1;f<r-1;f++){const n=t[f];n>l&&n>t[f-1]&&n>t[f+1]&&s.push(f)}if(!s.length)return[];s.sort((n,e)=>t[e]-t[n]);const h=[],i=new Uint8Array(r);for(let f=0;f<s.length;f++){const t=s[f];if(i[t])continue;h.push(t);const n=Math.max(0,t-e),a=Math.min(r-1,t+e);for(let e=n;e<=a;e++)i[e]=1}return h.sort((t,n)=>t-n),h}(this.bufB.subarray(0,e),0,Z(.1*n)),i=new Float32Array(h.length);for(let P=0;P<h.length;P++)i[P]=this.bufB[h[P]];const f=[];let c=[];const u=2*n+1;let g=-1/0;for(let P=0;P<Math.min(u,e);P++)this.bufB[P]>g&&(g=this.bufB[P]);let m=g/3,M=m,p=tt(this.bufB,0,Math.min(u,e))/2,d=-1/0;for(let P=0;P<Math.min(u,e);P++)this.bufC[P]>d&&(d=this.bufC[P]);let y=d/3,b=y,x=tt(this.bufC,0,Math.min(u,e))/2,A=0,w=0,F=-1e9;const v=(t,n,e)=>{if(e<=n)return 0;let r=0;for(let a=n+1;a<=e;a++)r+=t[a]-t[a-1];return r/(e-n)},k=t=>{if(A<1)return!1;const e=Z(.07*n),r=Math.max(0,t-e),a=t,o=f[A-1],l=Math.max(0,o-e-1),s=o,h=v(this.bufB,r,a),i=v(this.bufB,l,s);return Math.abs(h)<=Math.abs(.6*i)};for(let P=0;P<i.length;P++){const t=Z(.15*n),r=Math.max(0,h[P]-t),a=Math.min(e,h[P]+t+1),{idx:o,val:l}=rt(this.bufC,r,a),s=h[P]-F;if(s<Z(.2*n))continue;let u=0,g=0;if(A>=9){const t=[];for(let n=A-9;n<A-1;n++)t.push(f[n+1]-f[n]);u=tt(t),g=u}const d=g||u||0;let v=null;if(A>=3){const t=[];for(let n=Math.max(1,A-8);n<A;n++)t.push(f[n]-f[n-1]);v=nt(t.filter(t=>t>0))}const B=A>0?h[P]-f[A-1]:1e9;let S=!0;if(v&&isFinite(v)){B<Z(.55*v)&&(S=i[P]>=1.6*m&&l>=1.6*y)}if(A>=2){const t=f[A-1]-f[A-2];if(s<Z(.4*t)){if(!(i[P]>=1.4*m&&l>=1.4*y))continue}}let I=!1;const _=(t,e,r,a)=>{a<=0||ot(this.bufC,r,4,4)&&ht(this.bufC,r,n,b,x)&&it(this.bufC,r,n)&&(A++,f.push(t),F=t,a>=y&&(c.push(r),b=.125*a+.875*b),M=.125*e+.875*M,I=!0)};if(i[P]>=m&&S){let t=!1;A>=1&&(h[P]-f[A-1]<=Z(.36*n)||d&&h[P]-f[A-1]<=Z(.5*d))&&(t=k(h[P])),t||_(h[P],i[P],o,l)}if(!I&&S&&!k(h[P])){const t=B>=Z(.2*n)&&B<=Z(.6*n);i[P]>=.5*m&&t&&l>=.5*y&&_(h[P],i[P],o,l)}I||(x=.125*Math.max(0,l)+.875*x,p=.125*i[P]+.875*p),(p||M)&&(m=p+.25*Math.abs(M-p)),(x||b)&&(y=x+.25*Math.abs(b-x)),w=0}!function(t){let e=c.slice();if(e.length<2)return void(c=e);const r=[];for(let n=1;n<e.length;n++)r.push(e[n]-e[n-1]);let a=nt(r)||Z(.8*n);const o=[];for(let l=1;l<e.length;l++){const r=e[l-1],s=e[l]-r;if(s>Math.max(.9*n,.95*a)){const e=rt(t.bufB,r+Z(.25*s),r+Z(.75*s));if(e.idx>=0){const a=Z(.15*n),l=rt(t.bufC,e.idx-a,e.idx+a+1),s=e.val>=.18*m,h=l.val>=.18*y,i=Z(.07*n),f=Math.max(0,e.idx-i),c=e.idx,u=Math.max(0,r-i-1),g=r,M=v(t.bufB,f,c),p=v(t.bufB,u,g);!(Math.abs(M)<=Math.abs(.6*p))&&s&&h&&l.val>0&&ot(t.bufC,l.idx,4,4)&&it(t.bufC,l.idx,n)&&o.push(l.idx),s&&h&&l.val>0&&ot(t.bufC,l.idx,4,4)&&it(t.bufC,l.idx,n)&&o.push(l.idx)}}}o.length&&(e=e.concat(o).sort((t,n)=>t-n),e=at(e,Z(.22*n))),c=e}(this);const B=new Array(c.length);for(let P=0;P<c.length;P++){const t=Z(c[P]);B[P]=Math.max(0,Math.min(e-1,t))}return B}rpeak_detection(t){const n=t instanceof Float32Array?t:new Float32Array(t),e=this.downsample400to200(n),r=at(this.rpeak_detection_200_pos(e,200).map(t=>{const e=2*t,r=Math.max(0,e-2),a=Math.min(n.length,e+3),o=rt(n,r,a);return o.idx>=0&&o.val>0&&ot(n,o.idx,4,4)?o.idx:e}).sort((t,n)=>t-n),Z(88));if(r.length>=2){let t=1/0;for(let n=1;n<r.length;n++){const e=r[n]-r[n-1];e<t&&(t=e)}this.minRRsamples=t,this.minRRsec=t/400,this.minRRms=1e3*this.minRRsec}else this.minRRsamples=this.minRRsec=this.minRRms=null;return r}}const yt=(n,e)=>{const r=n.map(t=>t[0]),a=n.map(t=>t[1]);let o;if(1===e){const n=function(t){const n=[-1,-2,0,2,1].map(t=>t/8),e=Math.floor(n.length/2);let r=[];for(let a=0;a<t.length;a++){let o=0;for(let r=0;r<n.length;r++){const l=a+r-e,s=l>=0&&l<t.length?t[l]:0;o+=n[r]*s}r.push(o)}return r=Y(r),r}(a),e=function(t){let n=t.map(t=>t*t);return n=Y(n),n}(n),r=function(t){let n=[],e=0;for(let r=0;r<t.length;r++)e+=t[r],r>=51&&(e-=t[r-51]),r>=50?n.push(e/51):n.push(0);return n=Y(n),n}(e);o=function(n,e){const r=t(n,"max"),a=n.reduce((t,n)=>t+n,0)/n.length*r,o=n.map(t=>t>a?1:0),l=[],s=[];for(let t=1;t<o.length;t++)0===o[t-1]&&1===o[t]?l.push(t):1===o[t-1]&&0===o[t]&&s.push(t);for(let t=0;t<l.length;t++)l[t]=Math.max(0,l[t]-21),s[t]=Math.min(e.length-1,s[t]-21);const h=[];for(let t=0;t<l.length;t++){const n=l[t],r=s[t];let a=-1/0,o=n;for(let t=n;t<=r;t++)e[t]>a&&(a=e[t],o=t);h.push(o)}const i=[];for(let t=0;t<h.length;t++)if(0===i.length)i.push(h[t]);else{const n=i[i.length-1];h[t]-n>=100&&i.push(h[t])}return i}(r,a)}else if(2===e){const t=new dt;o=t.rpeak_detection(a)}return{peaks:{series:r.map((t,n)=>[t,o.includes(n)?50:0]),data:o}}},bt={PT:t=>yt(t.newPreprocess.newFourth,1).peaks.data,PTPlus:t=>yt(t.biggestPreprocess.detrended,2).peaks.data,KHO:t=>X(t.mvmFiltered).peaks.data,ATN:t=>s(t.mvmFiltered).peaks.data,CMD1:t=>u(t.newPreprocess.newSecond,1).data,CMD2:t=>u(t.notchFilteredML,2).data,GPT:t=>O(t.biggestPreprocess.bp).data};addEventListener("message",t=>{const{name:n,input:e}=t.data;try{const t=bt[n];if(!t)throw new Error(`Unknown task name: ${n}`);const r=t(e);postMessage({ok:!0,name:n,result:r})}catch(r){postMessage({ok:!1,name:n,error:String(r),stack:null===r||void 0===r?void 0:r.stack})}})})();
//# sourceMappingURL=841.46f0c1f4.chunk.js.map