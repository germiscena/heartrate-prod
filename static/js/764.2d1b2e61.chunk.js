(()=>{"use strict";function t(t,n){let e=-1/0,r=1/0;if("min"===n){for(let n=0;n<t.length;n++)t[n]<r&&(r=t[n]);return r}if("max"===n){for(let n=0;n<t.length;n++)t[n]>e&&(e=t[n]);return e}}const n=[[7.8,15.7],[15.7,23.5],[23.5,31.3],[31.3,39.2]],e=(t,n,e)=>Math.max(n,Math.min(e,t)),r=t=>0===t?1:Math.sin(Math.PI*t)/(Math.PI*t);function o(t,n){n=e(n,0,1);const o=t-1,l=function(t){const n=new Array(t);for(let e=0;e<t;e++)n[e]=.54-.46*Math.cos(2*Math.PI*e/(t-1));return n}(t),a=new Array(t);for(let e=0;e<t;e++){const t=e-o/2;a[e]=2*n*r(2*n*t)*l[e]}return a}function l(t,n,r){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400;const a=e(n/(l/2),0,1),s=e(r/(l/2),0,1),h=Math.min(a,s),i=o(t,Math.max(a,s)),c=h>0?o(t,h):new Array(t),f=new Array(t);for(let e=0;e<t;e++)f[e]=i[e]-c[e];return f}function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const r=n.map(t=>{let[n,r]=t;return{band:[n,r],h:l(200,n,r,e)}}).map(n=>{let{h:e}=n;const r=function(t,n){const e=t.length,r=n.length,o=new Array(e),l=Math.floor(r/2);for(let a=0;a<e;a++){let s=0;for(let o=0;o<r;o++){const r=a+o-l;r>=0&&r<e&&(s+=t[r]*n[o])}o[a]=s}return o}(t,e);return r}),o=r.map(t=>function(t,n){const e=new Array(Math.ceil(t.length/n));let r=0;for(let o=0;o<t.length;o+=n)e[r++]=t[o];return e}(t,32));return{filtered:r,decimated:o}}const s=n=>{const e=n[0].data.map(t=>t[0]),r=n[0].data.map(t=>t[1]),o=t=>e.map((n,e)=>[n,t[e]]),[l,s,h,i]=a(r).filtered,c=function(n,e){const r=400,o=32,l=.08,a=1e-12,s=(t,n,e)=>Math.max(n,Math.min(e,t)),h=(t,n)=>{const e=[];for(let r=0;r<t.length;r+=n)e.push(t[r]);return e},i=(t,n)=>(1-.8)*n+.8*t,c=t=>{if(!t.length)return 0;const n=[...t].sort((t,n)=>t-n),e=Math.floor(n.length/2);return n.length%2?n[e]:.5*(n[e-1]+n[e])},f=t=>{const n=c(t);return c(t.map(t=>Math.abs(t-n)))||1},u=(t,n,e,r,o)=>Math.abs(n[t])+Math.abs(e[t])+Math.abs(r[t])+Math.abs(o[t]);function g(t,n,e){let r=-1/0,o=-1;const l=s(n,1,t.length-2),a=s(e,1,t.length-2);for(let s=l;s<=a;s++)t[s]>0&&t[s]>=t[s-1]&&t[s]>t[s+1]&&t[s]>r&&(r=t[s],o=s);return o}function m(t,n,e){const r=Math.max(1,Math.round(.012*e));let o=0,l=0;for(let a=1;a<=r;a++){const e=n-a,r=n+a;e>=0&&r<t.length&&(o+=Math.abs(t[r]-t[e]),l++)}return l?o/l:0}const[M,p,d,y]=e||[];if(!M||!p||!d||!y)return[];const A=Math.min(n.length,M.length,p.length,d.length,y.length);let x=0,w=0;for(let t=0;t<A;t++){const e=n[t];Number.isNaN(e)||(x+=e,w++)}const b=w?x/w:0,v=Array.from({length:A},(t,e)=>Number.isNaN(n[e])?b:n[e]),F=f(M),k=f(p),P=f(d),S=f(y),I=M.map(t=>t/(F+1e-12)),N=p.map(t=>t/(k+1e-12)),T=d.map(t=>t/(P+1e-12)),z=y.map(t=>t/(S+1e-12)),_=h(I.slice(0,A),o),R=h(N.slice(0,A),o),q=h(T.slice(0,A),o),B=h(z.slice(0,A),o),L=Math.min(_.length,R.length,q.length,B.length);_.length=L,R.length=L,q.length=L,B.length=L;const C=new Array(L),D=new Array(L),E=new Array(L);for(let t=0;t<L;t++){const n=Math.abs(_[t]),e=Math.abs(R[t]),r=Math.abs(q[t]),o=Math.abs(B[t]);C[t]=n+e+r,D[t]=n+e+r+o,E[t]=e+r+o}const O=t=>{const n=new Array(t.length+1);n[0]=t[0]/2;for(let e=0;e<t.length-1;e++)n[e+1]=(t[e]+t[e+1])/2;return n[n.length-1]=t[t.length-1]/2,n},Q=O(C),H=O(D),W=O(E),K=(t=>{const n=[];for(let e=1;e<t.length-1;e++)t[e]>=t[e-1]&&t[e]>t[e+1]&&n.push(e);return n})(Q);if(!K.length)return[];const V=Math.max(1,Math.round(16)),G=[];for(const t of K){const n=s(t*o,0,A-1);-1!==g(v,n-64,n+64)&&G.push(t)}if(!G.length)return[];const j=G.reduce((t,n)=>t+H[n],0)/G.length;let U=.9*j,$=1.1*j;function J(t,n,e,r,o){let l=e,s=r,h=r,i=e;const c=[],f=[],u=[],g=[];for(let m=0;m<n.length;m++){const e=n[m],r=Math.min(1,Math.max(0,(t[e]-l)/Math.max(a,s-l)));u.push(r),r>o?(c.push(e),g.push(1),h+=t[e],s=h/(c.length+1)):(f.push(e),g.push(0),i+=t[e],l=i/(f.length+1))}return{Signal:c,Noise:f,VDs:u,Class:g}}const X=J(H,G,U,$,l),Y=J(H,G,U,$,.7),Z=G.map((t,n)=>{const e=X.Class[n],r=Y.Class[n];return 1===e&&1===r?1:0===e&&0===r?0:1===e&&0===r?(X.VDs[n]-l)/.92>(.7-Y.VDs[n])/.7?1:0:1}),tt=[],nt=[];for(let t=0;t<G.length;t++)(Z[t]?tt:nt).push(G[t]);let et=tt.length?tt.reduce((t,n)=>t+W[n],0)/tt.length:G.reduce((t,n)=>t+W[n],0)/G.length,rt=nt.length?nt.reduce((t,n)=>t+W[n],0)/nt.length:G.reduce((t,n)=>t+W[n],0)/G.length*.5;const ot=[],lt=[];for(let t=0;t<G.length;t++){const n=G[t],e=Math.min(1,Math.max(0,(W[n]-rt)/Math.max(a,et-rt)));1===Z[t]||e>.3?(ot.push(n),et=i(et,W[n])):(lt.push(n),rt=i(rt,W[n]))}const at=ot.slice(),st=[];for(let t=0;t<ot.length-1;t++)st.push(ot[t+1]-ot[t]);const ht=((t,n)=>{const e=new Array(t.length).fill(0);let r=0;for(let o=0;o<t.length;o++)r+=t[o],o>=n&&(r-=t[o-n]),e[o]=r/Math.min(o+1,n);return e})(st,100);for(let t=0;t<st.length;t++)if(st[t]>1.5*(ht[t]||st[t])){const n=ot[t],e=ot[t+1];for(const t of lt)t>n&&t<e&&Math.min(1,Math.max(0,(W[t]-rt)/Math.max(a,et-rt)))>.2&&at.push(t)}at.sort((t,n)=>t-n);const it=[];for(const t of at){const n=s(t*o,0,A-1),e=s(n-64,0,A-1),r=s(n+64,0,A-1);let l=e,a=u(e,I,N,T,z);for(let t=e;t<=r;t++){const n=u(t,I,N,T,z);n>a&&(a=n,l=t)}const h=g(v,l-V,l+V);-1!==h&&it.push(h)}let ct=[...new Set(it)].sort((t,n)=>t-n);const ft=Math.round(100);if(ct.length>1){const t=new Array(ct.length).fill(!0);for(let n=0;n<ct.length-1;n++){if(!t[n])continue;const e=n+1;ct[e]-ct[n]<ft&&(v[ct[n]]<v[ct[e]]?t[n]=!1:t[e]=!1)}ct=ct.filter((n,e)=>t[e]).sort((t,n)=>t-n)}const ut=t=>Math.min(1,Math.max(0,(W[t]-rt)/Math.max(a,et-rt)));let gt=function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!n.length)return.2;const r=t(n,"min"),o=t(n,"max");if(o-r<1e-12)return r;const l=new Array(e).fill(0);for(const t of n)l[Math.max(0,Math.min(e-1,Math.floor((t-r)/(o-r+1e-12)*e)))]++;const a=n.length,s=new Array(e).fill(0),h=new Array(e).fill(0);s[0]=l[0],h[0]=0*l[0];for(let t=1;t<e;t++)s[t]=s[t-1]+l[t],h[t]=h[t-1]+t*l[t];const i=h[e-1];let c=0,f=-1;for(let t=0;t<e-1;t++){const n=s[t],e=a-n;if(0===n||0===e)continue;const r=h[t]/n,o=(i-h[t])/e,l=n*e*(r-o)*(r-o);l>f&&(f=l,c=t)}return r+(c+.5)*(o-r)/e}(G.map(ut));gt=Math.max(.1,Math.min(.15,.8*gt));const mt=ct.map(t=>v[t]),Mt=c(mt)||1,pt=ct.map(t=>m(v,t,r)),dt=.4*(c(pt)||1);function yt(t){if(!ct.length)return Mt;let n=0,e=ct.length-1,r=ct.length;for(;n<=e;){const o=n+e>>1;ct[o]>=t?(r=o,e=o-1):n=o+1}const o=Math.max(0,r-3),l=Math.min(ct.length-1,r+3),a=[];for(let s=o;s<=l;s++)a.push(v[ct[s]]);return c(a)||Mt}const At=[];for(const t of lt){const n=s(t*o,0,A-1),e=s(n-64,0,A-1),l=s(n+64,0,A-1);let a=e,h=u(e,I,N,T,z);for(let t=e;t<=l;t++){const n=u(t,I,N,T,z);n>h&&(h=n,a=t)}const i=g(v,a-V,a+V);if(-1===i)continue;const c=ut(t)>=gt,f=yt(i),M=v[i]>=.03*f,p=m(v,i,r)>=dt;if(!(c&&M&&p))continue;let d=1/0,y=0,x=ct.length-1;for(;y<=x;){const t=y+x>>1,n=i-ct[t];d=Math.min(d,Math.abs(n)),n<0?x=t-1:y=t+1}d>=Math.round(.9*ft)&&At.push(i)}if(At.length&&(ct=[...new Set(ct.concat(At))].sort((t,n)=>t-n),ct.length>1)){const t=new Array(ct.length).fill(!0);for(let n=0;n<ct.length-1;n++){if(!t[n])continue;const e=n+1;ct[e]-ct[n]<ft&&(v[ct[n]]<v[ct[e]]?t[n]=!1:t[e]=!1)}ct=ct.filter((n,e)=>t[e])}return ct}(r,a(r).filtered);return{filteredSignal1:o(l),filteredSignal2:o(s),filteredSignal3:o(h),filteredSignal4:o(i),peaks:{series:e.map((t,n)=>[t,c.includes(n)?50:0]),data:c}}};function h(t,n){const e=Math.min(3*(n.length-1),t.length-1),r=function(t,n){const e=t.length,r=new Float64Array(e+2*n);for(let a=0;a<n;a++){var o;r[n-1-a]=null!==(o=t[a+1])&&void 0!==o?o:t[0]}for(let a=0;a<e;a++)r[n+a]=t[a];for(let a=0;a<n;a++){var l;r[n+e+a]=null!==(l=t[e-2-a])&&void 0!==l?l:t[e-1]}return r}(t,e),o=i(r,n);o.reverse();const l=i(o,n);return l.reverse(),l.subarray(e,e+t.length)}function i(t,n){const e=t.length,r=n.length,o=new Float64Array(e);for(let l=0;l<e;l++){let e=0;for(let o=0;o<r;o++){const r=l-o;r>=0&&(e+=n[o]*t[r])}o[l]=e}return o}function c(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{fs:e=400,band:r=[5,20],firTaps:o=81,mwiSec:l=.12,refractorySec:a=.2,refineSec:s=.08}=n,i=t instanceof Float64Array?t:Float64Array.from(t),c=i.length;if(0===c)return{indices:[],stages:{}};const f=new Float64Array(c),u=new Float64Array(c),g=new Float64Array(c),m=new Float64Array(c),M=new Float64Array(c).fill(NaN),p=function(t,n,e,r){const o=r,l=(o-1)/2,a=new Float64Array(o);for(let h=0;h<o;h++){const r=h-l,s=.54-.46*Math.cos(2*Math.PI*h/(o-1)),i=n=>0===r?2*n/t:Math.sin(2*Math.PI*n*r/t)/(Math.PI*r);a[h]=(i(e)-i(n))*s}const s=a.reduce((t,n)=>t+n,0);for(let h=0;h<o;h++)a[h]/=s||1;return a}(e,r[0],r[1],o),d=h(i,p);f&&f.set(d);const y=Math.max(1,Math.round(l*e)),A=new Float64Array(5);let x=0,w=0;const b=new Float64Array(y);let v=0,F=0,k=0;const P=Math.max(y+1,Math.round(3*e)),S=new Float64Array(P);let I=0,N=0,T=0,z=!1,_=0,R=0;const q=Math.round(2*e),B=[];let L=-1/0;const C=[];let D=0,E=0,O=0,Q=!1;for(let h=0;h<c;h++){A[x]=d[h],x=(x+1)%5,w++;let t=0;if(w>=5){const n=(x+3)%5,e=(x+1)%5,r=(x+0)%5;t=(2*A[(x+4)%5]+A[n]-A[e]-2*A[r])/8}u&&(u[h]=t);const n=t*t;g&&(g[h]=n),k<y?(F+=n,b[v]=n,v=(v+1)%y,k++):(F+=n-b[v],b[v]=n,v=(v+1)%y);const r=F/Math.min(y,k||1);if(m&&(m[h]=r),k<y)continue;const o=F/y;if(S[h%P]=o,Q)if(D=E,E=O,O=o,z){if(M&&(M[h]=T),E>D&&E>=O){const t=h-1,n=C.length?C.reduce((t,n)=>t+n,0)/C.length:Math.round(.8*e),r=Math.round(1.6*n);if(t-L>r){const n=Math.max(L+Math.max(1,Math.round(.2*e)),t-r),o=t-Math.max(1,Math.round(.08*e));let l=-1/0,a=-1;for(let t=n;t<o;t++){const n=S[t%P];n>l&&(l=n,a=t)}a>=0&&l>=.5*T&&H(a,l)}E>=T&&t-L>=Math.max(1,Math.round(.2*e))?H(t,E):(N=.125*E+.875*N,T=N+.2*(I-N))}}else _=Math.max(_,E),++R>=q&&(I=.25*_,N=.125*_,T=N+.2*(I-N),z=!0),M&&(M[h]=z?T:h>0?M[h-1]:0);else D=E=O=o,Q=!0}return{indices:B,bandpass:f,differentiated:u,squared:g,mwi:m};function H(t,r){var o;const l=Math.round((y-1)/2+2),a=Math.max(1,Math.round((null!==(o=n.refineSec)&&void 0!==o?o:.08)*e));let s=t-l;s<0&&(s=0),s>=c&&(s=c-1);const h=Math.max(0,s-a),i=Math.min(c-1,s+a);let f=-1,u=-1/0;for(let n=h;n<=i;n++){const t=d[n];t>0&&t>u&&(u=t,f=n)}if(f<0)return N=.125*r+.875*N,void(T=N+.2*(I-N));if(f>0&&f<c-1){const t=d[f-1],n=d[f],e=d[f+1],r=t-2*n+e;if(0!==r){const o=.5*(t-e)/r,l=Math.round(f+Math.max(-1,Math.min(1,o)));l>=h&&l<=i&&d[l]>=n&&d[l]>0&&(f=l)}}B.push(f),L>-1/0&&(C.push(f-L),C.length>8&&C.shift()),L=f,I=.125*r+.875*I,T=N+.2*(I-N)}}function f(n){const e=Array.from(n).map(Number),r=e.length,o=t=>t.reduce((t,n)=>t+n,0)/t.length,l=t=>{const n=o(t);return t.reduce((t,e)=>t+(e-n)**2,0)/t.length},a=t=>{const n=t.sort((t,n)=>t-n),e=n.length;if(!e)return 0;const r=e>>1;return e%2?n[r]:.5*(n[r-1]+n[r])},s=(t,n)=>{if(1===n)return 0;const e=2*n-2;let r=(t%e+e)%e;return r>=n?e-r:r};function h(t,n){if(n<=1)return t.slice();const e=new Array(t.length),r=Math.floor((n-1)/2);for(let o=0;o<t.length;o++){const l=new Array(n),h=o-r;for(let e=0;e<n;e++)l[e]=t[s(h+e,t.length)];e[o]=a(l)}return e}function i(t,n,e){const r=t.length;if(!r)return e.map(()=>0);if(1===r)return e.map(()=>n[0]);if(2===r){const[r,o]=t,[l,a]=n,s=(a-l)/(o-r||1e-12);return e.map(t=>l+s*(t-r))}const o=Array.from({length:r-1},(n,e)=>t[e+1]-t[e]),l=new Array(r).fill(0);for(let u=1;u<r-1;u++)l[u]=3/o[u]*(n[u+1]-n[u])-3/o[u-1]*(n[u]-n[u-1]);const a=new Array(r),s=new Array(r),h=new Array(r);a[0]=1,s[0]=h[0]=0;for(let u=1;u<r-1;u++)a[u]=2*(t[u+1]-t[u-1])-o[u-1]*s[u-1],s[u]=o[u]/(a[u]||1e-12),h[u]=(l[u]-o[u-1]*h[u-1])/(a[u]||1e-12);a[r-1]=1,h[r-1]=0;const i=new Array(r-1),c=new Array(r),f=new Array(r-1);c[r-1]=0;for(let u=r-2;u>=0;u--)c[u]=h[u]-s[u]*(c[u+1]||0),i[u]=(n[u+1]-n[u])/(o[u]||1e-12)-o[u]*(c[u+1]+2*c[u])/3,f[u]=(c[u+1]-c[u])/(3*(o[u]||1e-12));return e.map(e=>{let o=0;if(e<=t[0])o=0;else if(e>=t[r-1])o=r-2;else for(let n=0;n<r-1;n++)if(e>=t[n]&&e<=t[n+1]){o=n;break}const l=e-t[o];return n[o]+i[o]*l+c[o]*l*l+f[o]*l*l*l})}function c(t){const n=[],e=[],r=t.length;for(let o=1;o<r-1;o++)t[o]>t[o-1]&&t[o]>=t[o+1]&&n.push(o),t[o]<t[o-1]&&t[o]<=t[o+1]&&e.push(o);return r>=2&&(t[0]>t[1]&&n.unshift(0),t[0]<t[1]&&e.unshift(0),t[r-1]>t[r-2]&&n.push(r-1),t[r-1]<t[r-2]&&e.push(r-1)),{maxima:n,minima:e}}function f(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;const r=[],a=t.length;let s=t.slice();const h=.05*Math.max(1e-12,(f=t,Math.sqrt(l(f))));for(var f;r.length<n;){const t=c(s);if(t.maxima.length+t.minima.length<2)break;let n=s.slice(),l=0;for(;l<e;){const t=c(n);if(t.maxima.length+t.minima.length<2)break;const e=t.maxima.length>=2?i(t.maxima,t.maxima.map(t=>n[t]),Array.from({length:a},(t,n)=>n)):Array(a).fill(t.maxima.length?n[t.maxima[0]]:0),r=t.minima.length>=2?i(t.minima,t.minima.map(t=>n[t]),Array.from({length:a},(t,n)=>n)):Array(a).fill(t.minima.length?n[t.minima[0]]:0),s=new Array(a);for(let n=0;n<a;n++)s[n]=.5*(e[n]+r[n]);const f=new Array(a);for(let o=0;o<a;o++)f[o]=n[o]-s[o];if(o(s.map(Math.abs))<h){n=f;break}n=f,l++}r.push(n.slice());for(let e=0;e<a;e++)s[e]-=n[e];const f=c(s);if(f.maxima.length+f.minima.length<2)break}return r.push(s.slice()),r}function u(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const e=new Array(t);for(let r=0;r<t;r+=2){const o=Math.random()||1e-12,l=Math.random(),a=Math.sqrt(-2*Math.log(o)),s=a*Math.cos(2*Math.PI*l),h=a*Math.sin(2*Math.PI*l);e[r]=s*n,r+1<t&&(e[r+1]=h*n)}return e}let g=e.slice();const m=o(g);for(let t=0;t<r;t++)g[t]-=m;const M=t(g.map(t=>Math.abs(t)),"max")||1e-12;for(let t=0;t<r;t++)g[t]/=M;const p=h(g,Math.max(1,Math.round(240))),d=h(g,Math.max(1,Math.round(80))),y=new Array(r);for(let t=0;t<r;t++)y[t]=g[t]-.5*p[t]-.5*d[t];const A=[],x=.2*(Math.max(y.map(Math.abs))||1e-12);for(let t=0;t<r;t++)Math.abs(y[t])>x&&A.push(y[t]);const w=(A.length?a(A):o(y))<0?y.map(t=>-t):y.slice(),b=function(t,n,e,r,o){const l=t.length,a=[];let s=0;for(let i=0;i<e;i++){const e=u(l,n),h=new Array(l);for(let n=0;n<l;n++)h[n]=t[n]+e[n];const i=f(h,r,o);a.push(i),i.length>s&&(s=i.length)}const h=[];for(let i=0;i<s;i++){const t=new Array(l).fill(0);let n=0;for(let r=0;r<e;r++){const e=a[r];if(i<e.length){const r=e[i];for(let n=0;n<l;n++)t[n]+=r[n];n++}}if(n)for(let e=0;e<l;e++)t[e]/=n;h.push(t)}return h}(w,2*Math.sqrt(l(w)),10,10,100),v=Math.min(4,b.length),F=new Array(r).fill(0);for(let t=0;t<v;t++)for(let n=0;n<r;n++)F[n]+=b[t][n];const k=F.map(t=>t>0?t:0),P=k.filter(t=>t>0),S=P.length?o(P):0,I=P.length?Math.sqrt(l(P)):0;const N=function(t,n,e,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;const l=t.length,a=[];for(let i=1;i<l-1;i++)t[i]>0&&t[i]>t[i-1]&&t[i]>=t[i+1]&&t[i]>=n&&a.push({idx:i,val:t[i]});a.sort((t,n)=>n.val-t.val);const s=[];for(const i of a)s.some(t=>Math.abs(t-i.idx)<e)||s.push(i.idx);const h=[];for(const i of s){const n=Math.max(0,i-o),e=Math.min(l-1,i+o);let a=t[i],s=t[i];for(let r=n;r<=i;r++)t[r]<a&&(a=t[r]);for(let r=i;r<=e;r++)t[r]<s&&(s=t[r]);const c=t[i]-Math.max(a,s);c>=(r||0)&&h.push({idx:i,val:t[i],prom:c})}return h.sort((t,n)=>t.idx-n.idx)}(k,S+2*I,Math.round(80),.5*I);return{locs:N.map(t=>t.idx),y_signal:F,y_pos:k}}const u=(t,n)=>{const e=t[0].data.map(t=>t[0]),r=t[0].data.map(t=>t[1]),o=t=>e.map((n,e)=>[n,t.includes(e)?100:0]);let l;if(1===n){const t=function(t,n){const e=Math.max(1,Math.floor(.1*n)),r=0|t.length;if(r<3)return[];const o=t instanceof Float32Array?t:new Float32Array(t),l=t=>new Float32Array(t);function a(t){let n=0,e=t[0];for(let o=1;o<r;o++){const r=t[o];(e>=0&&r<0||e<0&&r>=0)&&n++,e=r}return n}function s(t){let n=0;for(let e=1;e<r-1;e++){const r=t[e-1],o=t[e],l=t[e+1];(o>r&&o>l||o<r&&o<l)&&n++}return n}function h(t,n,e){if(0===n.length)return void e.fill(t[0]);const o=n[0],l=t[o];for(let r=0;r<o;r++)e[r]=l;for(let r=0;r<n.length-1;r++){const o=n[r],l=n[r+1],a=t[o],s=t[l],h=(s-a)/(l-o);let i=a;e[o]=a;for(let t=o+1;t<l;t++)i+=h,e[t]=i;e[l]=s}const a=n[n.length-1],s=t[a];for(let h=a+1;h<r;h++)e[h]=s}function i(t,n,e,o){const l=[],a=[];for(let s=1;s<r-1;s++){const n=t[s-1],e=t[s],r=t[s+1];e>n&&e>r?l.push(s):e<n&&e<r&&a.push(s)}if(l.length+a.length<2)return!1;t[0]>t[1]?l.unshift(0):t[0]<t[1]&&a.unshift(0),t[r-1]>t[r-2]?l.push(r-1):t[r-1]<t[r-2]&&a.push(r-1),h(t,l,n),h(t,a,e);for(let s=0;s<r;s++)o[s]=.5*(n[s]+e[s]),t[s]=t[s]-o[s];return!0}function c(t,n){let e=0;for(let o=0;o<r;o++){const r=t[o]-n[o];e+=r*r/(t[o]*t[o]+1e-12)}return e}function f(t,n,e,o,h){h.set(t);let f=h,u=l(r),g=!0;for(let r=0;r<8&&(u.set(f),g=i(f,n,e,o),g);r++){const t=c(u,f),n=s(f),e=a(f),r=Math.abs(n-e)<=1;if(t<.2&&r)break}if(!g)return{imf:null,residue:t};const m=l(r);for(let l=0;l<r;l++)m[l]=f[l],t[l]=t[l]-m[l];return{imf:m,residue:t}}const u=l(r),g=l(r),m=l(r),M=l(r);let p=l(r);p.set(o);const d=[];for(let C=0;C<10;C++){const{imf:t,residue:n}=f(p,u,g,m,M);if(p=n,!t)break;if(d.push(t),s(p)<2)break}if(0===d.length)return[];const y=d.length,A=Math.min(1,y-1),x=Math.max(y-1,A+1),w=l(r);let b=0;for(let C=A;C<x;C++){w.set(d[C],0),b=1;break}for(let C=A+1;C<x&&b<5;C++,b++){const t=d[C];for(let n=0;n<r;n++)w[n]+=t[n]}0===b&&w.set(d[0]);const v=[],F=[];for(let C=1;C<r-1;C++){const t=w[C-1],n=w[C],e=w[C+1];n>t&&n>e&&n>0&&(v.push(C),F.push(n))}if(0===v.length)return[];let k=-1/0;for(let C=0;C<F.length;C++)F[C]>k&&(k=F[C]);const P=F.slice().sort((t,n)=>t-n),S=P.length%2?P[P.length-1>>1]:.5*(P[P.length/2-1]+P[P.length/2]),I=Math.max(.3*k,.6*S),N=[],T=[];for(let C=0;C<v.length;C++)F[C]>=I&&(N.push(v[C]),T.push(F[C]));if(0===N.length)return[];const z=[],_=[];let R=N[0],q=T[0];for(let C=1;C<N.length;C++){const t=N[C],n=T[C];t-R<e?n>q&&(R=t,q=n):(z.push(R),_.push(q),R=t,q=n)}z.push(R),_.push(q);const B=[];for(let C=0;C<z.length;C++){const t=z[C];let n=t,e=o[t];const l=Math.max(0,t-3),a=Math.min(r-1,t+3);for(let r=l;r<=a;r++){const t=o[r];t>e&&(e=t,n=r)}e>0&&B.push(n)}B.sort((t,n)=>t-n);const L=[];for(let C=0;C<B.length;C++)0!==C&&B[C]===B[C-1]||L.push(B[C]);return L}(r,400);l={peaks:o(t),data:t}}else if(2===n){const t=c(r);l={peaks:o(t.indices),data:t.indices}}else if(3===n){const t=f(r);l={peaks:o(t.locs),data:t.locs}}return l};function g(t){return t instanceof Float32Array?t:Float32Array.from(t)}function m(t){return t%2===0?t+1:t}function M(t,n,e){const r=2*Math.PI*t/n,o=Math.cos(r),l=Math.sin(r)/(2*e);let a=(1+o)/2,s=-(1+o),h=(1+o)/2,i=1+l,c=-2*o,f=1-l;return a/=i,s/=i,h/=i,c/=i,f/=i,{b0:a,b1:s,b2:h,a1:c,a2:f}}function p(t,n,e){if(2===e)return[M(t,n,1/Math.SQRT2)];return[.5411961,1.30656296].map(e=>M(t,n,e))}function d(t,n){let e=new Float32Array(t.length);t=g(t);for(let r=0;r<n.length;r++){const{b0:o,b1:l,b2:a,a1:s,a2:h}=n[r];let i=0,c=0;for(let n=0;n<t.length;n++){const r=t[n],f=o*r+i;i=l*r-s*f+c,c=a*r-h*f,e[n]=f}r<n.length-1&&(t=e,e=new Float32Array(t.length))}return e}function y(t,n){const e=t.length,r=new Float32Array(e+2*n);for(let o=0;o<n;o++)r[o]=2*t[0]-t[n-o];r.set(t,n);for(let o=0;o<n;o++)r[n+e+o]=2*t[e-1]-t[e-2-o];return r}function A(t,n){const e=t.length,r=Math.max(1,Math.min(6*n.length,e-1));let o=d(y(t,r),n);return o.reverse(),o=d(o,n),o.reverse(),o.subarray(r,r+e).slice()}function x(t,n,e){const r=2*Math.PI*t/n,o=Math.cos(r),l=Math.sin(r)/(2*e);let a=(1-o)/2,s=1-o,h=(1-o)/2,i=1+l,c=-2*o,f=1-l;return a/=i,s/=i,h/=i,c/=i,f/=i,{b0:a,b1:s,b2:h,a1:c,a2:f}}function w(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=Math.abs(t[r]-n);return e}function b(t,n){const e=t.length;if(0===e)return NaN;if(n<=0)return function(t){let n=1/0;for(let e=0;e<t.length;e++)t[e]<n&&(n=t[e]);return n}(t);if(n>=1)return function(t){let n=-1/0;for(let e=0;e<t.length;e++)t[e]>n&&(n=t[e]);return n}(t);const r=Float32Array.from(t),o=(e-1)*n,l=Math.floor(o),a=o-l,s=v(r,l);if(0===a)return s;return s+(v(r,l+1)-s)*a}function v(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1;for(;;){if(e===r)return t[e];const o=e+(r-e>>1);t[r]<t[e]&&F(t,e,r),t[o]<t[e]&&F(t,o,e),t[r]<t[o]&&F(t,r,o);let l=t[o],a=e,s=r;for(;a<=s;){for(;t[a]<l;)a++;for(;t[s]>l;)s--;a<=s&&(F(t,a,s),a++,s--)}if(n<=s)r=s;else{if(!(n>=a))return t[n];e=a}}}function F(t,n,e){const r=t[n];t[n]=t[e],t[e]=r}function k(t,n){const e=t.length;if(e<=n)return g(t);const r=Math.max(1,Math.floor(e/n)),o=Math.random()*r|0,l=Math.ceil((e-o)/r),a=new Float32Array(Math.min(n,l));for(let s=o,h=0;s<e&&h<a.length;s+=r,h++)a[h]=t[s];return a}function P(t,n){if(n<3)return g(t).slice();const e=y(t,(n=m(n))-1>>1),r=t.length,o=new Float64Array(e.length+1);for(let a=0;a<e.length;a++)o[a+1]=o[a]+e[a];const l=new Float32Array(r);for(let a=0;a<r;a++){const t=o[a+n]-o[a];l[a]=t/n}return l}function S(t,n){return Math.max(1,Math.round(n*t/1e3))}function I(t){return t.length?b(Float32Array.from(t),.5):0}function N(t,n){t.push(n),t.length>8&&t.shift()}function T(t,n,e){return t<n?n:t>e?e:t}function z(t,n,e){const r=n;let o=0;for(let l=Math.max(1,n-e);l<=r;l++){const n=Math.abs(t[l]-t[l-1]);n>o&&(o=n)}return o}function _(t){const n=Array.from(t);n.sort((t,n)=>t-n);const e=[];let r=null;for(let o=0;o<n.length;o++){const t=0|n[o];null!==r&&t===r||(e.push(t),r=t)}return Int32Array.from(e)}function R(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=Math.abs(t[r]-n);return e}function q(t,n,e,r){let o=n,l=t[n];for(let a=n+1;a<=e;a++){const n=t[a];(n>l||n===l&&Math.abs(a-r)<Math.abs(o-r)||n===l&&Math.abs(a-r)===Math.abs(o-r)&&a<o)&&(l=n,o=a)}return o}function B(t,n,e){const r=Math.max(1,n-e),o=Math.min(t.length-2,n+e);let l=-1,a=1e9;for(let s=r;s<=o;s++){const e=t[s]-t[s-1],r=t[s+1]-t[s],o=t[s+1]-2*t[s]+t[s-1];if(e>0&&r<=0&&o<0){const t=Math.abs(s-n);t<a&&(l=s,a=t)}}return l>=0?l:n}function L(t,n,e){const r=e-1>>1,o=Math.max(0,n-r),l=Math.min(t.length-1,n+r),a=t.subarray?t.subarray(o,l+1):t.slice(o,l+1),s=b(a,.5),h=b(R(a,s),.5)||0,i=Math.max(.03,1.5*h),c=n-o,f=b(a.subarray?a.subarray(0,Math.max(1,c)):a.slice(0,Math.max(1,c)),.5),u=b(a.subarray?a.subarray(Math.min(a.length-1,c+1)):a.slice(Math.min(a.length-1,c+1)),.5),g=Math.max(f,u);return t[n]>=g+i}function C(t,n,e,r){const o=Math.max(1,n-e),l=Math.min(t.length-1,n+r);let a=0,s=0;for(let c=o;c<=n;c++){const n=t[c]-t[c-1];0!==n&&(s++,n>0&&a++)}let h=0,i=0;for(let c=n+1;c<=l;c++){const n=t[c]-t[c-1];0!==n&&(i++,n<0&&h++)}return(s?a/s:0)>=.55&&(i?h/i:0)>=.55}function D(t,n){if(n<3)return t.slice();const e=function(t,n){n=m(n);const e=t.length-n+1;if(e<=0)return new Float32Array(0);function r(t){this.cmp=t,this.a=[]}r.prototype.size=function(){return this.a.length},r.prototype.peek=function(){return this.a[0]},r.prototype.push=function(t){const n=this.a;n.push(t);let e=n.length-1;for(;e>0;){const t=e-1>>1;if(!this.cmp(n[e],n[t]))break;const r=n[e];n[e]=n[t],n[t]=r,e=t}},r.prototype.pop=function(){const t=this.a,n=t[0],e=t.pop();if(t.length){t[0]=e;let n=0;for(;;){let e=2*n+1,r=e+1,o=n;if(e<t.length&&this.cmp(t[e],t[o])&&(o=e),r<t.length&&this.cmp(t[r],t[o])&&(o=r),o===n)break;const l=t[n];t[n]=t[o],t[o]=l,n=o}}return n};const o=new r((t,n)=>t.val>n.val||t.val===n.val&&t.idx>n.idx),l=new r((t,n)=>t.val<n.val||t.val===n.val&&t.idx<n.idx),a=new Map;let s=0,h=0;function i(t){for(;t.size();){const n=t.peek(),e=a.get(n.idx);if(!e)break;1===e?a.delete(n.idx):a.set(n.idx,e-1),t.pop()}}function c(){s>h+1?(i(o),l.push(o.pop()),s--,h++,i(o)):s<h&&(i(l),o.push(l.pop()),s++,h--,i(l))}function f(t,n){!o.size()||t<=o.peek().val?(o.push({val:t,idx:n}),s++):(l.push({val:t,idx:n}),h++),c()}function u(t,n){a.set(n,(a.get(n)||0)+1),o.size()&&t<=o.peek().val?s--:h--,i(o),i(l),c()}const g=new Float32Array(e);for(let m=0;m<n;m++)f(t[m],m);i(o),g[0]=o.peek().val;for(let m=n;m<t.length;m++){f(t[m],m);const e=m-n;u(t[e],e),i(o),g[m-n+1]=o.peek().val}return g}(y(t,(n=m(n))-1>>1),n);return e.subarray(0,t.length).slice()}function E(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null!=e.hp?e.hp:8,o=null!=e.lp?e.lp:40,l=2===e.orderHP?2:4,a=2===e.orderLP?2:4,s=g(t);if(s.length<4)return s.slice();const h=p(r,n,l),i=function(t,n,e){return 2===e?[x(t,n,1/Math.SQRT2)]:[.5411961,1.30656296].map(e=>x(t,n,e))}(o,n,a);return A(s,h.concat(i))}function O(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=g(t),r=e.length;if(!r)return n.returnStats?{signal:new Float32Array(0),stats:{}}:new Float32Array(0);const o=n.center||"median",l=n.scale||"mad",a=k(e,null!=n.maxSample?n.maxSample:2e5),s="mean"===o?function(t){let n=0,e=t.length;for(let r=0;r<e;r++)n+=t[r];return n/Math.max(1,e)}(a):b(a,.5);let h,i={centerMode:o,scaleMode:l,center:s};if("none"===l)h=1;else if("std"===l)h=function(t,n){let e=0,r=t.length;for(let o=0;o<r;o++){const r=t[o]-n;e+=r*r}return Math.sqrt(e/Math.max(1,r))}(a,s);else if("iqr"===l){const t=b(a,.25),n=b(a,.75);i.q1=t,i.q3=n,h=Math.max(1e-12,(n-t)/1.349)}else if("p95"===l){const t=b(w(a,s),.95);i.p95abs=t,h=Math.max(1e-12,t)}else{const t=b(w(a,s),.5);i.mad=t,h=Math.max(1e-12,1.4826*t)}const c=1/(h||1),f=new Float32Array(r);if(null!=n.clipNsigma&&isFinite(n.clipNsigma)){const t=Math.abs(n.clipNsigma);for(let n=0;n<r;n++){let r=(e[n]-s)*c;r>t&&(r=t),r<-t&&(r=-t),f[n]=r}i.clipNsigma=t}else for(let u=0;u<r;u++)f[u]=(e[u]-s)*c;return i.scale=h,n.returnStats?{signal:f,stats:i}:f}function Q(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=g(t),o=r.length;if(!o)return new Float32Array(0);const l="diff1"===(e.deriv||"diff5")?function(t){const n=t.length,e=y(t,1),r=new Float32Array(n);for(let o=0;o<n;o++){const t=o+1;r[o]=.5*(e[t+1]-e[t-1])}return r}(r):function(t){const n=t.length,e=y(t,2),r=new Float32Array(n);for(let o=0;o<n;o++){const t=o+2;r[o]=.125*(-e[t-2]-2*e[t-1]+2*e[t+1]+e[t+2])}return r}(r);for(let a=0;a<o;a++)l[a]=l[a]*l[a];return P(l,m(Math.max(3,Math.round((null!=e.mwiMs?e.mwiMs:150)*n/1e3))))}function H(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=g(t),l=o.length,a=function(t){if(t instanceof Int32Array)return t;const n=new Int32Array(t.length);for(let e=0;e<t.length;e++)n[e]=0|t[e];return n}(n),s=S(e,null!=r.winMs?r.winMs:75),h=Math.max(1,null!=r.microWin?r.microWin:3),i=S(e,40),c=S(e,40),f=Math.max(21,1|S(e,200)),u=Math.max(2,S(e,12)),m=r.xBandpass&&r.xBandpass.length===l?r.xBandpass:o,M=[];for(let g=0;g<a.length;g++){const t=T(a[g],0,l-1),n=Math.max(0,t-s),e=Math.min(l-1,t+s),r=q(m,n,e,t);let p=q(o,Math.max(n,r-h),Math.min(e,r+h),r);p=B(m,p,u),p<1||p>l-2||L(o,p,f)&&C(m,p,i,c)&&M.push(p)}return Int32Array.from(M)}function W(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=g(t),o=r.length;if(!o)return new Float32Array(0);const l=y(r,1),a=new Float32Array(o);for(let s=0;s<o;s++){const t=l[s+1],n=l[s],e=l[s+2];a[s]=Math.abs(t*t-n*e)}return P(a,m(Math.max(3,Math.round((null!=e.winMs?e.winMs:120)*n/1e3))))}function K(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=400,r=t[0].data.map(t=>t[1]),o=t[0].data.map(t=>t[0]),l=g(r),a=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.method||"hp",o=g(t);if(o.length<4)return e.returnBaseline?{signal:o.slice(),baseline:new Float32Array(o.length)}:o.slice();if("median"===r){const t=m(Math.max(3,Math.round(e.win1Ms?e.win1Ms*n/1e3:.2*n))),r=m(Math.max(3,Math.round(e.win2Ms?e.win2Ms*n/1e3:.6*n))),l=D(o,t),a=D(l,r),s=new Float32Array(o.length);for(let n=0;n<o.length;n++)s[n]=o[n]-a[n];return e.returnBaseline?{signal:s,baseline:a}:s}const l=A(o,p(null!=e.hpHz?e.hpHz:.7,n,2===e.order?2:4));if(e.returnBaseline){const t=new Float32Array(o.length);for(let n=0;n<o.length;n++)t[n]=o[n]-l[n];return{signal:l,baseline:t}}return l}(l,e,n.baseline||{method:"hp"}),s=E(a,e,n.bandpass||{hp:8,lp:40}),h=O(s,n.normalize||{}).signal||O(s,n.normalize||{}),i=Q(h,e,n.pt||{}),c=W(h,e,n.tkeo||{}),f=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=g(t),o=r.length;if(o<3)return new Int32Array(0);const l=S(n,null!=e.refractoryMs?e.refractoryMs:200),a=Math.min(o,Math.max(1,Math.round((null!=e.initWinSec?e.initWinSec:2)*n))),s=null!=e.thrAlpha?e.thrAlpha:.25,h=null!=e.searchBackFactor?e.searchBackFactor:1.66,i=r.subarray(0,a);let c=b(i,.2),f=b(i,.9),u=c+s*(f-c);const m=[],M=[];let p=-1,d=-1,y=-1/0;const A=[];for(let g=1;g<o-1;g++){if(!(r[g]>r[g-1]&&r[g]>=r[g+1]))continue;const t=g,n=r[g];if(m.length){const n=t-p,e=I(A);e>0&&n>Math.round(h*e)&&d>p+l&&(m.push(d),M.push(y),N(A,d-p),p=d,f=.125*y+.875*f,u=c+s*(f-c),d=-1,y=-1/0)}n>u?(p>=0&&t-p<=l?n>M[M.length-1]&&(m[m.length-1]=t,M[M.length-1]=n,p=t):(m.push(t),M.push(n),p>=0&&N(A,t-p),p=t),f=.125*n+.875*f,u=c+s*(f-c),d=-1,y=-1/0):(c=.125*n+.875*c,u=c+s*(f-c),n>y&&(y=n,d=t))}return Int32Array.from(m)}(i,e,n.pick||{}),u=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=W(t,n,{winMs:e.winMs}),o=k(r,null!=e.maxSample?e.maxSample:2e5),l=b(o,.5),a=b(w(o,l),.5),s=l+(null!=e.k?e.k:4)*(a||0),h=r.length,i=S(n,null!=e.refractoryMs?e.refractoryMs:200),c=[],f=[];let u=-1;for(let m=1;m<h-1;m++)r[m]>r[m-1]&&r[m]>=r[m+1]&&(r[m]<s||(u>=0&&m-u<=i?r[m]>f[f.length-1]&&(c[c.length-1]=m,f[f.length-1]=r[m],u=m):(c.push(m),f.push(r[m]),u=m)));const g=Int32Array.from(c);return e.returnFeature?{indices:g,feature:r,thr:s}:g}(h,e,Object.assign({returnFeature:!1},n.tkeoPick||{})),M=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=S(n,null!=e.mergeTolMs?e.mergeTolMs:100),o=Array.isArray(e.feats)?e.feats:null,l=e.xRef||null,a=[];for(let u=0;u<t.length;u++){const n=_(t[u]||[]);for(let t=0;t<n.length;t++){const e=n[t],r=o&&o[u]&&o[u].length>e?Math.abs(o[u][e]):l&&l.length>e?Math.abs(l[e]):0;a.push({idx:e,src:u,score:r})}}if(!a.length)return e.returnMeta?{indices:new Int32Array(0),meta:[]}:new Int32Array(0);a.sort((t,n)=>t.idx-n.idx);const s=[],h=[];let i=[a[0]];for(let u=1;u<a.length;u++){const t=i[i.length-1],n=a[u];n.idx-t.idx<=r?i.push(n):(f(i,s,h),i=[n])}f(i,s,h);const c=Int32Array.from(s);return e.returnMeta?{indices:c,meta:h}:c;function f(t,n,r){if(!t||!t.length)return;let o=t[0];for(let e=1;e<t.length;e++)t[e].score>o.score&&(o=t[e]);if(n.push(o.idx),e.returnMeta){const n=new Set;for(const e of t)n.add(e.src);r.push({i:o.idx,votes:Array.from(n).length,sources:Array.from(n).sort((t,n)=>t-n)})}}}([f,u],e,{feats:[i,c],xRef:h,mergeTolMs:n.fuse&&n.fuse.mergeTolMs||100,returnMeta:!0}),d=function(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=t instanceof Float32Array?t:Float32Array.from(t);let l=_(n);const a=o.length;if(!l.length)return l;const s=r.feat&&r.feat.length===a?r.feat:null,h=S(e,null!=r.refractoryMs?r.refractoryMs:200),i=S(e,null!=r.minRRMs?r.minRRMs:240),c=S(e,null!=r.tSuppressMs?r.tSuppressMs:200),f=S(e,null!=r.preSlopeMs?r.preSlopeMs:40),u=null!=r.tSlopeFrac?r.tSlopeFrac:.4,g=null!=r.sbFactor?r.sbFactor:1.5,m=null!=r.sbK?r.sbK:3;{const t=[],n=s||o;let e=l[0];for(let r=1;r<l.length;r++){const o=l[r];o-e<i?e=n[e]>=n[o]?e:o:(t.push(e),e=o)}t.push(e),l=Int32Array.from(t)}if(l.length<=1)return l;{const t=[l[0]];for(let n=1;n<l.length;n++){const e=t[t.length-1],r=l[n];if(r-e<=c){const t=z(o,e,f);if(z(o,r,f)<u*t)continue}t.push(r)}l=Int32Array.from(t)}if(l.length<=1)return l;{const t=s||o,n=[l[0]],r=[];for(let o=1;o<l.length;o++){const a=n[n.length-1],s=l[o],i=s-a,c=I(r);if(c>0&&i>Math.round(g*c)){const o=Math.max(a+h,a+1),l=Math.min(s-h,s-1);if(l>o+2){let h=q(t,o,l,o+l>>1);if(h=B(t,h,Math.max(2,S(e,12))),L(t,h,Math.max(21,1|S(e,200)))){const e=t.subarray?t.subarray(o,l+1):t.slice(o,l+1),i=b(e,.5),c=i+m*(b(R(e,i),.5)||0);if(t[h]>c){n.push(h),N(r,h-a),N(r,s-h),n.push(s);continue}}}}N(r,i),n.push(s)}l=_(n)}return l}(h,H(l,M.indices,e,{xBandpass:s,...n.refine||{}}),e,{feat:i,...n.rr||{}}),x=function(t,n,e){const r=g(t),o=_(n),l=r.length;if(!l||!o.length)return new Int32Array(0);const a=Math.max(1,S(e,8)),s=Math.max(1,S(e,40)),h=Math.max(1,S(e,40)),i=Math.max(3,m(S(e,12))),c=Math.max(21,m(S(e,200))),f=function(t,n){const e=t.length,r=n-1>>1,o=y(t,r),l=new Float32Array(e);for(let a=0;a<e;a++){const t=a+r;let e=0;for(let n=1;n<=r;n++)e+=o[t+n]-o[t-n];l[a]=e/n}return l}(r,i),u=[];for(let g=0;g<o.length;g++){const t=0|o[g];if(t<=0||t>=l-1)continue;if(!M(r,t,Math.max(0,t-a),Math.min(l-1,t+a)))continue;const n=Math.max(1,t-s),e=Math.min(l-1,t+h);let i=0,m=0;for(let r=n;r<=t;r++){const t=f[r];0!==t&&(m++,t>0&&i++)}let p=0,d=0;for(let r=t+1;r<=e;r++){const t=f[r];0!==t&&(d++,t<0&&p++)}if((m?i/m:0)<.55||(d?p/d:0)<.55)continue;const y=Math.max(0,t-(c-1>>1)),A=Math.min(l-1,t+(c-1>>1)),x=r.subarray?r.subarray(y,A+1):r.slice(y,A+1),w=b(x,.5),v=b(R(x,w),.5),F=Math.max(.03,1.5*(v||0)),k=t-y,P=b(x.subarray?x.subarray(0,Math.max(1,k)):x.slice(0,Math.max(1,k)),.5),S=b(x.subarray?x.subarray(Math.min(x.length-1,k+1)):x.slice(Math.min(x.length-1,k+1)),.5),I=Math.max(P,S);r[t]-I<F||u.push(t)}return Int32Array.from(u);function M(t,n,e,r){const o=t[n];for(let l=e;l<=r;l++)if(t[l]>o)return!1;return!0}}(h,d,e);return{series:o.map((t,n)=>[t,x.includes(n)?100:0]),data:Array.from(x)}}function V(t){return new Array(t).fill(0)}function G(t){const n=new Array(t);for(let e=0;e<t;e++)n[e]=.54-.46*Math.cos(2*Math.PI*e/(t-1));return n}function j(t){if(0===t)return 1;const n=Math.PI*t;return Math.sin(n)/n}function U(){let{A:t=26,fs:n=400,f1:e=5,f2:r=30}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=n/2;return function(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"hamming";var o;Array.isArray(n)||(e=arguments[2],r=null!==(o=arguments[3])&&void 0!==o?o:"hamming");const l=Array.isArray(n)?n[0]:n,a=Array.isArray(n)?n[1]:e,s=t+1,h=t/2,i=G(s),c=new Array(s);for(let f=0;f<s;f++){const t=f-h,n=2*a*j(2*a*t)-2*l*j(2*l*t);c[f]=n*i[f]}return c}(t,[e/o,r/o])}U({A:26,fs:400,f1:5,f2:30});function $(t){const n=function(t,n){const e=n/2;return t.slice(e,t.length-e)}(function(t,n){const e=t.length,r=n.length,o=V(e+r-1);for(let l=0;l<o.length;l++){let a=0;const s=Math.max(0,l-(r-1)),h=Math.min(l,e-1);for(let e=s;e<=h;e++)a+=t[e]*n[l-e];o[l]=a}return o}(U({A:26,fs:arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,f1:5,f2:30}),t),26),e=n.map(t=>{return(0===(n=t)?0:n>0?1:-1)*t**2;var n}),r=V(e.length);for(let a=0;a<e.length-1;a++)r[a+1]=.99*r[a]+4*(1-.99)*Math.abs(e[a+1]);const o=r.map((t,n)=>(n%2===0?1:-1)*t),l=e.map((t,n)=>t+o[n]);return{filter_signal:n,nonlinear:e,new_signal:l}}const J=t=>{const n=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const e=Math.round(.1*n),r=Math.round(.4*n),o=Math.floor(e/2),l=Math.floor(r/2),a=t.length,s=Array.from(t,Number),h=f(s,o),i=f(h,l),c=new Array(a);for(let u=0;u<a;u++)c[u]=s[u]-i[u];return c;function f(t,n){const e=new Array(t.length);for(let r=0;r<t.length;r++){const o=Math.max(0,r-n),l=Math.min(t.length-1,r+n),a=t.slice(o,l+1).sort((t,n)=>t-n),s=Math.floor(a.length/2);e[r]=a.length%2===1?a[s]:.5*(a[s-1]+a[s])}return e}}(t[0].data.map(t=>t[1]));return n};function X(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const r=n[0].data.map(t=>t[0]),o=n[0].data.map(t=>t[1]),l=t=>r.map((n,e)=>[n,t[e]]),a=J(n),{filter_signal:s,nonlinear:h,new_signal:i}=$(a,e),{finalPeaks:c,D:f}=function(n,e){const r=new Array(n.length).fill(0);for(let t=0;t<n.length-1;t++)r[t+1]=.5*Math.abs(Math.sign(n[t+1])-Math.sign(n[t]));const o=new Array(n.length).fill(0);for(let t=0;t<n.length-1;t++)o[t+1]=.99*o[t]+(1-.99)*r[t+1];const l=new Array(n.length).fill(0);for(let t=0;t<n.length-1;t++)l[t+1]=.97*l[t]+(1-.97)*o[t+1];const a=new Array(o.length).fill(0),s=new Array(o.length).fill(0);for(let t=0;t<r.length;t++)r[t]<l[t]?a[t]=1:s[t]=1;const h=[],i=[];for(let t=0;t<a.length;t++)1===a[t]&&h.push(t),1===s[t]&&i.push(t);const c=[];for(let t=1;t<h.length;t++)c.push(h[t]-h[t-1]);const f=[];for(let t=1;t<i.length;t++)f.push(i[t]-i[t-1]);const u=[];c.forEach((t,n)=>{t>1&&u.push(n)});const g=[];f.forEach((t,n)=>{t>1&&g.push(n)});const m=u.map(t=>h[t+1]),M=g.map(t=>i[t+1]),p=[];for(let t=0;t<m.length;t++)p.push([M[t],m[t]]);const d=[],y=[];for(let t=0;t<p.length-1;t++)y.push(p[t+1][0]-p[t][1]),y[t]<=30?d.push([p[t][0],p[t+1][1]]):(d.push(p[t]),t===p.length-2&&d.push(p[p.length-1]));const A=[],x=[];for(let t=0;t<d.length-1;t++)x.push(d[t+1][0]-d[t][1]),A.push(d[t]),t===d.length-2&&A.push(d[d.length-1]);const w=A.filter(t=>null!==t);for(let t=0;t<A.length-1;t++)w[t][1]===w[t+1][1]&&(A[t+1]=null);const b=A.filter(t=>null!==t),v=[];for(let t=0;t<b.length;t++){const n=b[t][0],e=b[t][1];e-n>=30&&v.push([n,e])}const F=[],k=[];for(let z=0;z<v.length;z++){const[n,r]=v[z],o=e.slice(n,r+1).filter(t=>t>0);F.push(t(o,"max")),k.push(t(o,"min"))}const P=[];for(let t=0;t<v.length;t++)k[t]-F[t]>10?P.push(k[t]):P.push(F[t]);const S=e.map(t=>t>0?t:0),I=[];for(let t=0;t<v.length;t++){const[n,e]=v[t],r=S.slice(n,e+1).findIndex(n=>n===P[t]);I.push(n+r)}const N=I.map(t=>S[t]);let T=[...I];for(let t=0;t<T.length-1;t++){const n=100;T[t+1]-T[t]<n&&(N[t]<N[t+1]?T[t]=null:T[t+1]=null)}return{finalPeaks:T=T.filter(t=>null!==t),d:r,D:o,threshold:l}}(i,h);return{filteredSignal:l(s),nonlinearizedSignal:l(h),HFSignal:l(i),zeroCrossingSignal:l(f),preFiltered:l(a),peaks:{series:r.map((t,n)=>[t,c.includes(n)&&o[n]>0?50:0]),data:c}}}function Y(t){if(t instanceof Float64Array)return t.slice();const n=new Float64Array(t.length);for(let e=0;e<t.length;e++)n[e]=t[e];return n}function Z(t,n){if(1===n)return 0;for(;t<0||t>=n;)t<0&&(t=-t-1),t>=n&&(t=2*n-t-1);return t}function tt(t,n){const e=t.length,r=Y(t),o=function(t){const n=Math.max(1,Math.round(t));return n%2===0?n+1:n}(n),l=o-1>>1,a=new Float64Array(e),s=new Float64Array(o);for(let h=0;h<e;h++){for(let n=-l,o=0;n<=l;n++,o++)s[o]=r[Z(h+n,e)];const t=Array.from(s);t.sort((t,n)=>t-n),a[h]=t[l]}return a}function nt(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const e=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;const r=1/n,o=1/(2*Math.PI*e),l=o/(o+r),a=t.length,s=Y(t),h=new Float64Array(a);h[0]=0;for(let i=1;i<a;i++)h[i]=l*(h[i-1]+s[i]-s[i-1]);return h}(t,n,.5),{baseline:r,corrected:o}=function(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const o=Math.round(e/1e3*n),l=Math.round(r/1e3*n),a=tt(t,o),s=tt(a,l),h=s.length,i=Y(t),c=new Float64Array(h);for(let f=0;f<h;f++)c[f]=i[f]-s[f];return{baseline:s,corrected:c}}(e,n,200,600);return{hpf:e,baseline:r,detrended:o}}function et(t,n){const{b0:e,b1:r,b2:o,a1:l,a2:a}=n,s=t.length,h=Y(t),i=new Float64Array(s);let c=0,f=0,u=0,g=0;for(let m=0;m<s;m++){const t=h[m],n=e*t+r*c+o*f-l*u-a*g;i[m]=n,f=c,c=t,g=u,u=n}return i}function rt(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/Math.SQRT2;const r=2*Math.PI*(n/t),o=Math.cos(r),l=Math.sin(r)/(2*e);let a=(1-o)/2,s=1-o,h=(1-o)/2,i=1+l,c=-2*o,f=1-l;return a/=i,s/=i,h/=i,c/=i,f/=i,{b0:a,b1:s,b2:h,a1:c,a2:f}}function ot(t,n){let e=Y(t);for(const r of n)e=et(e,r);return e}function lt(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25;const o=t.length;if(o<3)return Y(t);const l=Math.min(o-1,Math.max(12,Math.round(e*r))),a=function(t,n){const e=t.length,r=new Float64Array(e+2*n);for(let o=0;o<n;o++)r[o]=t[Z(n-o-1,e)];for(let o=0;o<e;o++)r[n+o]=t[o];for(let o=0;o<n;o++)r[n+e+o]=t[Z(e-2-o,e)];return r}(t,l);let s=ot(a,n);s=s.reverse(),s=ot(s,n),s=s.reverse();const h=new Float64Array(o);for(let i=0;i<o;i++)h[i]=s[l+i];return h}function at(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/Math.SQRT2;const r=2*Math.PI*(n/t),o=Math.cos(r),l=Math.sin(r)/(2*e);let a=(1+o)/2,s=-(1+o),h=(1+o)/2,i=1+l,c=-2*o,f=1-l;return a/=i,s/=i,h/=i,c/=i,f/=i,{b0:a,b1:s,b2:h,a1:c,a2:f}}const st=[.541196100146197,1.3065629648763766];function ht(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return 2===e?[at(t,n,1/Math.SQRT2)]:4===e?st.map(e=>at(t,n,e)):void 0}function it(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return 2===e?[rt(t,n,1/Math.SQRT2)]:4===e?st.map(e=>rt(t,n,e)):void 0}function ct(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;const{detrended:e}=nt(t,n);let r=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,{hpOrder:e=2,lpOrder:r=4,zeroPhase:o=!0,padSeconds:l=.25}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=[...ht(n,5,e),...it(n,18,r)];return o?lt(t,a,n,l):a.reduce((t,n)=>et(t,n),Y(t))}(e,n,{hpOrder:4,lpOrder:4,zeroPhase:!0});return{bp:r,detrended:e}}function ft(t,n){let e,r,o,l,a,s,h;function i(t){const n=t.length,e=t[0].length,r=Array.from({length:e},()=>Array(n));for(let o=0;o<n;o++)for(let n=0;n<e;n++)r[n][o]=t[o][n];return r}function c(t,n){const e=t.length,r=t[0].length,o=(n.length,n[0].length),l=Array.from({length:e},()=>Array(o).fill(0));for(let a=0;a<e;a++)for(let e=0;e<r;e++){const r=t[a][e];for(let t=0;t<o;t++)l[a][t]+=r*n[e][t]}return l}function f(t){const n=t.length,e=t.map(t=>t.slice()),r=Array.from({length:n},(t,e)=>Array.from({length:n},(t,n)=>e===n?1:0));for(let o=0;o<n;o++){let t=o;for(let r=o+1;r<n;r++)Math.abs(e[r][o])>Math.abs(e[t][o])&&(t=r);const l=e[t][o];t!==o&&([e[o],e[t]]=[e[t],e[o]],[r[o],r[t]]=[r[t],r[o]]);for(let a=0;a<n;a++)e[o][a]/=l,r[o][a]/=l;for(let a=0;a<n;a++){if(a===o)continue;const t=e[a][o];if(0!==t)for(let l=0;l<n;l++)e[a][l]-=t*e[o][l],r[a][l]-=t*r[o][l]}}return r}"centered"===n?(e=2,r=25,o=.05,l=0):"asymmetric"===n&&(a=16,s=16,h=4,l=0,o=.05);const u=t=>{let n=1;for(let e=2;e<=t;e++)n*=e;return n};function g(t,n){const e=function(t,n){const e=n-1>>1,r=Array.from({length:n},()=>Array(t+1).fill(0));for(let o=0;o<n;o++){const n=o-e;let l=1;for(let e=0;e<=t;e++)r[o][e]=l,l*=n}return r}(t,n),r=i(e),o=c(r,e),l=c(f(o),r),a=Array.from({length:n},()=>Array(t+1).fill(0));for(let s=0;s<=t;s++){const t=u(s);for(let e=0;e<n;e++)a[e][s]=t*l[s][e]}return a}function m(t,n,e){const r=n+e+1,o=function(t,n,e){const r=n+e+1,o=Array.from({length:r},()=>Array(t+1).fill(0));for(let l=0;l<r;l++){const e=l-n;let r=1;for(let n=0;n<=t;n++)o[l][n]=r,r*=e}return o}(t,n,e),l=i(o),a=c(l,o),s=c(f(a),l),h=Array.from({length:r},()=>Array(t+1).fill(0));for(let i=0;i<=t;i++){const t=u(i);for(let n=0;n<r;n++)h[n][i]=t*s[i][n]}return h}function M(t,n,e){const r=t.length,o=n.length,l=new Array(r).fill(0);for(let a=0;a<r;a++){let s=0;for(let l=0;l<o;l++){const o=a+l-e;o>=0&&o<r&&(s+=t[o]*n[l])}l[a]=s}return l}function p(t,n){return t.map(t=>t[n])}if("centered"===n)return function(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{dt:o=1,deriv:l=0}=r,a=function(t,n){const e=t.length,r=n.length,o=Math.floor(r/2),l=new Array(e).fill(0);for(let a=0;a<e;a++){let s=0;for(let l=0;l<r;l++){const r=a+l-o;r>=0&&r<e&&(s+=t[r]*n[l])}l[a]=s}return l}(t,p(g(n,e),l));if(0===l)return a;const s=Math.pow(o,l);return a.map(t=>t/s)}(t,e,r,{dt:o,deriv:l});if("asymmetric"===n){if(0===l)return function(t,n,e,r){const o=p(m(r,n,e),0),l=t.length,a=M(t,o,n),s=a.slice();for(let h=n;h<=l-e-1;h++)s[h]=a[h+e];for(let h=0;h<n&&h<l;h++)s[h]=t[h];for(let h=Math.max(l-e,0);h<l;h++)s[h]=t[h];return s}(t,a,s,h);const n=M(t,m(h,a,s).map(t=>t[l]),a),e=Math.pow(o,l);return n.map(t=>t/e)}}const ut=t=>{const n=t[0].data.map(t=>t[1]),e=t[0].data.map(t=>t[0]),r=t=>e.map((n,e)=>[n,t[e]]),o=function(t){const n=t.length,e=Math.floor(20),r=Math.floor(80),o=new Array(n);for(let h=0;h<n;h++){const r=Math.max(0,h-e),l=Math.min(n-1,h+e);o[h]=s(t,r,l)}const l=new Array(n);for(let h=0;h<n;h++){const t=Math.max(0,h-r),e=Math.min(n-1,h+r);l[h]=s(o,t,e)}const a=new Array(n);for(let h=0;h<n;h++){const n=t[h],e=l[h];a[h]=Number.isNaN(n)||Number.isNaN(e)?NaN:n-e}return a;function s(t,n,e){const r=e-n+1,o=new Array(r);for(let a=0;a<r;a++)o[a]=t[n+a];o.sort((t,n)=>t-n);const l=Math.floor(r/2);return r%2===1?o[l]:.5*(o[l-1]+o[l])}}(n),l=function(t){const n=t.length;if(0===n)return[];const e=function(t,n){const e=new Array(13).fill(0),r=n[1],o=n[2];for(let l=0;l<13;l++){let n=0===l?t[0]:0;for(let e=1;e<t.length;e++)0===l-e&&(n+=t[e]);const a=l-1>=0?e[l-1]:0,s=l-2>=0?e[l-2]:0;e[l]=n-r*a-o*s}return e}([1,0,0,0,0,0,-2,0,0,0,0,0,1],[1,-2,1]);return function(t,n){const e=t.length,r=n.length,o=e+r-1,l=new Array(o).fill(0);for(let a=0;a<o;a++){let o=0;const s=Math.max(0,a-(e-1)),h=Math.min(a,r-1);for(let e=s;e<=h;e++)o+=n[e]*t[a-e];l[a]=o}return l}(t,e).slice(6,6+n)}(o),a=function(t){const n=t.length,e=function(t,n,e){const r=new Array(e).fill(0),o=n[1];for(let l=0;l<e;l++){let n=l<t.length?t[l]:0;const e=l>0?r[l-1]:0;r[l]=n-o*e}return r}((()=>{const t=new Array(33).fill(0);return t[0]=-1,t[16]=32,t[17]=-32,t[32]=1,t})(),[1,-1],33);return function(t,n){const e=t.length,r=n.length,o=e+r-1,l=new Array(o).fill(0);for(let a=0;a<o;a++){let o=0;const s=Math.max(0,a-(e-1)),h=Math.min(a,r-1);for(let e=s;e<=h;e++)o+=n[e]*t[a-e];l[a]=o}return l}(t,e).slice(16,16+n)}(l),s=function(t){const n=Math.max(2,Math.round(8)),e=(r=1-.25/35,o=0,l=.999999,Math.max(o,Math.min(l,r)));var r,o,l;const a=Math.pow(e,1/n),s=function(t,n,e){const r=3*(Math.max(t.length,n.length)-1),o=e.length;if(o<=r+1){const r=h(t,n,e);return h(t,n,r.slice().reverse()).reverse()}const l=i(e,r,!0),a=i(e,r,!1),s=h(t,n,l.concat(e,a));return h(t,n,s.slice().reverse()).reverse().slice(r,r+o);function i(t,n,e){const r=new Array(n);if(e){for(let e=0;e<n;e++)r[e]=2*t[0]-t[1+e];return r.reverse()}for(let l=0;l<n;l++)r[l]=2*t[o-1]-t[o-2-l];return r}}(new Array(n).fill(1),Array.from({length:n},(t,n)=>Math.pow(a,n)),t);return s;function h(t,n,e){const r=t.length,o=n.length,l=new Array(e.length).fill(0);for(let a=0;a<e.length;a++){let s=0;for(let n=0;n<r;n++){const r=a-n;r>=0&&(s+=t[n]*e[r])}for(let t=1;t<o;t++){const e=a-t;e>=0&&(s-=n[t]*l[e])}l[a]=s}return l}}(a),h=ft(l,"centered"),i=ct(n);return{mvmFiltered:r(o),lowPassFilteredML:r(l),highPassFilteredML:r(a),notchFilteredML:r(s),savGolayFilteredMLC:r(h),biggestPreprocess:{bp:r(i.bp),detrended:r(i.detrended)}}};function gt(t,n,e){const r=new Array(e.length).fill(0);for(let o=0;o<e.length;o++){for(let n=0;n<t.length;n++)o-n>=0&&(r[o]+=t[n]*e[o-n]);for(let t=1;t<n.length;t++)o-t>=0&&(r[o]-=n[t]*r[o-t]);r[o]/=n[0]}return r}function mt(n){const e=t(n,"max")||1,r=t(n,"min")||1,o=Math.abs(e)>Math.abs(r)?e:r;return n.map(t=>t/o)}function Mt(t){if(!t.length)return 0;let n=0;for(const e of t)n+=e;return n/t.length}function pt(t){let n=0;for(const e of t){const t=Math.abs(e);t>n&&(n=t)}return n}function dt(t){return new Array(t).fill(0)}function yt(t){return Math.round(t)}function At(t,n){const e=t.length,r=n.length,o=new Array(e+r-1).fill(0);for(let l=0;l<e;l++){const e=t[l];for(let t=0;t<r;t++)o[l+t]+=e*n[t]}return o}function xt(t,n,e){const r=new Array(e.length).fill(0);for(let o=0;o<e.length;o++){let l=0;for(let n=0;n<t.length;n++)o-n>=0&&(l+=t[n]*e[o-n]);for(let t=1;t<n.length;t++)o-t>=0&&(l-=n[t]*r[o-t]);r[o]=l/n[0]}return r}function wt(t,n,e){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=Math.max(t.length,n.length)-1,l=null==r?3*o:r,a=e.length,s=new Array(l),h=new Array(l);for(let c=0;c<l;c++)s[c]=2*e[0]-e[Math.min(l-c,a-1)],h[c]=2*e[a-1]-e[Math.max(a-2-c,0)];const i=xt(t,n,s.concat(e,h));return xt(t,n,i.slice().reverse()).reverse().slice(l,l+a)}function bt(t){let{signal:n,kernel:e="flattop",size:r=10,mirror:o=!0}=t;if(!n)throw new TypeError("signal required");if(r>n.length&&(r=n.length-1),r<1&&(r=1),"flattop"!==e)throw new Error("only flattop");const l=function(t){const n=new Array(t),e=t-1;for(let r=0;r<t;r++){const t=2*Math.PI*r/e;n[r]=1-1.93*Math.cos(t)+1.29*Math.cos(2*t)-.388*Math.cos(3*t)+.028*Math.cos(4*t)}return n}(r),a=l.reduce((t,n)=>t+n,0),s=l.map(t=>t/a),h=o?new Array(r).fill(n[0]):[],i=o?new Array(r).fill(n[n.length-1]):[],c=At(h.concat(n,i),s);return o?c.slice(r,r+n.length):c.slice(Math.floor((s.length-1)/2),Math.floor((s.length-1)/2)+n.length)}function vt(t,n,e){if(n=Math.max(0,n),(e=Math.min(e,t.length))<=n)return{idx:-1,val:-1/0};let r=n,o=t[n];for(let l=n+1;l<e;l++)t[l]>o&&(o=t[l],r=l);return{idx:r,val:o}}function Ft(t,n){if(!t.length)return[];const e=[t[0]];for(let r=1;r<t.length;r++)if(t[r]-e[e.length-1]>=n)e.push(t[r]);else if(r+1<t.length&&t[r+1]-e[e.length-1]>=n)continue;return e}function kt(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;const o=Math.max(0,n-e),l=Math.min(t.length-1,n+r);if(l-o<3)return!0;const a=t[n]-t[o],s=t[l]-t[n];return a>0&&s<0}function Pt(t,n,e){const r=Math.max(0,n-e),o=Math.min(t.length-1,n+e);let l=1/0,a=1/0;for(let h=r;h<=n;h++)t[h]<l&&(l=t[h]);for(let h=n;h<=o;h++)t[h]<a&&(a=t[h]);const s=Math.max(l,a);return t[n]-s}function St(t){return 0===t?1:Math.sin(Math.PI*t)/(Math.PI*t)}function It(t,n,e){const r=t-1,o=function(t){const n=new Array(t);for(let e=0;e<t;e++)n[e]=.54-.46*Math.cos(2*Math.PI*e/(t-1));return n}(t),l=new Array(t),a=2*n/e;for(let h=0;h<t;h++){const t=h-r/2;l[h]=a*St(a*t)*o[h]}const s=l.reduce((t,n)=>t+n,0);for(let h=0;h<t;h++)l[h]/=s;return l}const Nt=[.00475052,.01425157,.01425157,.00475052],Tt=[1,-2.25008508,1.75640138,-.46831211],zt=[.85449723,-2.56349169,2.56349169,-.85449723],_t=[1,-2.6861574,2.41965511,-.73016535];function Rt(t,n){const e=t.map(n=>n-Mt(t));let r=wt(Nt,Tt,e);const o=pt(r);o>0&&(r=r.map(t=>t/o));let l=wt(zt,_t,r,3*(Math.max(zt.length,_t.length)-1));const a=pt(l);a>0&&(l=l.map(t=>t/a));const s=[1,2,0,-2,-1].map(t=>t*n/8),h=3*(Math.max(zt.length,_t.length,s.length)-1);let i=wt(s,[1],l,h);const c=pt(i);c>0&&(i=i.map(t=>t/c));let f=i.map(t=>t*t);f=bt({signal:f,kernel:"flattop",size:yt(.06*n),mirror:!0});const u=yt(.15*n),g=At(f,(m=u,new Array(m).fill(1)).map(t=>t/u));var m;const M=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!t.length)return[];const r=Math.min(...t),o=r+n*(Math.max(...t)-r),l=[];for(let h=1;h<t.length-1;h++)t[h]>o&&t[h]>t[h-1]&&t[h]>t[h+1]&&l.push(h);if(!l.length)return[];l.sort((n,e)=>t[e]-t[n]);const a=[],s=new Array(t.length).fill(!1);for(const h of l){if(s[h])continue;a.push(h);const n=Math.max(0,h-e),r=Math.min(t.length-1,h+e);for(let t=n;t<=r;t++)s[t]=!0}return a.sort((t,n)=>t-n)}(g,0,yt(.1*n)),p=M.map(t=>g[t]),d=p.length;let y=dt(d),A=dt(d),x=dt(d);const w=2*n+1;let b=Math.max(...g.slice(0,Math.min(w,g.length)))*(1/3),v=.5*Mt(g.slice(0,Math.min(w,g.length))),F=b,k=v,P=Math.max(...l.slice(0,Math.min(w,l.length)))*(1/3),S=.5*Mt(l.slice(0,Math.min(w,l.length))),I=P,N=S,T=0,z=0,_=0,R=0,q=0,B=0;for(let L=0;L<d;L++){const t=Math.round(.15*n),e=Math.max(0,M[L]-t),r=Math.min(l.length,M[L]+t+1),o=vt(l,e,r);let a=o.idx,s=o.val;if(T>=9){const t=[];for(let n=T-9;n<T-1;n++)t.push(A[n+1]-A[n]);_=Mt(t),R=_}const h=R||_||0;let i=!1;const c=(t,n,e,r)=>{r<=0||kt(l,e,4,4)&&(T+=1,y[T-1]=n,A[T-1]=t,r>=P&&(z+=1,x[z-1]=e,I=.125*r+.875*I),F=.125*n+.875*F,i=!0)};if(p[L]>=b){if(T>=3&&(h&&M[L]-A[T-1]<=yt(.5*h)&&(q=1),M[L]-A[T-1]<=yt(.36*n)||1===q)){const t=Math.max(0,M[L]-yt(.07*n)),e=g.slice(t,M[L]+1),r=e.length>1?Mt(e.slice(1).map((t,n)=>t-e[n])):0,o=Math.max(0,A[T-1]-yt(.07*n)-1),l=g.slice(o,A[T-1]+1),a=l.length>1?Mt(l.slice(1).map((t,n)=>t-l[n])):0;B=Math.abs(r)<=Math.abs(.9*a)?1:0}0===B&&c(M[L],p[L],a,s)}if(!i){const t=T>0?M[L]-A[T-1]:1/0;if(t>=Math.round(.28*n)&&t<=Math.round(.52*n)&&s>0){const t=Math.round(.06*n);Pt(l,a,t)>Math.max(.25*Math.max(1e-9,I-N),.15*Math.max(1e-9,I))&&kt(l,a,4,4)&&c(M[L],p[L],a,s)}}if(!i){const t=T>0?M[L]-A[T-1]:1/0,e=t>=yt(.2*n)&&t<=yt(.6*n);p[L]>=.5*b&&e&&s>=.5*P&&c(M[L],p[L],a,s)}if(!i){const t=T>0?M[L]-A[T-1]:1/0;if(t>=Math.round(.28*n)&&t<=Math.round(.52*n)&&s>0){const t=Math.round(.06*n);Pt(l,a,t)>Math.max(.25*Math.max(1e-9,I-N),.15*Math.max(1e-9,I))&&kt(l,a,4,4)&&c(M[L],p[L],a,s)}}i||(N=.125*Math.max(0,s)+.875*N,k=.125*p[L]+.875*k),0===k&&0===F||(b=k+.25*Math.abs(F-k),v=.4*b),0===N&&0===I||(P=N+.25*Math.abs(I-N),S=.4*P),B=0,q=0}return x=x.slice(0,x.findLastIndex?x.findLastIndex(()=>!0)+1:x.length),function(){let t=x.slice();if(t.length<2)return void(x=t);const e=[];for(let n=1;n<t.length;n++)e.push(t[n]-t[n-1]);let r=function(t){if(!t.length)return 0;const n=[...t].sort((t,n)=>t-n),e=n.length>>1;return n.length%2?n[e]:(n[e-1]+n[e])/2}(e);r&&isFinite(r)||(r=Math.round(.8*n));const o=[];for(let a=1;a<t.length;a++){const e=t[a-1],s=t[a]-e;if(s>Math.max(.9*n,.95*r)){const t=e+Math.round(.25*s),r=e+Math.round(.75*s),a=vt(g,t,r);if(a.idx>=0){const t=Math.round(.15*n),e=vt(l,a.idx-t,a.idx+t+1),r=a.val,s=e.val;r>=.1*b&&s>=.1*P&&s>0&&kt(l,e.idx,4,4)&&o.push(e.idx)}}}o.length&&(t=t.concat(o).sort((t,n)=>t-n),t=Ft(t,Math.round(.18*n))),x=t}(),x.map(n=>Math.max(0,Math.min(t.length-1,Math.round(n))))}class qt{get_name(){return"Pan_Tompkins_Plus_Plus_Plus"}rpeak_detection(t,n){if(400!==n)throw new Error("\u042d\u0442\u0430 \u0432\u0435\u0440\u0441\u0438\u044f \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e fs = 400 \u0413\u0446.");if(!t||!t.length)return[];const e=Rt(function(t){const n=It(129,80,400),e=wt(n,[1],t,3*(n.length-1)),r=new Array(Math.floor(e.length/2));for(let o=0;o<r.length;o++)r[o]=e[2*o];return r}(t),200),r=[];for(const o of e){const n=2*o,e=2,l=vt(t,Math.max(0,n-e),Math.min(t.length,n+e+1)),a=l.idx>=0&&l.val>0&&kt(t,l.idx,4,4)?l.idx:n;r.push(a)}return Ft(r.sort((t,n)=>t-n),Math.round(72))}}const Bt=n=>{const e=n[0].data.map(t=>t[0]),r=n[0].data.map(t=>t[1]),o=t=>e.map((n,e)=>[n,t[e]]),l=function(t){let n=gt([1,0,0,0,0,0,-2,0,0,0,0,0,1],[1,-2,1],t);return n=mt(n),n}(r),a=function(t){let n=gt([-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,-32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,-1],t);return n=mt(n),n}(l),s=function(t){const n=[-1,-2,0,2,1].map(t=>t/8),e=Math.floor(n.length/2);let r=[];for(let o=0;o<t.length;o++){let l=0;for(let r=0;r<n.length;r++){const a=o+r-e,s=a>=0&&a<t.length?t[a]:0;l+=n[r]*s}r.push(l)}return r=mt(r),r}(r),h=function(t){let n=t.map(t=>t*t);return n=mt(n),n}(s),i=function(t){let n=[],e=0;for(let r=0;r<t.length;r++)e+=t[r],r>=51&&(e-=t[r-51]),r>=50?n.push(e/51):n.push(0);return n=mt(n),n}(h),c=function(n,e){const r=t(n,"max"),o=n.reduce((t,n)=>t+n,0)/n.length*r,l=n.map(t=>t>o?1:0),a=[],s=[];for(let t=1;t<l.length;t++)0===l[t-1]&&1===l[t]?a.push(t):1===l[t-1]&&0===l[t]&&s.push(t);for(let t=0;t<a.length;t++)a[t]=Math.max(0,a[t]-21),s[t]=Math.min(e.length-1,s[t]-21);const h=[];for(let t=0;t<a.length;t++){const n=a[t],r=s[t];let o=-1/0,l=n;for(let t=n;t<=r;t++)e[t]>o&&(o=e[t],l=t);h.push(l)}const i=[];for(let t=0;t<h.length;t++)if(0===i.length)i.push(h[t]);else{const n=i[i.length-1];h[t]-n>=100&&i.push(h[t])}return i}(i,r),f=(new qt).rpeak_detection(r,400);return{lowPassSignal:o(l),highPassSignal:o(a),differentiatedSignal:o(s),squaredSignal:o(h),movingWindowSignal:o(i),peaks:{series:e.map((t,n)=>[t,c.includes(n)?50:0]),data:c},peaksPlusPlus:{series:e.map((t,n)=>[t,f.includes(n)?50:0]),data:f}}},Lt={PT:t=>Bt(t).peaks.data,PTPlus:t=>Bt(t).peaksPlusPlus.data,KHO:t=>X(t).peaks.data,ATN:t=>s(t).peaks.data,CMD1:t=>u(t,1).data,CMD2:t=>u(t,2).data,GPT:t=>K([{data:ut(t).biggestPreprocess.bp}]).data};addEventListener("message",t=>{const{name:n,input:e}=t.data;try{const t=Lt[n];if(!t)throw new Error(`Unknown task name: ${n}`);const r=t(e);postMessage({ok:!0,name:n,result:r})}catch(r){postMessage({ok:!1,name:n,error:String(r),stack:null===r||void 0===r?void 0:r.stack})}})})();
//# sourceMappingURL=764.2d1b2e61.chunk.js.map