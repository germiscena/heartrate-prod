{"version":3,"file":"static/js/764.2d1b2e61.chunk.js","mappings":"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","sources":["utils.js","ATNAlgorithm/SignalConversionATN.js","ATNAlgorithm/mainSignalConversion.js","ATNAlgorithm/detectRPeaks.js","CMDAlgorithm/signalConversionCMD2.js","CMDAlgorithm/signalConversionCMD3.js","CMDAlgorithm/mainConversionCMD.js","CMDAlgorithm/signalConversionCMD1.js","GPTAlgorithm/utils.js","GPTAlgorithm/signalConversionGPT.js","GPTAlgorithm/mainConversionGPT.js","KHOAlgorithm/utils.js","KHOAlgorithm/SignalConversionKHO.js","KHOAlgorithm/preprocessKHO.js","KHOAlgorithm/mainSignalConversion.js","preprocessSignal/biggestPreprocess.js","preprocessSignal/mainConversions.js","preprocessSignal/preprocessSignal.js","PTAlgorithm/signalConversionPT.js","PTAlgorithm/signalConversionPT+++.js","PTAlgorithm/mainConversionPT.js","peaksCollection/peaks.worker.js"],"sourcesContent":["export const parseArrayData = (data) => {\r\n  data = data.map((item) => item.split(',').slice(1));\r\n  const [headers, ...rows] = data;\r\n  const tInd = headers.findIndex((i) => i === 't');\r\n\r\n  const series = { 0: [], 1: [], 2: [] };\r\n\r\n  rows.forEach((row) => {\r\n    headers.slice(0, -1).forEach((item, i) => {\r\n      series[i].push([Number(row[tInd]), parseFloat(row[i])]);\r\n    });\r\n  });\r\n\r\n  return [\r\n    {\r\n      name: headers[0],\r\n      data: series[0],\r\n    },\r\n    {\r\n      name: headers[1],\r\n      data: series[1],\r\n    },\r\n    {\r\n      name: headers[2],\r\n      data: series[2],\r\n    },\r\n  ];\r\n};\r\n\r\nexport function analyzeExcitations(data) {\r\n  const dataLabels = data[0].split(',');\r\n  const labelsNames = ['v1', 'v2', 'v3'];\r\n  const timeLabelIdx = dataLabels.indexOf('t');\r\n  const labelIdxes = labelsNames.map((ch) => dataLabels.indexOf(ch));\r\n\r\n  const signals = labelIdxes.map(() => []);\r\n  const times = [];\r\n\r\n  for (let i = 1; i < data.length; i++) {\r\n    const row = data[i].split(',');\r\n    labelIdxes.forEach((idx, chNum) => {\r\n      signals[chNum].push(Number(row[idx]));\r\n    });\r\n    times.push(Number(row[timeLabelIdx]));\r\n  }\r\n\r\n  function analyzeLabel(signal) {\r\n    const mean = signal.reduce((a, b) => a + b, 0) / signal.length;\r\n    const std = Math.sqrt(signal.reduce((a, b) => a + (b - mean) ** 2, 0) / signal.length);\r\n    const threshold = mean + 0.5 * std;\r\n    const minIntervalMs = 200;\r\n    const peaks = [];\r\n\r\n    for (let i = 1; i < signal.length - 1; i++) {\r\n      if (signal[i] > signal[i - 1] && signal[i] > signal[i + 1] && signal[i] > threshold) {\r\n        if (peaks.length === 0 || times[i] - times[peaks[peaks.length - 1]] >= minIntervalMs) {\r\n          peaks.push(i);\r\n        } else {\r\n          if (signal[i] > signal[peaks[peaks.length - 1]]) {\r\n            peaks[peaks.length - 1] = i;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const peakTimes = peaks.map((i) => times[i]);\r\n    const intervals = [];\r\n    for (let j = 1; j < peakTimes.length; j++) {\r\n      intervals.push(peakTimes[j] - peakTimes[j - 1]);\r\n    }\r\n\r\n    return {\r\n      count: peakTimes.length,\r\n      avgInterval: intervals.length ? intervals.reduce((a, b) => a + b, 0) / intervals.length : 0,\r\n    };\r\n  }\r\n\r\n  const result = {};\r\n  labelsNames.forEach((name, i) => {\r\n    result[name] = analyzeLabel(signals[i]);\r\n  });\r\n\r\n  const combinedSignal = [];\r\n  for (let i = 0; i < signals[0].length; i++) {\r\n    const vals = labelIdxes.map((_, chNum) => signals[chNum][i]);\r\n    const maxAbs = getTopValue(...vals.map(Math.abs), 'max');\r\n    const combinedVal = vals.find((v) => Math.abs(v) === maxAbs);\r\n    combinedSignal.push(combinedVal);\r\n  }\r\n  result.combined = analyzeLabel(combinedSignal);\r\n\r\n  return result;\r\n}\r\n\r\nexport const getCorrectYAxisMaximum = (data) => {\r\n  const isNegative = data < 0;\r\n  let currentNumber = data;\r\n  let separatorId = 0;\r\n\r\n  if (isNegative) {\r\n    currentNumber = -currentNumber;\r\n  }\r\n  for (let i = 0; i < String(currentNumber).length; i++) {\r\n    if (String(currentNumber)[i] === '.') {\r\n      separatorId = i;\r\n    }\r\n  }\r\n  let firstDigit = Number(String(currentNumber)[0]);\r\n  let digitNumber = Number('0.' + String(currentNumber).slice(1, 2));\r\n  if (digitNumber === 0) {\r\n    return isNegative ? -currentNumber : currentNumber;\r\n  }\r\n  let result = '';\r\n  if (digitNumber > 0.5) {\r\n    for (let i = 0; i < String(currentNumber).split('').length; i++) {\r\n      if (i === 0) {\r\n        result += firstDigit + 1;\r\n      } else {\r\n        if (separatorId == 0 || separatorId > i) {\r\n          result += 0;\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    result += firstDigit;\r\n    for (let i = 1; i < String(currentNumber).split('').length; i++) {\r\n      if (i === 1) {\r\n        result += 5;\r\n      } else {\r\n        if (separatorId == 0 || separatorId > i) {\r\n          result += 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return isNegative ? Number(-result) : Number(result);\r\n};\r\n\r\nexport function getTopValue(data, condition) {\r\n  let max = -Infinity;\r\n  let min = Infinity;\r\n  if (condition === 'min') {\r\n    for (let i = 0; i < data.length; i++) {\r\n      if (data[i] < min) min = data[i];\r\n    }\r\n    return min;\r\n  } else if (condition === 'max') {\r\n    for (let i = 0; i < data.length; i++) {\r\n      if (data[i] > max) max = data[i];\r\n    }\r\n    return max;\r\n  }\r\n}\r\n\r\nexport const getYAxisMainInfo = (dataValues) => {\r\n  let min = getTopValue(dataValues, 'min');\r\n  let max = getTopValue(dataValues, 'max');\r\n  if (!Math.floor(min / 100) === min) {\r\n    min = min * 100;\r\n  }\r\n  if (!Math.ceil(max / 100) === max) {\r\n    max = max * 100;\r\n  }\r\n  const step = getCorrectSteps(min, max);\r\n  let plotLines = [];\r\n  for (let i = 0; ; i++) {\r\n    const plotLine = step * i;\r\n    plotLines.push(plotLine);\r\n    if (plotLine > max) {\r\n      break;\r\n    }\r\n  }\r\n  for (let i = 1; ; i++) {\r\n    const plotLine = -(step * i);\r\n    plotLines.push(plotLine);\r\n    if (plotLine < min) {\r\n      break;\r\n    }\r\n  }\r\n  plotLines = plotLines\r\n    .sort((a, b) => a - b)\r\n    .map((item, i) => {\r\n      const isZero = item === 0;\r\n      const isMin = i === 0;\r\n      const isMax = i === plotLines.length - 1;\r\n      return {\r\n        value: item,\r\n        color: isZero ? 'black' : isMin || isMax ? 'black' : '#ccc',\r\n        width: isZero ? 1 : isMin || isMax ? 1.5 : 1,\r\n        dashStyle: 'Solid',\r\n        zIndex: 2,\r\n      };\r\n    });\r\n\r\n  return { min, max, step, plotLines };\r\n};\r\n\r\nexport const getGraphMainInfo = (series, uploadedSeriesPage) => {\r\n  const seriesLength = series[0].data.length;\r\n\r\n  const tickCount =\r\n    seriesLength > 24000\r\n      ? seriesLength > 72000\r\n        ? seriesLength > 240000\r\n          ? 5000\r\n          : 1000\r\n        : 500\r\n      : 100;\r\n  return {\r\n    chart: { zoomType: 'x', backgroundColor: 'white', spacingRight: 30 },\r\n    // boost: {\r\n    //   useGPUTranslations: true,\r\n    //   usePreAllocated: true,\r\n    // },\r\n    plotOptions: {\r\n      series: {\r\n        //     //     boostThreshold: 1,\r\n        //     //     turboThreshold: 0,\r\n        //     animation: false,\r\n        //     marker: { enabled: false },\r\n        //     lineWidth: 0.5,\r\n        //     shadow: false,\r\n        //     dataLabels: { enabled: false },\r\n        //     //     enableMouseTracking: true,\r\n        dataGrouping: { enabled: false, approximation: 'extremes', groupPixelWidth: 2 },\r\n      },\r\n    },\r\n    tooltip: {\r\n      enabled: true,\r\n      shared: true,\r\n      formatter: function () {\r\n        return (\r\n          `<b>Время: ${this.x} мсек</b><br/>` +\r\n          this.points.map((p) => `${p.series.name}: ${p.y}`).join('<br/>')\r\n        );\r\n      },\r\n    },\r\n    xAxis: {\r\n      type: 'datetime',\r\n      tickPixelInterval: 65,\r\n      title: { text: 'Время (сек)' },\r\n      labels: {\r\n        style: {\r\n          whiteSpace: 'nowrap',\r\n        },\r\n        formatter: function () {\r\n          return this.value / 1000;\r\n        },\r\n      },\r\n      // gridLineWidth: 1,\r\n      // minorGridLineWidth: 1,\r\n      //AUTO PLOTLINES\r\n      plotLines: Array.from({ length: (seriesLength * 2.5) / tickCount }, (_, i) => ({\r\n        color: i === 0 ? 'black' : i % 5 === 0 ? '#ddd' : '#eee',\r\n        width: i % 5 === 0 ? 1 : 0.5,\r\n        value: i * tickCount * (uploadedSeriesPage + 1),\r\n        zIndex: i === 0 ? 10 : 0,\r\n      })),\r\n    },\r\n    legend: {\r\n      enabled: false,\r\n      align: 'center',\r\n      verticalAlign: 'bottom',\r\n      layout: 'horizontal',\r\n      itemStyle: {\r\n        cursor: 'pointer',\r\n      },\r\n      itemCheckboxStyle: {\r\n        position: 'absolute',\r\n        marginTop: '1px',\r\n      },\r\n    },\r\n    credits: { enabled: false },\r\n    navigator: {\r\n      enabled: true,\r\n      xAxis: {\r\n        type: 'linear',\r\n        labels: {\r\n          formatter() {\r\n            return this.value;\r\n          },\r\n        },\r\n      },\r\n    },\r\n    rangeSelector: { enabled: false },\r\n  };\r\n};\r\n\r\nexport const getCorrectSteps = (min, max) => {\r\n  const steps = [\r\n    0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10, 25, 50, 100, 250, 500, 1000, 2500, 5000,\r\n    10000, 25000, 50000, 100000, 250000, 500000, 1000000, 2500000, 5000000, 10000000, 25000000,\r\n  ];\r\n  // const interval = max - min;\r\n  const sumStepsArr = [];\r\n  for (let i = 0; i < steps.length; i++) {\r\n    let downSteps = Math.ceil(Math.abs(min) / steps[i]);\r\n    let upSteps = Math.ceil(max / steps[i]);\r\n    let sumSteps = downSteps + upSteps;\r\n    sumStepsArr.push(sumSteps);\r\n  }\r\n  const correctStepsArr = sumStepsArr.filter((item) => item >= 4 && item <= 12);\r\n  const bestStep =\r\n    correctStepsArr.length > 1\r\n      ? correctStepsArr.length === 2\r\n        ? steps[sumStepsArr.findIndex((item) => item === correctStepsArr.sort((a, b) => a - b)[0])]\r\n        : steps[\r\n            sumStepsArr.findIndex(\r\n              (item) =>\r\n                item ===\r\n                correctStepsArr.sort((a, b) => a - b)[Math.floor(correctStepsArr.length / 2)],\r\n            )\r\n          ]\r\n      : steps[sumStepsArr.findIndex((item) => item === correctStepsArr[0])];\r\n\r\n  return bestStep;\r\n};\r\n\r\nexport const getMainOptions = (series, uploadedSeriesPage) => {\r\n  const mainGraphInfo = getGraphMainInfo(series, uploadedSeriesPage);\r\n\r\n  return {\r\n    ...mainGraphInfo,\r\n    yAxis: series.map((item, i) => singleMainYAxis(i, series)),\r\n    series: series.map((item, i) => {\r\n      return {\r\n        ...series[i],\r\n        yAxis: i,\r\n        color: 'blue',\r\n        max: singleMainYAxis(i, series).max,\r\n        min: singleMainYAxis(i, series).min,\r\n      };\r\n    }),\r\n  };\r\n};\r\n\r\nconst singleMainYAxis = (id, series) => {\r\n  const dataValues = series[id].data.map((item) => item[1]);\r\n  const { min, max, step, plotLines } = getYAxisMainInfo(dataValues);\r\n\r\n  return {\r\n    top: `${id * (100 / series.length)}%`,\r\n    height: `${100 / series.length}%`,\r\n    offset: 0,\r\n    lineWidth: 1,\r\n    labels: {\r\n      x: 5,\r\n      align: 'left',\r\n    },\r\n    tickPositioner: function () {\r\n      const positions = [];\r\n      for (let y = plotLines[0].value; y <= plotLines[plotLines.length - 1].value; y += step) {\r\n        positions.push(y);\r\n      }\r\n      return positions;\r\n    },\r\n\r\n    plotLines,\r\n    max,\r\n    min,\r\n  };\r\n};\r\n\r\nexport function saveFile(data) {\r\n  const convertToCsvData = (arr, sep) => {\r\n    const secondSep = '\\r\\n';\r\n    const escapeCell = (v) => {\r\n      if (v === null || v === undefined) return '';\r\n      const s = String(v);\r\n      const mustQuote = s.includes('\"') || s.includes('\\n') || s.includes('\\r') || s.includes(sep);\r\n      const escaped = s.replace(/\"/g, '\"\"');\r\n      return mustQuote ? `\"${escaped}\"` : escaped;\r\n    };\r\n\r\n    const csv = (arr ?? []).map((row) => (row ?? []).map(escapeCell).join(sep)).join(secondSep);\r\n    const blobParts = ['\\uFEFF', csv];\r\n    return blobParts;\r\n  };\r\n\r\n  const convertedData = convertToCsvData(data, ';');\r\n  const blob = new Blob(convertedData, { type: 'text/csv;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = 'data.csv';\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  setTimeout(() => {\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  }, 0);\r\n}\r\n","const FIR_TAPS = 200;\nconst DECIM = 32;\nconst BANDS = [\n  [7.8, 15.7],\n  [15.7, 23.5],\n  [23.5, 31.3],\n  [31.3, 39.2],\n];\n\nconst clamp = (x, lo, hi) => Math.max(lo, Math.min(hi, x));\nconst sinc = (x) => (x === 0 ? 1 : Math.sin(Math.PI * x) / (Math.PI * x));\nfunction hamming(L) {\n  const w = new Array(L);\n  for (let n = 0; n < L; n++) w[n] = 0.54 - 0.46 * Math.cos((2 * Math.PI * n) / (L - 1));\n  return w;\n}\n\nfunction firLowpass(length, wc) {\n  wc = clamp(wc, 0, 1);\n  const M = length - 1;\n  const w = hamming(length);\n  const h = new Array(length);\n  for (let n = 0; n < length; n++) {\n    const k = n - M / 2;\n    h[n] = 2 * wc * sinc(2 * wc * k) * w[n];\n  }\n  return h;\n}\n\nfunction firBandpass(length, f1, f2, fs = 400) {\n  const w1 = clamp(f1 / (fs / 2), 0, 1);\n  const w2 = clamp(f2 / (fs / 2), 0, 1);\n  const lo = Math.min(w1, w2),\n    hi = Math.max(w1, w2);\n  const h2 = firLowpass(length, hi);\n  const h1 = lo > 0 ? firLowpass(length, lo) : new Array(length);\n  const h = new Array(length);\n  for (let i = 0; i < length; i++) h[i] = h2[i] - h1[i];\n  return h;\n}\n\nfunction convSame(x, h) {\n  const n = x.length,\n    m = h.length;\n  const y = new Array(n);\n  const pad = Math.floor(m / 2);\n  for (let i = 0; i < n; i++) {\n    let acc = 0;\n    for (let k = 0; k < m; k++) {\n      const xi = i + k - pad;\n      if (xi >= 0 && xi < n) acc += x[xi] * h[k];\n    }\n    y[i] = acc;\n  }\n  return y;\n}\n\nfunction downsample(x, M) {\n  const out = new Array(Math.ceil(x.length / M));\n  let j = 0;\n  for (let i = 0; i < x.length; i += M) out[j++] = x[i];\n  return out;\n}\n\nexport function runFilterBank(signal, fs = 400) {\n  const filters = BANDS.map(([f1, f2]) => ({\n    band: [f1, f2],\n    h: firBandpass(FIR_TAPS, f1, f2, fs),\n  }));\n\n  const filtered = filters.map(({ h }) => {\n    const y = convSame(signal, h);\n    return y;\n  });\n\n  const decimated = filtered.map((data) => {\n    const yds = downsample(data, DECIM);\n    return yds;\n  });\n\n  return {\n    filtered,\n    decimated,\n  };\n}\n","import { newDetectRPeaksATN } from './detectRPeaks';\nimport { runFilterBank } from './SignalConversionATN';\n\nexport const analyzeATN = (signal) => {\n  const signalTime = signal[0].data.map((obj) => obj[0]);\n  const signalData = signal[0].data.map((obj) => obj[1]);\n  const signalTransform = (data) => signalTime.map((item, i) => [item, data[i]]);\n  const [filteredSignal1, filteredSignal2, filteredSignal3, filteredSignal4] =\n    runFilterBank(signalData).filtered;\n  const newPeaks = newDetectRPeaksATN(signalData, runFilterBank(signalData).filtered);\n  return {\n    filteredSignal1: signalTransform(filteredSignal1),\n    filteredSignal2: signalTransform(filteredSignal2),\n    filteredSignal3: signalTransform(filteredSignal3),\n    filteredSignal4: signalTransform(filteredSignal4),\n    peaks: {\n      series: signalTime.map((item, i) => [item, newPeaks.includes(i) ? 50 : 0]),\n      data: newPeaks,\n    },\n  };\n};\n","import { getTopValue } from '../utils';\n\nexport function newDetectRPeaksATN(signalData, filteredSignal) {\n  const fs = 400;\n  const M = 32;\n  const lambda = 0.8;\n  const refractoryMs = 250;\n\n  const threshold1 = 0.08;\n  const threshold2 = 0.7;\n  const thresholdL4 = 0.3;\n  const rescueThresh = 0.2;\n\n  const weakDsMin = 0.1;\n  const weakDsMax = 0.15;\n  const weakAmpFracDefault = 0.03;\n  const slopeFrac = 0.4;\n\n  const eps = 1e-12;\n\n  const clamp = (x, a, b) => Math.max(a, Math.min(b, x));\n  const downsample = (v, m) => {\n    const o = [];\n    for (let i = 0; i < v.length; i += m) o.push(v[i]);\n    return o;\n  };\n  const movingAverage = (v, w) => {\n    const out = new Array(v.length).fill(0);\n    let s = 0;\n    for (let i = 0; i < v.length; i++) {\n      s += v[i];\n      if (i >= w) s -= v[i - w];\n      out[i] = s / Math.min(i + 1, w);\n    }\n    return out;\n  };\n  const history = (ynm1, x) => (1 - lambda) * x + lambda * ynm1;\n  const findPeaks = (v) => {\n    const idx = [];\n    for (let i = 1; i < v.length - 1; i++) if (v[i] >= v[i - 1] && v[i] > v[i + 1]) idx.push(i);\n    return idx;\n  };\n\n  const median = (arr) => {\n    if (!arr.length) return 0;\n    const s = [...arr].sort((a, b) => a - b);\n    const k = Math.floor(s.length / 2);\n    return s.length % 2 ? s[k] : 0.5 * (s[k - 1] + s[k]);\n  };\n  const mad = (arr) => {\n    const m = median(arr);\n    return median(arr.map((x) => Math.abs(x - m))) || 1;\n  };\n\n  const bandEnergyAt = (i, w1, w2, w3, w4) =>\n    Math.abs(w1[i]) + Math.abs(w2[i]) + Math.abs(w3[i]) + Math.abs(w4[i]);\n  function positiveMaximaIndex(raw, a, b) {\n    let best = -Infinity,\n      bestI = -1;\n    const aa = clamp(a, 1, raw.length - 2),\n      bb = clamp(b, 1, raw.length - 2);\n    for (let i = aa; i <= bb; i++) {\n      if (raw[i] > 0 && raw[i] >= raw[i - 1] && raw[i] > raw[i + 1]) {\n        if (raw[i] > best) {\n          best = raw[i];\n          bestI = i;\n        }\n      }\n    }\n    return bestI;\n  }\n\n  function otsuThreshold(arr, bins = 64) {\n    if (!arr.length) return 0.2;\n    const min = getTopValue(arr, 'min'),\n      max = getTopValue(arr, 'max');\n    if (max - min < 1e-12) return min;\n    const h = new Array(bins).fill(0);\n    for (const v of arr) {\n      const k = Math.max(\n        0,\n        Math.min(bins - 1, Math.floor(((v - min) / (max - min + 1e-12)) * bins)),\n      );\n      h[k]++;\n    }\n    const total = arr.length;\n    const w = new Array(bins).fill(0),\n      m = new Array(bins).fill(0);\n    w[0] = h[0];\n    m[0] = 0 * h[0];\n    for (let i = 1; i < bins; i++) {\n      w[i] = w[i - 1] + h[i];\n      m[i] = m[i - 1] + i * h[i];\n    }\n    const mT = m[bins - 1];\n    let bestT = 0,\n      bestVar = -1;\n    for (let t = 0; t < bins - 1; t++) {\n      const w0 = w[t],\n        w1 = total - w0;\n      if (w0 === 0 || w1 === 0) continue;\n      const m0 = m[t] / w0,\n        m1 = (mT - m[t]) / w1;\n      const vb = w0 * w1 * (m0 - m1) * (m0 - m1);\n      if (vb > bestVar) {\n        bestVar = vb;\n        bestT = t;\n      }\n    }\n    return min + ((bestT + 0.5) * (max - min)) / bins;\n  }\n\n  function slopeAround(data, i, fs) {\n    const rad = Math.max(1, Math.round(fs * 0.012));\n    let s = 0,\n      c = 0;\n    for (let k = 1; k <= rad; k++) {\n      const a = i - k,\n        b = i + k;\n      if (a >= 0 && b < data.length) {\n        s += Math.abs(data[b] - data[a]);\n        c++;\n      }\n    }\n    return c ? s / c : 0;\n  }\n\n  const [w1i, w2i, w3i, w4i] = filteredSignal || [];\n  if (!w1i || !w2i || !w3i || !w4i) return [];\n  const L = Math.min(signalData.length, w1i.length, w2i.length, w3i.length, w4i.length);\n\n  let m = 0,\n    c = 0;\n  for (let i = 0; i < L; i++) {\n    const x = signalData[i];\n    if (!Number.isNaN(x)) {\n      m += x;\n      c++;\n    }\n  }\n  const mean = c ? m / c : 0;\n  const data = Array.from({ length: L }, (_, i) =>\n    Number.isNaN(signalData[i]) ? mean : signalData[i],\n  );\n\n  const s1 = mad(w1i),\n    s2 = mad(w2i),\n    s3 = mad(w3i),\n    s4 = mad(w4i);\n  const w1 = w1i.map((x) => x / (s1 + 1e-12));\n  const w2 = w2i.map((x) => x / (s2 + 1e-12));\n  const w3 = w3i.map((x) => x / (s3 + 1e-12));\n  const w4 = w4i.map((x) => x / (s4 + 1e-12));\n\n  const y2 = downsample(w1.slice(0, L), M);\n  const y3 = downsample(w2.slice(0, L), M);\n  const y4 = downsample(w3.slice(0, L), M);\n  const y5 = downsample(w4.slice(0, L), M);\n  const Ld = Math.min(y2.length, y3.length, y4.length, y5.length);\n  y2.length = Ld;\n  y3.length = Ld;\n  y4.length = Ld;\n  y5.length = Ld;\n\n  const P1 = new Array(Ld),\n    P2 = new Array(Ld),\n    P4 = new Array(Ld);\n  for (let i = 0; i < Ld; i++) {\n    const a2 = Math.abs(y2[i]),\n      a3 = Math.abs(y3[i]),\n      a4 = Math.abs(y4[i]),\n      a5 = Math.abs(y5[i]);\n    P1[i] = a2 + a3 + a4;\n    P2[i] = a2 + a3 + a4 + a5;\n    P4[i] = a3 + a4 + a5;\n  }\n  const neighborAvg = (P) => {\n    const out = new Array(P.length + 1);\n    out[0] = P[0] / 2;\n    for (let i = 0; i < P.length - 1; i++) out[i + 1] = (P[i] + P[i + 1]) / 2;\n    out[out.length - 1] = P[P.length - 1] / 2;\n    return out;\n  };\n  const FL1 = neighborAvg(P1);\n  const FL2 = neighborAvg(P2);\n  const FL4 = neighborAvg(P4);\n\n  const allEvents = findPeaks(FL1);\n  if (!allEvents.length) return [];\n  const coarseRad = 2 * M;\n  const fineRad = Math.max(1, Math.round(fs * 0.04));\n  const EventsL1 = [];\n  for (const p of allEvents) {\n    const base = clamp(p * M, 0, L - 1);\n    if (positiveMaximaIndex(data, base - coarseRad, base + coarseRad) !== -1) EventsL1.push(p);\n  }\n  if (!EventsL1.length) return [];\n\n  const meanL1 = EventsL1.reduce((s, p) => s + FL2[p], 0) / EventsL1.length;\n  let NL = meanL1 * (1 - 0.1);\n  let SL = meanL1 * (1 + 0.1);\n  function detectionBlock(mwi, Events, NL0, SL0, thr) {\n    let NL = NL0,\n      SL = SL0,\n      sumSig = SL0,\n      sumNoi = NL0;\n    const Signal = [],\n      Noise = [],\n      VDs = [],\n      Class = [];\n    for (let i = 0; i < Events.length; i++) {\n      const P = Events[i];\n      const Ds = Math.min(1, Math.max(0, (mwi[P] - NL) / Math.max(eps, SL - NL)));\n      VDs.push(Ds);\n      if (Ds > thr) {\n        Signal.push(P);\n        Class.push(1);\n        sumSig += mwi[P];\n        SL = sumSig / (Signal.length + 1);\n      } else {\n        Noise.push(P);\n        Class.push(0);\n        sumNoi += mwi[P];\n        NL = sumNoi / (Noise.length + 1);\n      }\n    }\n    return { Signal, Noise, VDs, Class };\n  }\n  const B1 = detectionBlock(FL2, EventsL1, NL, SL, threshold1);\n  const B2 = detectionBlock(FL2, EventsL1, NL, SL, threshold2);\n\n  const ClassL3 = EventsL1.map((_, i) => {\n    const C1 = B1.Class[i],\n      C2 = B2.Class[i];\n    if (C1 === 1 && C2 === 1) return 1;\n    if (C1 === 0 && C2 === 0) return 0;\n    if (C1 === 1 && C2 === 0) {\n      const d1 = (B1.VDs[i] - threshold1) / (1 - threshold1);\n      const d2 = (threshold2 - B2.VDs[i]) / threshold2;\n      return d1 > d2 ? 1 : 0;\n    }\n    return 1;\n  });\n  const SignalL3 = [],\n    NoiseL3 = [];\n  for (let i = 0; i < EventsL1.length; i++) (ClassL3[i] ? SignalL3 : NoiseL3).push(EventsL1[i]);\n\n  let SL4 = SignalL3.length\n    ? SignalL3.reduce((s, p) => s + FL4[p], 0) / SignalL3.length\n    : EventsL1.reduce((s, p) => s + FL4[p], 0) / EventsL1.length;\n  let NL4 = NoiseL3.length\n    ? NoiseL3.reduce((s, p) => s + FL4[p], 0) / NoiseL3.length\n    : (EventsL1.reduce((s, p) => s + FL4[p], 0) / EventsL1.length) * 0.5;\n  const SignalL4 = [],\n    NoiseL4 = [];\n  for (let i = 0; i < EventsL1.length; i++) {\n    const P = EventsL1[i];\n    const Ds = Math.min(1, Math.max(0, (FL4[P] - NL4) / Math.max(eps, SL4 - NL4)));\n    if (ClassL3[i] === 1) {\n      SignalL4.push(P);\n      SL4 = history(SL4, FL4[P]);\n    } else {\n      if (Ds > thresholdL4) {\n        SignalL4.push(P);\n        SL4 = history(SL4, FL4[P]);\n      } else {\n        NoiseL4.push(P);\n        NL4 = history(NL4, FL4[P]);\n      }\n    }\n  }\n\n  const SignalL5 = SignalL4.slice();\n  const periods = [];\n  for (let i = 0; i < SignalL4.length - 1; i++) periods.push(SignalL4[i + 1] - SignalL4[i]);\n  const meanperiod = movingAverage(periods, 100);\n  for (let i = 0; i < periods.length; i++) {\n    if (periods[i] > (meanperiod[i] || periods[i]) * 1.5) {\n      const a = SignalL4[i],\n        b = SignalL4[i + 1];\n      for (const n of NoiseL4) {\n        if (n > a && n < b) {\n          const Ds = Math.min(1, Math.max(0, (FL4[n] - NL4) / Math.max(eps, SL4 - NL4)));\n          if (Ds > rescueThresh) SignalL5.push(n);\n        }\n      }\n    }\n  }\n  SignalL5.sort((x, y) => x - y);\n  const peaks0 = [];\n  for (const p of SignalL5) {\n    const base = clamp(p * M, 0, L - 1);\n    const a = clamp(base - 2 * M, 0, L - 1),\n      b = clamp(base + 2 * M, 0, L - 1);\n    let eIdx = a,\n      eBest = bandEnergyAt(a, w1, w2, w3, w4);\n    for (let i = a; i <= b; i++) {\n      const ev = bandEnergyAt(i, w1, w2, w3, w4);\n      if (ev > eBest) {\n        eBest = ev;\n        eIdx = i;\n      }\n    }\n    const posI = positiveMaximaIndex(data, eIdx - fineRad, eIdx + fineRad);\n    if (posI !== -1) peaks0.push(posI);\n  }\n  let peaks = [...new Set(peaks0)].sort((a, b) => a - b);\n  const refr = Math.round((refractoryMs / 1000) * fs);\n  if (peaks.length > 1) {\n    const keep = new Array(peaks.length).fill(true);\n    for (let i = 0; i < peaks.length - 1; i++) {\n      if (!keep[i]) continue;\n      const j = i + 1;\n      if (peaks[j] - peaks[i] < refr) {\n        if (data[peaks[i]] < data[peaks[j]]) keep[i] = false;\n        else keep[j] = false;\n      }\n    }\n    peaks = peaks.filter((_, k) => keep[k]).sort((a, b) => a - b);\n  }\n\n  const dsVal = (p) => Math.min(1, Math.max(0, (FL4[p] - NL4) / Math.max(eps, SL4 - NL4)));\n  const allDs = EventsL1.map(dsVal);\n  let weakDs = otsuThreshold(allDs);\n  weakDs = Math.max(weakDsMin, Math.min(weakDsMax, weakDs * 0.8));\n\n  const ampsStrong = peaks.map((i) => data[i]);\n  const medAmpStrong = median(ampsStrong) || 1;\n\n  const slopesStrong = peaks.map((i) => slopeAround(data, i, fs));\n  const slopeCut = slopeFrac * (median(slopesStrong) || 1);\n\n  function localAmpBaseline(idx) {\n    if (!peaks.length) return medAmpStrong;\n    let lo = 0,\n      hi = peaks.length - 1,\n      pos = peaks.length;\n    while (lo <= hi) {\n      const mid = (lo + hi) >> 1;\n      if (peaks[mid] >= idx) {\n        pos = mid;\n        hi = mid - 1;\n      } else lo = mid + 1;\n    }\n    const K = 3;\n    const from = Math.max(0, pos - K),\n      to = Math.min(peaks.length - 1, pos + K);\n    const neigh = [];\n    for (let k = from; k <= to; k++) neigh.push(data[peaks[k]]);\n    return median(neigh) || medAmpStrong;\n  }\n\n  const extra = [];\n  for (const n of NoiseL4) {\n    const base = clamp(n * M, 0, L - 1);\n    const a = clamp(base - 2 * M, 0, L - 1),\n      b = clamp(base + 2 * M, 0, L - 1);\n    let eIdx = a,\n      eBest = bandEnergyAt(a, w1, w2, w3, w4);\n    for (let i = a; i <= b; i++) {\n      const ev = bandEnergyAt(i, w1, w2, w3, w4);\n      if (ev > eBest) {\n        eBest = ev;\n        eIdx = i;\n      }\n    }\n    const posI = positiveMaximaIndex(data, eIdx - fineRad, eIdx + fineRad);\n    if (posI === -1) continue;\n\n    const Ds = dsVal(n);\n    const dsOk = Ds >= weakDs;\n\n    const baseAmp = localAmpBaseline(posI);\n    const ampOk = data[posI] >= weakAmpFracDefault * baseAmp;\n\n    const slopeOk = slopeAround(data, posI, fs) >= slopeCut;\n\n    if (!(dsOk && ampOk && slopeOk)) continue;\n\n    let nearest = Infinity;\n    let lo = 0,\n      hi = peaks.length - 1;\n    while (lo <= hi) {\n      const mid = (lo + hi) >> 1;\n      const d = posI - peaks[mid];\n      nearest = Math.min(nearest, Math.abs(d));\n      if (d < 0) hi = mid - 1;\n      else lo = mid + 1;\n    }\n    if (nearest >= Math.round(0.9 * refr)) extra.push(posI);\n  }\n\n  if (extra.length) {\n    peaks = [...new Set(peaks.concat(extra))].sort((a, b) => a - b);\n    if (peaks.length > 1) {\n      const keep = new Array(peaks.length).fill(true);\n      for (let i = 0; i < peaks.length - 1; i++) {\n        if (!keep[i]) continue;\n        const j = i + 1;\n        if (peaks[j] - peaks[i] < refr) {\n          if (data[peaks[i]] < data[peaks[j]]) keep[i] = false;\n          else keep[j] = false;\n        }\n      }\n      peaks = peaks.filter((_, k) => keep[k]);\n    }\n  }\n\n  return peaks;\n}\n","function designFIRBandpass(fs, f1, f2, taps) {\n  const M = taps;\n  const mid = (M - 1) / 2;\n  const h = new Float64Array(M);\n  for (let n = 0; n < M; n++) {\n    const k = n - mid;\n    const win = 0.54 - 0.46 * Math.cos((2 * Math.PI * n) / (M - 1));\n    const sinc = (f) =>\n      k === 0 ? (2 * f) / fs : Math.sin((2 * Math.PI * f * k) / fs) / (Math.PI * k);\n    h[n] = (sinc(f2) - sinc(f1)) * win;\n  }\n  const sum = h.reduce((a, b) => a + b, 0);\n  for (let i = 0; i < M; i++) h[i] /= sum || 1;\n  return h;\n}\n\nfunction filtfiltFIR(x, h) {\n  const nPad = Math.min(3 * (h.length - 1), x.length - 1);\n  const xPad = reflectPad(x, nPad);\n  const y1 = convFIR(xPad, h);\n  y1.reverse();\n  const y2 = convFIR(y1, h);\n  y2.reverse();\n  return y2.subarray(nPad, nPad + x.length);\n}\n\nfunction reflectPad(x, nPad) {\n  const N = x.length;\n  const out = new Float64Array(N + 2 * nPad);\n  for (let i = 0; i < nPad; i++) out[nPad - 1 - i] = x[i + 1] ?? x[0];\n  for (let i = 0; i < N; i++) out[nPad + i] = x[i];\n  for (let i = 0; i < nPad; i++) out[nPad + N + i] = x[N - 2 - i] ?? x[N - 1];\n  return out;\n}\n\nfunction convFIR(x, h) {\n  const N = x.length,\n    M = h.length,\n    y = new Float64Array(N);\n  for (let n = 0; n < N; n++) {\n    let acc = 0;\n    for (let k = 0; k < M; k++) {\n      const i = n - k;\n      if (i >= 0) acc += h[k] * x[i];\n    }\n    y[n] = acc;\n  }\n  return y;\n}\n\nexport function detectECGPeaksStages(signal, opts = {}) {\n  const {\n    fs = 400,\n    band = [5, 20],\n    firTaps = 81,\n    mwiSec = 0.12,\n    refractorySec = 0.2,\n    refineSec = 0.08,\n  } = opts;\n\n  const x = signal instanceof Float64Array ? signal : Float64Array.from(signal);\n  const N = x.length;\n  if (N === 0) return { indices: [], stages: {} };\n\n  const bpArr = new Float64Array(N);\n  const dArr = new Float64Array(N);\n  const sArr = new Float64Array(N);\n  const mArr = new Float64Array(N);\n  const thArr = new Float64Array(N).fill(NaN);\n  const h = designFIRBandpass(fs, band[0], band[1], firTaps);\n  const yBP = filtfiltFIR(x, h);\n  if (bpArr) bpArr.set(yBP);\n\n  const W = Math.max(1, Math.round(mwiSec * fs));\n\n  const dBuf = new Float64Array(5);\n  let dpos = 0,\n    dCount = 0;\n  const mwiBuf = new Float64Array(W);\n  let mpos = 0,\n    msum = 0,\n    mCount = 0;\n  const mRingLen = Math.max(W + 1, Math.round(3 * fs));\n  const mRing = new Float64Array(mRingLen);\n\n  let SPKI = 0,\n    NPKI = 0,\n    TH1 = 0;\n  let initialized = false,\n    initMax = 0,\n    initCount = 0;\n  const initNeeded = Math.round(2 * fs);\n\n  const peaks = [];\n  let lastR = -Infinity;\n  const rrHist = [];\n  const rrWin = 8;\n  let mPrev2 = 0,\n    mPrev1 = 0,\n    mCurr = 0;\n  let mValid = false;\n\n  for (let n = 0; n < N; n++) {\n    dBuf[dpos] = yBP[n];\n    dpos = (dpos + 1) % 5;\n    dCount++;\n    let d = 0;\n    if (dCount >= 5) {\n      const i0 = (dpos + 4) % 5,\n        i1 = (dpos + 3) % 5,\n        i3 = (dpos + 1) % 5,\n        i4 = (dpos + 0) % 5;\n      d = (2 * dBuf[i0] + dBuf[i1] - dBuf[i3] - 2 * dBuf[i4]) / 8;\n    }\n    if (dArr) dArr[n] = d;\n\n    const s = d * d;\n    if (sArr) sArr[n] = s;\n\n    if (mCount < W) {\n      msum += s;\n      mwiBuf[mpos] = s;\n      mpos = (mpos + 1) % W;\n      mCount++;\n    } else {\n      msum += s - mwiBuf[mpos];\n      mwiBuf[mpos] = s;\n      mpos = (mpos + 1) % W;\n    }\n    const mShow = msum / Math.min(W, mCount || 1);\n    if (mArr) mArr[n] = mShow;\n\n    if (mCount < W) {\n      continue;\n    }\n\n    const m = msum / W;\n    mRing[n % mRingLen] = m;\n    if (!mValid) {\n      mPrev2 = mPrev1 = mCurr = m;\n      mValid = true;\n      continue;\n    }\n    mPrev2 = mPrev1;\n    mPrev1 = mCurr;\n    mCurr = m;\n\n    if (!initialized) {\n      initMax = Math.max(initMax, mPrev1);\n      if (++initCount >= initNeeded) {\n        SPKI = 0.25 * initMax;\n        NPKI = 0.125 * initMax;\n        TH1 = NPKI + 0.2 * (SPKI - NPKI);\n        initialized = true;\n      }\n      if (thArr) thArr[n] = initialized ? TH1 : n > 0 ? thArr[n - 1] : 0; // <-- без NaN\n      continue;\n    }\n\n    if (thArr) thArr[n] = TH1;\n\n    if (mPrev1 > mPrev2 && mPrev1 >= mCurr) {\n      const idxM = n - 1;\n      const meanRR = rrHist.length\n        ? rrHist.reduce((a, b) => a + b, 0) / rrHist.length\n        : Math.round(0.8 * fs);\n      const missRR = Math.round(1.6 * meanRR);\n      if (idxM - lastR > missRR) {\n        const start = Math.max(lastR + Math.max(1, Math.round(0.2 * fs)), idxM - missRR);\n        const end = idxM - Math.max(1, Math.round(0.08 * fs));\n        let best = -Infinity,\n          bestI = -1;\n        for (let i = start; i < end; i++) {\n          const v = mRing[i % mRingLen];\n          if (v > best) {\n            best = v;\n            bestI = i;\n          }\n        }\n        if (bestI >= 0 && best >= 0.5 * TH1) accept(bestI, best);\n      }\n      if (mPrev1 >= TH1 && idxM - lastR >= Math.max(1, Math.round(0.2 * fs))) accept(idxM, mPrev1);\n      else {\n        NPKI = 0.125 * mPrev1 + 0.875 * NPKI;\n        TH1 = NPKI + 0.2 * (SPKI - NPKI);\n      }\n    }\n  }\n\n  return {\n    indices: peaks,\n    bandpass: bpArr,\n    differentiated: dArr,\n    squared: sArr,\n    mwi: mArr,\n  };\n\n  function accept(idxM, mVal) {\n    const delay = Math.round((W - 1) / 2 + 2);\n    const refine = Math.max(1, Math.round((opts.refineSec ?? 0.08) * fs));\n    let guess = idxM - delay;\n    if (guess < 0) guess = 0;\n    if (guess >= N) guess = N - 1;\n    const L = Math.max(0, guess - refine),\n      R = Math.min(N - 1, guess + refine);\n    let bestIdx = -1,\n      bestVal = -Infinity;\n    for (let j = L; j <= R; j++) {\n      const v = yBP[j];\n      if (v > 0 && v > bestVal) {\n        bestVal = v;\n        bestIdx = j;\n      }\n    }\n    if (bestIdx < 0) {\n      NPKI = 0.125 * mVal + 0.875 * NPKI;\n      TH1 = NPKI + 0.2 * (SPKI - NPKI);\n      return;\n    }\n    if (bestIdx > 0 && bestIdx < N - 1) {\n      const y1 = yBP[bestIdx - 1],\n        y2 = yBP[bestIdx],\n        y3 = yBP[bestIdx + 1];\n      const denom = y1 - 2 * y2 + y3;\n      if (denom !== 0) {\n        const delta = (0.5 * (y1 - y3)) / denom;\n        const cand = Math.round(bestIdx + Math.max(-1, Math.min(1, delta)));\n        if (cand >= L && cand <= R && yBP[cand] >= y2 && yBP[cand] > 0) bestIdx = cand;\n      }\n    }\n    peaks.push(bestIdx);\n    if (lastR > -Infinity) {\n      rrHist.push(bestIdx - lastR);\n      if (rrHist.length > rrWin) rrHist.shift();\n    }\n    lastR = bestIdx;\n    SPKI = 0.125 * mVal + 0.875 * SPKI;\n    TH1 = NPKI + 0.2 * (SPKI - NPKI);\n  }\n}\n","import { getTopValue } from '../utils';\n\nexport function detectQRS_JS(inputSignal) {\n  const Fs = 400;\n  const ensembleSize = 10;\n  const noiseStdFactor = 2;\n  const maxImfs = 10;\n  const maxSiftings = 100;\n  const minPeakDistanceSec = 0.2;\n\n  const X = Array.from(inputSignal).map(Number);\n  const N = X.length;\n\n  const mean = (a) => a.reduce((s, v) => s + v, 0) / a.length;\n  const variance = (a) => {\n    const m = mean(a);\n    return a.reduce((s, v) => s + (v - m) ** 2, 0) / a.length;\n  };\n  const std = (a) => Math.sqrt(variance(a));\n  const maxAbs = (a) =>\n    getTopValue(\n      a.map((item) => Math.abs(item)),\n      'max',\n    );\n  const medianOf = (a) => {\n    const s = a.sort((x, y) => x - y);\n    const m = s.length;\n    if (!m) return 0;\n    const mid = m >> 1;\n    return m % 2 ? s[mid] : 0.5 * (s[mid - 1] + s[mid]);\n  };\n  const reflectIndex = (i, L) => {\n    if (L === 1) return 0;\n    const p = 2 * L - 2;\n    let m = ((i % p) + p) % p;\n    return m >= L ? p - m : m;\n  };\n\n  function movingMedianMirror(sig, k) {\n    if (k <= 1) return sig.slice();\n    const out = new Array(sig.length),\n      half = Math.floor((k - 1) / 2);\n    for (let i = 0; i < sig.length; i++) {\n      const w = new Array(k),\n        start = i - half;\n      for (let j = 0; j < k; j++) w[j] = sig[reflectIndex(start + j, sig.length)];\n      out[i] = medianOf(w);\n    }\n    return out;\n  }\n\n  function cubicSplineEval(xk, yk, xs) {\n    const n = xk.length;\n    if (!n) return xs.map(() => 0);\n    if (n === 1) return xs.map(() => yk[0]);\n    if (n === 2) {\n      const [x0, x1] = xk,\n        [y0, y1] = yk,\n        dy = (y1 - y0) / (x1 - x0 || 1e-12);\n      return xs.map((x) => y0 + dy * (x - x0));\n    }\n    const h = Array.from({ length: n - 1 }, (_, i) => xk[i + 1] - xk[i]),\n      alpha = new Array(n).fill(0);\n    for (let i = 1; i < n - 1; i++)\n      alpha[i] = (3 / h[i]) * (yk[i + 1] - yk[i]) - (3 / h[i - 1]) * (yk[i] - yk[i - 1]);\n    const l = new Array(n),\n      mu = new Array(n),\n      z = new Array(n);\n    l[0] = 1;\n    mu[0] = z[0] = 0;\n    for (let i = 1; i < n - 1; i++) {\n      l[i] = 2 * (xk[i + 1] - xk[i - 1]) - h[i - 1] * mu[i - 1];\n      mu[i] = h[i] / (l[i] || 1e-12);\n      z[i] = (alpha[i] - h[i - 1] * z[i - 1]) / (l[i] || 1e-12);\n    }\n    l[n - 1] = 1;\n    z[n - 1] = 0;\n    const b = new Array(n - 1),\n      c = new Array(n),\n      d = new Array(n - 1);\n    c[n - 1] = 0;\n    for (let j = n - 2; j >= 0; j--) {\n      c[j] = z[j] - mu[j] * (c[j + 1] || 0);\n      b[j] = (yk[j + 1] - yk[j]) / (h[j] || 1e-12) - (h[j] * (c[j + 1] + 2 * c[j])) / 3;\n      d[j] = (c[j + 1] - c[j]) / (3 * (h[j] || 1e-12));\n    }\n    return xs.map((x) => {\n      let j = 0;\n      if (x <= xk[0]) j = 0;\n      else if (x >= xk[n - 1]) j = n - 2;\n      else\n        for (let ii = 0; ii < n - 1; ii++)\n          if (x >= xk[ii] && x <= xk[ii + 1]) {\n            j = ii;\n            break;\n          }\n      const dx = x - xk[j];\n      return yk[j] + b[j] * dx + c[j] * dx * dx + d[j] * dx * dx * dx;\n    });\n  }\n\n  function findExtrema(sig) {\n    const maxima = [],\n      minima = [],\n      L = sig.length;\n    for (let i = 1; i < L - 1; i++) {\n      if (sig[i] > sig[i - 1] && sig[i] >= sig[i + 1]) maxima.push(i);\n      if (sig[i] < sig[i - 1] && sig[i] <= sig[i + 1]) minima.push(i);\n    }\n    if (L >= 2) {\n      if (sig[0] > sig[1]) maxima.unshift(0);\n      if (sig[0] < sig[1]) minima.unshift(0);\n      if (sig[L - 1] > sig[L - 2]) maxima.push(L - 1);\n      if (sig[L - 1] < sig[L - 2]) minima.push(L - 1);\n    }\n    return { maxima, minima };\n  }\n\n  function emd(signal, _maxImfs = 10, _maxSiftings = 100) {\n    const imfs = [],\n      N = signal.length;\n    let residue = signal.slice();\n    const tol = 0.05 * Math.max(1e-12, std(signal));\n    while (imfs.length < _maxImfs) {\n      const ex = findExtrema(residue);\n      if (ex.maxima.length + ex.minima.length < 2) break;\n      let h = residue.slice(),\n        it = 0;\n      while (it < _maxSiftings) {\n        const ex2 = findExtrema(h);\n        if (ex2.maxima.length + ex2.minima.length < 2) break;\n        const upper =\n          ex2.maxima.length >= 2\n            ? cubicSplineEval(\n                ex2.maxima,\n                ex2.maxima.map((i) => h[i]),\n                Array.from({ length: N }, (_, i) => i),\n              )\n            : Array(N).fill(ex2.maxima.length ? h[ex2.maxima[0]] : 0);\n        const lower =\n          ex2.minima.length >= 2\n            ? cubicSplineEval(\n                ex2.minima,\n                ex2.minima.map((i) => h[i]),\n                Array.from({ length: N }, (_, i) => i),\n              )\n            : Array(N).fill(ex2.minima.length ? h[ex2.minima[0]] : 0);\n        const m = new Array(N);\n        for (let i = 0; i < N; i++) m[i] = 0.5 * (upper[i] + lower[i]);\n        const hNext = new Array(N);\n        for (let i = 0; i < N; i++) hNext[i] = h[i] - m[i];\n        if (mean(m.map(Math.abs)) < tol) {\n          h = hNext;\n          break;\n        }\n        h = hNext;\n        it++;\n      }\n      imfs.push(h.slice());\n      for (let i = 0; i < N; i++) residue[i] -= h[i];\n      const exA = findExtrema(residue);\n      if (exA.maxima.length + exA.minima.length < 2) break;\n    }\n    imfs.push(residue.slice());\n    return imfs;\n  }\n\n  function gaussianRandomArray(n, s = 1) {\n    const out = new Array(n);\n    for (let i = 0; i < n; i += 2) {\n      const u1 = Math.random() || 1e-12,\n        u2 = Math.random(),\n        mag = Math.sqrt(-2 * Math.log(u1));\n      const z0 = mag * Math.cos(2 * Math.PI * u2),\n        z1 = mag * Math.sin(2 * Math.PI * u2);\n      out[i] = z0 * s;\n      if (i + 1 < n) out[i + 1] = z1 * s;\n    }\n    return out;\n  }\n\n  function ensembleEMD(signal, noiseStd, ensembleSize, _maxImfs, _maxSiftings) {\n    const N = signal.length,\n      runs = [];\n    let maxCount = 0;\n    for (let e = 0; e < ensembleSize; e++) {\n      const noise = gaussianRandomArray(N, noiseStd),\n        noisy = new Array(N);\n      for (let i = 0; i < N; i++) noisy[i] = signal[i] + noise[i];\n      const imfs = emd(noisy, _maxImfs, _maxSiftings);\n      runs.push(imfs);\n      if (imfs.length > maxCount) maxCount = imfs.length;\n    }\n    const modes = [];\n    for (let k = 0; k < maxCount; k++) {\n      const avg = new Array(N).fill(0);\n      let c = 0;\n      for (let r = 0; r < ensembleSize; r++) {\n        const imfs = runs[r];\n        if (k < imfs.length) {\n          const m = imfs[k];\n          for (let i = 0; i < N; i++) avg[i] += m[i];\n          c++;\n        }\n      }\n      if (c) for (let i = 0; i < N; i++) avg[i] /= c;\n      modes.push(avg);\n    }\n    return modes;\n  }\n\n  let X1 = X.slice();\n  const Xmean = mean(X1);\n  for (let i = 0; i < N; i++) X1[i] -= Xmean;\n  const maxabs = maxAbs(X1) || 1e-12;\n  for (let i = 0; i < N; i++) X1[i] /= maxabs;\n\n  const y1 = movingMedianMirror(X1, Math.max(1, Math.round(0.6 * Fs)));\n  const y2 = movingMedianMirror(X1, Math.max(1, Math.round(0.2 * Fs)));\n  const yy_pre = new Array(N);\n  for (let i = 0; i < N; i++) yy_pre[i] = X1[i] - 0.5 * y1[i] - 0.5 * y2[i];\n\n  const idxs = [],\n    thrIdx = 0.2 * (Math.max(yy_pre.map(Math.abs)) || 1e-12);\n  for (let i = 0; i < N; i++) if (Math.abs(yy_pre[i]) > thrIdx) idxs.push(yy_pre[i]);\n  const signProbe = idxs.length ? medianOf(idxs) : mean(yy_pre);\n  const yy = signProbe < 0 ? yy_pre.map((v) => -v) : yy_pre.slice();\n\n  const sd_val = Math.sqrt(variance(yy));\n  const modes = ensembleEMD(yy, noiseStdFactor * sd_val, ensembleSize, maxImfs, maxSiftings);\n  const K = Math.min(4, modes.length);\n  const y_signal = new Array(N).fill(0);\n  for (let m = 0; m < K; m++) for (let i = 0; i < N; i++) y_signal[i] += modes[m][i];\n\n  const y_pos = y_signal.map((v) => (v > 0 ? v : 0));\n  const posVals = y_pos.filter((v) => v > 0);\n  const mu = posVals.length ? mean(posVals) : 0;\n  const sig = posVals.length ? Math.sqrt(variance(posVals)) : 0;\n  const minPeakHeight = mu + 2 * sig;\n  const minPeakDistance = Math.round(minPeakDistanceSec * Fs);\n  const minProminence = 0.5 * sig;\n\n  function findPositivePeaks(y, minH, minD, minProm, promWin = minD) {\n    const N = y.length,\n      cand = [];\n    for (let i = 1; i < N - 1; i++)\n      if (y[i] > 0 && y[i] > y[i - 1] && y[i] >= y[i + 1] && y[i] >= minH)\n        cand.push({ idx: i, val: y[i] });\n    cand.sort((a, b) => b.val - a.val);\n    const kept = [];\n    for (const c of cand) if (!kept.some((t) => Math.abs(t - c.idx) < minD)) kept.push(c.idx);\n    const filtered = [];\n    for (const i of kept) {\n      const L = Math.max(0, i - promWin),\n        R = Math.min(N - 1, i + promWin);\n      let leftMin = y[i],\n        rightMin = y[i];\n      for (let k = L; k <= i; k++) if (y[k] < leftMin) leftMin = y[k];\n      for (let k = i; k <= R; k++) if (y[k] < rightMin) rightMin = y[k];\n      const prom = y[i] - Math.max(leftMin, rightMin);\n      if (prom >= (minProm || 0)) filtered.push({ idx: i, val: y[i], prom });\n    }\n    return filtered.sort((a, b) => a.idx - b.idx);\n  }\n\n  const peakObjs = findPositivePeaks(y_pos, minPeakHeight, minPeakDistance, minProminence);\n  const locs = peakObjs.map((p) => p.idx);\n\n  return { locs, y_signal, y_pos };\n}\n","import { detectRPeaks } from './signalConversionCMD1';\nimport { detectECGPeaksStages } from './signalConversionCMD2';\nimport { detectQRS_JS } from './signalConversionCMD3';\nexport const analyzeCMD = (signal, type) => {\n  const signalTime = signal[0].data.map((obj) => obj[0]);\n  const signalData = signal[0].data.map((obj) => obj[1]);\n  const transformPeaks = (data) => signalTime.map((item, i) => [item, data.includes(i) ? 100 : 0]);\n  let result;\n  if (type === 1) {\n    const tempResult = detectRPeaks(signalData, 400);\n    result = { peaks: transformPeaks(tempResult), data: tempResult };\n  } else if (type === 2) {\n    const tempResult = detectECGPeaksStages(signalData);\n    result = { peaks: transformPeaks(tempResult.indices), data: tempResult.indices };\n  } else if (type === 3) {\n    const tempResult = detectQRS_JS(signalData, { Fs: 400, ensembleSize: 4, noiseStdFactor: 2 });\n    result = { peaks: transformPeaks(tempResult.locs), data: tempResult.locs };\n  }\n  return result;\n};\n","export function detectRPeaks(signal, fs) {\n  const MAX_IMFS = 10;\n  const MAX_SIFTS = 8;\n  const SD_STOP = 0.2;\n  const EPS = 1e-12;\n  const MIN_GAP = Math.max(1, Math.floor(0.1 * fs));\n  const REFINE_WIN = 3;\n  const DROP_FIRST_NOISY = 1;\n  const CAP_USE_IMFS_UPTO = 5;\n\n  const N = signal.length | 0;\n  if (N < 3) return [];\n  const x = signal instanceof Float32Array ? signal : new Float32Array(signal);\n\n  const newF32 = (n) => new Float32Array(n);\n\n  function countZeroCrossings(arr) {\n    let c = 0,\n      prev = arr[0];\n    for (let i = 1; i < N; i++) {\n      const v = arr[i];\n      if ((prev >= 0 && v < 0) || (prev < 0 && v >= 0)) c++;\n      prev = v;\n    }\n    return c;\n  }\n\n  function countExtrema(arr) {\n    let c = 0;\n    for (let i = 1; i < N - 1; i++) {\n      const a = arr[i - 1],\n        b = arr[i],\n        c0 = arr[i + 1];\n      if ((b > a && b > c0) || (b < a && b < c0)) c++;\n    }\n    return c;\n  }\n\n  function buildEnvelope(h, indices, outEnv) {\n    if (indices.length === 0) {\n      outEnv.fill(h[0]);\n      return;\n    }\n    const firstIdx = indices[0];\n    const firstVal = h[firstIdx];\n    for (let i = 0; i < firstIdx; i++) outEnv[i] = firstVal;\n    for (let k = 0; k < indices.length - 1; k++) {\n      const i1 = indices[k],\n        i2 = indices[k + 1];\n      const v1 = h[i1],\n        v2 = h[i2];\n      const len = i2 - i1;\n      const slope = (v2 - v1) / len;\n      let acc = v1;\n      outEnv[i1] = v1;\n      for (let i = i1 + 1; i < i2; i++) {\n        acc += slope;\n        outEnv[i] = acc;\n      }\n      outEnv[i2] = v2;\n    }\n    const lastIdx = indices[indices.length - 1];\n    const lastVal = h[lastIdx];\n    for (let i = lastIdx + 1; i < N; i++) outEnv[i] = lastVal;\n  }\n\n  function siftOnce(h, upperEnv, lowerEnv, meanEnv) {\n    const maxIdx = [];\n    const minIdx = [];\n    for (let i = 1; i < N - 1; i++) {\n      const a = h[i - 1],\n        b = h[i],\n        c = h[i + 1];\n      if (b > a && b > c) maxIdx.push(i);\n      else if (b < a && b < c) minIdx.push(i);\n    }\n    if (maxIdx.length + minIdx.length < 2) return false;\n\n    if (h[0] > h[1]) maxIdx.unshift(0);\n    else if (h[0] < h[1]) minIdx.unshift(0);\n    if (h[N - 1] > h[N - 2]) maxIdx.push(N - 1);\n    else if (h[N - 1] < h[N - 2]) minIdx.push(N - 1);\n\n    buildEnvelope(h, maxIdx, upperEnv);\n    buildEnvelope(h, minIdx, lowerEnv);\n    for (let i = 0; i < N; i++) {\n      meanEnv[i] = 0.5 * (upperEnv[i] + lowerEnv[i]);\n      h[i] = h[i] - meanEnv[i];\n    }\n    return true;\n  }\n\n  function sdChange(prev, curr) {\n    let s = 0.0;\n    for (let i = 0; i < N; i++) {\n      const num = prev[i] - curr[i];\n      const den = prev[i] * prev[i] + EPS;\n      s += (num * num) / den;\n    }\n    return s;\n  }\n\n  function extractIMF(residue, upperEnv, lowerEnv, meanEnv, work) {\n    work.set(residue);\n    let h = work;\n    let prev = newF32(N);\n    let okSift = true;\n\n    for (let s = 0; s < MAX_SIFTS; s++) {\n      prev.set(h);\n      okSift = siftOnce(h, upperEnv, lowerEnv, meanEnv);\n      if (!okSift) break;\n      const sd = sdChange(prev, h);\n      const ext = countExtrema(h);\n      const zc = countZeroCrossings(h);\n      const isIMFshape = Math.abs(ext - zc) <= 1;\n\n      if (sd < SD_STOP && isIMFshape) break;\n    }\n    if (!okSift) return { imf: null, residue };\n    const imf = newF32(N);\n    for (let i = 0; i < N; i++) {\n      imf[i] = h[i];\n      residue[i] = residue[i] - imf[i];\n    }\n    return { imf, residue };\n  }\n  const upperEnv = newF32(N),\n    lowerEnv = newF32(N),\n    meanEnv = newF32(N),\n    work = newF32(N);\n  let residue = newF32(N);\n  residue.set(x);\n  const imfs = [];\n\n  for (let k = 0; k < MAX_IMFS; k++) {\n    const { imf, residue: newResidue } = extractIMF(residue, upperEnv, lowerEnv, meanEnv, work);\n    residue = newResidue;\n    if (!imf) break;\n    imfs.push(imf);\n    if (countExtrema(residue) < 2) break;\n  }\n\n  if (imfs.length === 0) return [];\n\n  const K = imfs.length;\n  const useStart = Math.min(DROP_FIRST_NOISY, K - 1);\n  const useEndExclusive = Math.max(K - 1, useStart + 1);\n  const y = newF32(N);\n  let used = 0;\n  for (let idx = useStart; idx < useEndExclusive; idx++) {\n    y.set(imfs[idx], 0);\n    used = 1;\n    break;\n  }\n  for (let idx = useStart + 1; idx < useEndExclusive && used < CAP_USE_IMFS_UPTO; idx++, used++) {\n    const c = imfs[idx];\n    for (let i = 0; i < N; i++) y[i] += c[i];\n  }\n  if (used === 0) y.set(imfs[0]);\n  const candIdx = [];\n  const candAmp = [];\n  for (let i = 1; i < N - 1; i++) {\n    const a = y[i - 1],\n      b = y[i],\n      c = y[i + 1];\n    if (b > a && b > c && b > 0) {\n      candIdx.push(i);\n      candAmp.push(b);\n    }\n  }\n  if (candIdx.length === 0) return [];\n\n  let maxAmp = -Infinity;\n  for (let i = 0; i < candAmp.length; i++) if (candAmp[i] > maxAmp) maxAmp = candAmp[i];\n  const tmp = candAmp.slice().sort((u, v) => u - v);\n  const med =\n    tmp.length % 2\n      ? tmp[(tmp.length - 1) >> 1]\n      : 0.5 * (tmp[tmp.length / 2 - 1] + tmp[tmp.length / 2]);\n  const thr = Math.max(0.3 * maxAmp, 0.6 * med);\n\n  const fIdx = [];\n  const fAmp = [];\n  for (let i = 0; i < candIdx.length; i++) {\n    if (candAmp[i] >= thr) {\n      fIdx.push(candIdx[i]);\n      fAmp.push(candAmp[i]);\n    }\n  }\n  if (fIdx.length === 0) return [];\n\n  const keepIdx = [];\n  const keepAmp = [];\n  let curIdx = fIdx[0],\n    curAmp = fAmp[0];\n  for (let i = 1; i < fIdx.length; i++) {\n    const idx = fIdx[i],\n      amp = fAmp[i];\n    if (idx - curIdx < MIN_GAP) {\n      if (amp > curAmp) {\n        curIdx = idx;\n        curAmp = amp;\n      }\n    } else {\n      keepIdx.push(curIdx);\n      keepAmp.push(curAmp);\n      curIdx = idx;\n      curAmp = amp;\n    }\n  }\n  keepIdx.push(curIdx);\n  keepAmp.push(curAmp);\n  const result = [];\n  for (let k2 = 0; k2 < keepIdx.length; k2++) {\n    const center = keepIdx[k2];\n    let bestI = center;\n    let bestV = x[center];\n    const i0 = Math.max(0, center - REFINE_WIN);\n    const i1 = Math.min(N - 1, center + REFINE_WIN);\n    for (let i = i0; i <= i1; i++) {\n      const v = x[i];\n      if (v > bestV) {\n        bestV = v;\n        bestI = i;\n      }\n    }\n    if (bestV > 0) result.push(bestI);\n  }\n  result.sort((a, b) => a - b);\n  const dedup = [];\n  for (let i = 0; i < result.length; i++) {\n    if (i === 0 || result[i] !== result[i - 1]) dedup.push(result[i]);\n  }\n  return dedup;\n}\n","export function toFloat32(arr) {\n  return arr instanceof Float32Array ? arr : Float32Array.from(arr);\n}\nexport function ensureOdd(n) {\n  return n % 2 === 0 ? n + 1 : n;\n}\n\nexport function designHPBiquad(fc, fs, Q) {\n  const w0 = (2 * Math.PI * fc) / fs,\n    cosw0 = Math.cos(w0),\n    sinw0 = Math.sin(w0),\n    alpha = sinw0 / (2 * Q);\n  let b0 = (1 + cosw0) / 2,\n    b1 = -(1 + cosw0),\n    b2 = (1 + cosw0) / 2,\n    a0 = 1 + alpha,\n    a1 = -2 * cosw0,\n    a2 = 1 - alpha;\n  b0 /= a0;\n  b1 /= a0;\n  b2 /= a0;\n  a1 /= a0;\n  a2 /= a0;\n  return { b0, b1, b2, a1, a2 };\n}\nexport function designButterworthHP_SOS(fc, fs, order) {\n  if (order === 2) return [designHPBiquad(fc, fs, 1 / Math.SQRT2)];\n  const Qs = [0.5411961, 1.30656296];\n  return Qs.map((Q) => designHPBiquad(fc, fs, Q));\n}\n\nexport function biquadCascade(x, sos) {\n  let y = new Float32Array(x.length);\n  x = toFloat32(x);\n  for (let s = 0; s < sos.length; s++) {\n    const { b0, b1, b2, a1, a2 } = sos[s];\n    let z1 = 0.0,\n      z2 = 0.0;\n    for (let n = 0; n < x.length; n++) {\n      const xn = x[n];\n      const yn = b0 * xn + z1;\n      z1 = b1 * xn - a1 * yn + z2;\n      z2 = b2 * xn - a2 * yn;\n      y[n] = yn;\n    }\n    if (s < sos.length - 1) {\n      x = y;\n      y = new Float32Array(x.length);\n    }\n  }\n  return y;\n}\n\nexport function reflectPad(x, nPad) {\n  const N = x.length;\n  const out = new Float32Array(N + 2 * nPad);\n  for (let i = 0; i < nPad; i++) out[i] = 2 * x[0] - x[nPad - i];\n  out.set(x, nPad);\n  for (let i = 0; i < nPad; i++) out[nPad + N + i] = 2 * x[N - 1] - x[N - 2 - i];\n  return out;\n}\n\nexport function filtfiltBiquad(x, sos) {\n  const N = x.length;\n  const pad = Math.max(1, Math.min(3 * 2 * sos.length, N - 1));\n  const xp = reflectPad(x, pad);\n  let y = biquadCascade(xp, sos);\n  y.reverse();\n  y = biquadCascade(y, sos);\n  y.reverse();\n  return y.subarray(pad, pad + N).slice();\n}\n\nexport function designLPBiquad(fc, fs, Q) {\n  const w0 = (2 * Math.PI * fc) / fs,\n    cosw0 = Math.cos(w0),\n    sinw0 = Math.sin(w0),\n    alpha = sinw0 / (2 * Q);\n  let b0 = (1 - cosw0) / 2,\n    b1 = 1 - cosw0,\n    b2 = (1 - cosw0) / 2,\n    a0 = 1 + alpha,\n    a1 = -2 * cosw0,\n    a2 = 1 - alpha;\n  b0 /= a0;\n  b1 /= a0;\n  b2 /= a0;\n  a1 /= a0;\n  a2 /= a0;\n  return { b0, b1, b2, a1, a2 };\n}\nexport function designButterworthLP_SOS(fc, fs, order) {\n  if (order === 2) return [designLPBiquad(fc, fs, 1 / Math.SQRT2)];\n  const Qs = [0.5411961, 1.30656296];\n  return Qs.map((Q) => designLPBiquad(fc, fs, Q));\n}\n\nexport function mean(arr) {\n  let s = 0,\n    n = arr.length;\n  for (let i = 0; i < n; i++) s += arr[i];\n  return s / Math.max(1, n);\n}\nexport function stdDev(arr, center) {\n  let s2 = 0,\n    n = arr.length;\n  for (let i = 0; i < n; i++) {\n    const d = arr[i] - center;\n    s2 += d * d;\n  }\n  return Math.sqrt(s2 / Math.max(1, n));\n}\nexport function mapAbsMinus(arr, center) {\n  const out = new Float32Array(arr.length);\n  for (let i = 0; i < arr.length; i++) out[i] = Math.abs(arr[i] - center);\n  return out;\n}\n\nexport function quantile(arr, q) {\n  const n = arr.length;\n  if (n === 0) return NaN;\n  if (q <= 0) return minOf(arr);\n  if (q >= 1) return maxOf(arr);\n  const a = Float32Array.from(arr);\n  const pos = (n - 1) * q;\n  const k = Math.floor(pos);\n  const frac = pos - k;\n  const vK = selectKthInPlace(a, k);\n  if (frac === 0) return vK;\n  const vK1 = selectKthInPlace(a, k + 1);\n  return vK + (vK1 - vK) * frac;\n}\nexport function selectKthInPlace(a, k, left = 0, right = a.length - 1) {\n  while (true) {\n    if (left === right) return a[left];\n    const mid = left + ((right - left) >> 1);\n    if (a[right] < a[left]) swap(a, left, right);\n    if (a[mid] < a[left]) swap(a, mid, left);\n    if (a[right] < a[mid]) swap(a, right, mid);\n    let pivot = a[mid];\n    let i = left,\n      j = right;\n    while (i <= j) {\n      while (a[i] < pivot) i++;\n      while (a[j] > pivot) j--;\n      if (i <= j) {\n        swap(a, i, j);\n        i++;\n        j--;\n      }\n    }\n    if (k <= j) right = j;\n    else if (k >= i) left = i;\n    else return a[k];\n  }\n}\nexport function swap(a, i, j) {\n  const t = a[i];\n  a[i] = a[j];\n  a[j] = t;\n}\nexport function minOf(arr) {\n  let m = +Infinity;\n  for (let i = 0; i < arr.length; i++) if (arr[i] < m) m = arr[i];\n  return m;\n}\nexport function maxOf(arr) {\n  let m = -Infinity;\n  for (let i = 0; i < arr.length; i++) if (arr[i] > m) m = arr[i];\n  return m;\n}\n\nexport function makeSampleView(x, maxSample) {\n  const N = x.length;\n  if (N <= maxSample) return toFloat32(x);\n  const stride = Math.max(1, Math.floor(N / maxSample));\n  const start = (Math.random() * stride) | 0;\n  const M = Math.ceil((N - start) / stride);\n  const out = new Float32Array(Math.min(maxSample, M));\n  for (let i = start, j = 0; i < N && j < out.length; i += stride, j++) out[j] = x[i];\n  return out;\n}\n\nexport function diff5Symmetric(x) {\n  const N = x.length,\n    xp = reflectPad(x, 2),\n    out = new Float32Array(N);\n  for (let n = 0; n < N; n++) {\n    const i = n + 2;\n    out[n] = (-xp[i - 2] - 2 * xp[i - 1] + 2 * xp[i + 1] + xp[i + 2]) * 0.125;\n  }\n  return out;\n}\nexport function diff1Central(x) {\n  const N = x.length,\n    xp = reflectPad(x, 1),\n    out = new Float32Array(N);\n  for (let n = 0; n < N; n++) {\n    const i = n + 1;\n    out[n] = 0.5 * (xp[i + 1] - xp[i - 1]);\n  }\n  return out;\n}\n\nexport function centeredMovingAverage(x, W) {\n  if (W < 3) return toFloat32(x).slice();\n  W = ensureOdd(W);\n  const L = (W - 1) >> 1,\n    xp = reflectPad(x, L),\n    N = x.length;\n  const ps = new Float64Array(xp.length + 1);\n  for (let i = 0; i < xp.length; i++) ps[i + 1] = ps[i] + xp[i];\n  const out = new Float32Array(N);\n  for (let n = 0; n < N; n++) {\n    const s = ps[n + W] - ps[n];\n    out[n] = s / W;\n  }\n  return out;\n}\n\nexport function msToSamples(fs, ms) {\n  return Math.max(1, Math.round((ms * fs) / 1000));\n}\nexport function rrMedian(rrBuf) {\n  if (!rrBuf.length) return 0;\n  return quantile(Float32Array.from(rrBuf), 0.5);\n}\nexport function rrBufPush(rrBuf, rr) {\n  rrBuf.push(rr);\n  if (rrBuf.length > 8) rrBuf.shift();\n}\nexport function clamp(v, lo, hi) {\n  return v < lo ? lo : v > hi ? hi : v;\n}\nexport function toInt32Array(a) {\n  if (a instanceof Int32Array) return a;\n  const out = new Int32Array(a.length);\n  for (let i = 0; i < a.length; i++) out[i] = a[i] | 0;\n  return out;\n}\n\nexport function argmaxAbsInRange(arr, l, r, center) {\n  let bestIdx = l,\n    bestVal = Math.abs(arr[l]);\n  for (let j = l + 1; j <= r; j++) {\n    const v = Math.abs(arr[j]);\n    if (v > bestVal) {\n      bestVal = v;\n      bestIdx = j;\n    } else if (v === bestVal) {\n      const dj = Math.abs(j - center),\n        db = Math.abs(bestIdx - center);\n      if (dj < db || (dj === db && j < bestIdx)) bestIdx = j;\n    }\n  }\n  return bestIdx;\n}\nexport function strength(arr, i) {\n  return Math.abs(arr[i] || 0);\n}\nexport function preSlopeMag(x, idx, preW) {\n  const l = Math.max(1, idx - preW),\n    r = idx;\n  let maxd = 0;\n  for (let i = l; i <= r; i++) {\n    const d = Math.abs(x[i] - x[i - 1]);\n    if (d > maxd) maxd = d;\n  }\n  return maxd;\n}\nexport function absSlice(arr, L, R) {\n  const out = new Float32Array(R - L + 1);\n  for (let i = L, j = 0; i <= R; i++, j++) out[j] = Math.abs(arr[i]);\n  return out;\n}\nexport function sortUniqueInt32(a) {\n  const tmp = Array.from(a);\n  tmp.sort((u, v) => u - v);\n  const out = [];\n  let last = null;\n  for (let i = 0; i < tmp.length; i++) {\n    const v = tmp[i] | 0;\n    if (last === null || v !== last) {\n      out.push(v);\n      last = v;\n    }\n  }\n  return Int32Array.from(out);\n}\n\nexport function absMinus(arr, c) {\n  const o = new Float32Array(arr.length);\n  for (let i = 0; i < arr.length; i++) o[i] = Math.abs(arr[i] - c);\n  return o;\n}\nexport function argmaxInRange(arr, L, R, center) {\n  let bi = L,\n    bv = arr[L];\n  for (let j = L + 1; j <= R; j++) {\n    const v = arr[j];\n    if (\n      v > bv ||\n      (v === bv && Math.abs(j - center) < Math.abs(bi - center)) ||\n      (v === bv && Math.abs(j - center) === Math.abs(bi - center) && j < bi)\n    ) {\n      bv = v;\n      bi = j;\n    }\n  }\n  return bi;\n}\nexport function snapToHillZeroCross(arr, i0, rad) {\n  const L = Math.max(1, i0 - rad),\n    R = Math.min(arr.length - 2, i0 + rad);\n  let best = -1,\n    bestD = 1e9;\n  for (let j = L; j <= R; j++) {\n    const dL = arr[j] - arr[j - 1],\n      dR = arr[j + 1] - arr[j],\n      s2 = arr[j + 1] - 2 * arr[j] + arr[j - 1];\n    if (dL > 0 && dR <= 0 && s2 < 0) {\n      const D = Math.abs(j - i0);\n      if (D < bestD) {\n        best = j;\n        bestD = D;\n      }\n    }\n  }\n  return best >= 0 ? best : i0;\n}\nexport function positiveProminence(sig, i, W) {\n  const half = (W - 1) >> 1;\n  const L = Math.max(0, i - half),\n    R = Math.min(sig.length - 1, i + half);\n  const seg = sig.subarray ? sig.subarray(L, R + 1) : sig.slice(L, R + 1);\n  const med = quantile(seg, 0.5);\n  const mad = quantile(absMinus(seg, med), 0.5) || 0;\n  const thr = Math.max(0.03, 1.5 * mad);\n  const mid = i - L;\n  const leftMed = quantile(\n    seg.subarray ? seg.subarray(0, Math.max(1, mid)) : seg.slice(0, Math.max(1, mid)),\n    0.5,\n  );\n  const rightMed = quantile(\n    seg.subarray\n      ? seg.subarray(Math.min(seg.length - 1, mid + 1))\n      : seg.slice(Math.min(seg.length - 1, mid + 1)),\n    0.5,\n  );\n  const base = Math.max(leftMed, rightMed);\n  return sig[i] >= base + thr;\n}\nexport function sidedSlopeCheck(arr, i, preW, postW) {\n  const L = Math.max(1, i - preW),\n    R = Math.min(arr.length - 1, i + postW);\n  let up = 0,\n    nL = 0;\n  for (let j = L; j <= i; j++) {\n    const dj = arr[j] - arr[j - 1];\n    if (dj !== 0) {\n      nL++;\n      if (dj > 0) up++;\n    }\n  }\n  let dn = 0,\n    nR = 0;\n  for (let j = i + 1; j <= R; j++) {\n    const dj = arr[j] - arr[j - 1];\n    if (dj !== 0) {\n      nR++;\n      if (dj < 0) dn++;\n    }\n  }\n  return (nL ? up / nL : 0) >= 0.55 && (nR ? dn / nR : 0) >= 0.55;\n}\n","import {\n  absMinus,\n  absSlice,\n  argmaxAbsInRange,\n  argmaxInRange,\n  centeredMovingAverage,\n  clamp,\n  designButterworthHP_SOS,\n  designButterworthLP_SOS,\n  diff1Central,\n  diff5Symmetric,\n  ensureOdd,\n  filtfiltBiquad,\n  makeSampleView,\n  mapAbsMinus,\n  mean,\n  msToSamples,\n  positiveProminence,\n  preSlopeMag,\n  quantile,\n  reflectPad,\n  rrBufPush,\n  rrMedian,\n  sidedSlopeCheck,\n  snapToHillZeroCross,\n  sortUniqueInt32,\n  stdDev,\n  toFloat32,\n  toInt32Array,\n} from './utils';\n\nexport function removeBaseline(ecg, fs, opts = {}) {\n  const method = opts.method || 'hp';\n  const x = toFloat32(ecg);\n  if (x.length < 4) {\n    return opts.returnBaseline\n      ? { signal: x.slice(), baseline: new Float32Array(x.length) }\n      : x.slice();\n  }\n  if (method === 'median') {\n    const win1 = ensureOdd(\n      Math.max(3, Math.round(opts.win1Ms ? (opts.win1Ms * fs) / 1000 : 0.2 * fs)),\n    );\n    const win2 = ensureOdd(\n      Math.max(3, Math.round(opts.win2Ms ? (opts.win2Ms * fs) / 1000 : 0.6 * fs)),\n    );\n    const base1 = centeredSlidingMedian(x, win1);\n    const base2 = centeredSlidingMedian(base1, win2);\n    const y = new Float32Array(x.length);\n    for (let i = 0; i < x.length; i++) y[i] = x[i] - base2[i];\n    return opts.returnBaseline ? { signal: y, baseline: base2 } : y;\n  }\n  const fc = opts.hpHz != null ? opts.hpHz : 0.7;\n  const order = opts.order === 2 ? 2 : 4;\n  const sos = designButterworthHP_SOS(fc, fs, order);\n  const y = filtfiltBiquad(x, sos);\n  if (opts.returnBaseline) {\n    const base = new Float32Array(x.length);\n    for (let i = 0; i < x.length; i++) base[i] = x[i] - y[i];\n    return { signal: y, baseline: base };\n  }\n  return y;\n}\n\nfunction centeredSlidingMedian(x, W) {\n  if (W < 3) return x.slice();\n  W = ensureOdd(W);\n  const L = (W - 1) >> 1;\n  const xp = reflectPad(x, L);\n  const med = slidingMedianCausal(xp, W);\n  return med.subarray(0, x.length).slice();\n}\n\nfunction slidingMedianCausal(arr, W) {\n  W = ensureOdd(W);\n  const nOut = arr.length - W + 1;\n  if (nOut <= 0) return new Float32Array(0);\n  function Heap(cmp) {\n    this.cmp = cmp;\n    this.a = [];\n  }\n  Heap.prototype.size = function () {\n    return this.a.length;\n  };\n  Heap.prototype.peek = function () {\n    return this.a[0];\n  };\n  Heap.prototype.push = function (v) {\n    const a = this.a;\n    a.push(v);\n    let i = a.length - 1;\n    while (i > 0) {\n      const p = (i - 1) >> 1;\n      if (!this.cmp(a[i], a[p])) break;\n      const t = a[i];\n      a[i] = a[p];\n      a[p] = t;\n      i = p;\n    }\n  };\n  Heap.prototype.pop = function () {\n    const a = this.a;\n    const top = a[0];\n    const last = a.pop();\n    if (a.length) {\n      a[0] = last;\n      let i = 0;\n      while (true) {\n        let l = 2 * i + 1,\n          r = l + 1,\n          m = i;\n        if (l < a.length && this.cmp(a[l], a[m])) m = l;\n        if (r < a.length && this.cmp(a[r], a[m])) m = r;\n        if (m === i) break;\n        const t = a[i];\n        a[i] = a[m];\n        a[m] = t;\n        i = m;\n      }\n    }\n    return top;\n  };\n  const lower = new Heap((x, y) => x.val > y.val || (x.val === y.val && x.idx > y.idx));\n  const upper = new Heap((x, y) => x.val < y.val || (x.val === y.val && x.idx < y.idx));\n  const delayed = new Map();\n  let loSize = 0,\n    hiSize = 0;\n  function prune(heap) {\n    while (heap.size()) {\n      const top = heap.peek();\n      const cnt = delayed.get(top.idx);\n      if (!cnt) break;\n      if (cnt === 1) delayed.delete(top.idx);\n      else delayed.set(top.idx, cnt - 1);\n      heap.pop();\n    }\n  }\n  function rebalance() {\n    if (loSize > hiSize + 1) {\n      prune(lower);\n      upper.push(lower.pop());\n      loSize--;\n      hiSize++;\n      prune(lower);\n    } else if (loSize < hiSize) {\n      prune(upper);\n      lower.push(upper.pop());\n      loSize++;\n      hiSize--;\n      prune(upper);\n    }\n  }\n  function add(val, idx) {\n    if (!lower.size() || val <= lower.peek().val) {\n      lower.push({ val, idx });\n      loSize++;\n    } else {\n      upper.push({ val, idx });\n      hiSize++;\n    }\n    rebalance();\n  }\n  function remove(val, idx) {\n    delayed.set(idx, (delayed.get(idx) || 0) + 1);\n    if (lower.size() && val <= lower.peek().val) loSize--;\n    else hiSize--;\n    prune(lower);\n    prune(upper);\n    rebalance();\n  }\n  const out = new Float32Array(nOut);\n  for (let i = 0; i < W; i++) add(arr[i], i);\n  prune(lower);\n  out[0] = lower.peek().val;\n  for (let i = W; i < arr.length; i++) {\n    add(arr[i], i);\n    const outIdx = i - W;\n    remove(arr[outIdx], outIdx);\n    prune(lower);\n    out[i - W + 1] = lower.peek().val;\n  }\n  return out;\n}\n\nexport function bandpassQRS(ecg, fs, opts = {}) {\n  const hp = opts.hp != null ? opts.hp : 8;\n  const lp = opts.lp != null ? opts.lp : 40;\n  const orderHP = opts.orderHP === 2 ? 2 : 4;\n  const orderLP = opts.orderLP === 2 ? 2 : 4;\n  const x = toFloat32(ecg);\n  if (x.length < 4) return x.slice();\n  const sosHP = designButterworthHP_SOS(hp, fs, orderHP);\n  const sosLP = designButterworthLP_SOS(lp, fs, orderLP);\n  const sos = sosHP.concat(sosLP);\n  return filtfiltBiquad(x, sos);\n}\n\nexport function robustNormalize(ecg, opts = {}) {\n  const x = toFloat32(ecg);\n  const N = x.length;\n  if (!N)\n    return opts.returnStats ? { signal: new Float32Array(0), stats: {} } : new Float32Array(0);\n  const centerMode = opts.center || 'median';\n  const scaleMode = opts.scale || 'mad';\n  const maxSample = opts.maxSample != null ? opts.maxSample : 200000;\n  const sample = makeSampleView(x, maxSample);\n  const center = centerMode === 'mean' ? mean(sample) : quantile(sample, 0.5);\n  let scale,\n    stats = { centerMode, scaleMode, center };\n  if (scaleMode === 'none') scale = 1.0;\n  else if (scaleMode === 'std') scale = stdDev(sample, center);\n  else if (scaleMode === 'iqr') {\n    const q1 = quantile(sample, 0.25),\n      q3 = quantile(sample, 0.75);\n    stats.q1 = q1;\n    stats.q3 = q3;\n    scale = Math.max(1e-12, (q3 - q1) / 1.349);\n  } else if (scaleMode === 'p95') {\n    const p95 = quantile(mapAbsMinus(sample, center), 0.95);\n    stats.p95abs = p95;\n    scale = Math.max(1e-12, p95);\n  } else {\n    const mad = quantile(mapAbsMinus(sample, center), 0.5);\n    stats.mad = mad;\n    scale = Math.max(1e-12, mad * 1.4826);\n  }\n  const invS = 1.0 / (scale || 1.0);\n  const y = new Float32Array(N);\n  if (opts.clipNsigma != null && isFinite(opts.clipNsigma)) {\n    const C = Math.abs(opts.clipNsigma);\n    for (let i = 0; i < N; i++) {\n      let v = (x[i] - center) * invS;\n      if (v > C) v = C;\n      if (v < -C) v = -C;\n      y[i] = v;\n    }\n    stats.clipNsigma = C;\n  } else for (let i = 0; i < N; i++) y[i] = (x[i] - center) * invS;\n  stats.scale = scale;\n  return opts.returnStats ? { signal: y, stats } : y;\n}\n\nexport function ptFeature(xIn, fs, opts = {}) {\n  const x = toFloat32(xIn);\n  const N = x.length;\n  if (!N) return new Float32Array(0);\n  const deriv = opts.deriv || 'diff5';\n  const d = deriv === 'diff1' ? diff1Central(x) : diff5Symmetric(x);\n  for (let i = 0; i < N; i++) d[i] = d[i] * d[i];\n  const W = ensureOdd(\n    Math.max(3, Math.round(((opts.mwiMs != null ? opts.mwiMs : 150) * fs) / 1000)),\n  );\n  return centeredMovingAverage(d, W);\n}\n\nexport function adaptivePeakPick(wIn, fs, opts = {}) {\n  const w = toFloat32(wIn);\n  const N = w.length;\n  if (N < 3) return new Int32Array(0);\n  const refrSamp = msToSamples(fs, opts.refractoryMs != null ? opts.refractoryMs : 200);\n  const initLen = Math.min(\n    N,\n    Math.max(1, Math.round((opts.initWinSec != null ? opts.initWinSec : 2.0) * fs)),\n  );\n  const alpha = opts.thrAlpha != null ? opts.thrAlpha : 0.25;\n  const sbFactor = opts.searchBackFactor != null ? opts.searchBackFactor : 1.66;\n  const initSeg = w.subarray(0, initLen);\n  let NPKI = quantile(initSeg, 0.2);\n  let SPKI = quantile(initSeg, 0.9);\n  let THR = NPKI + alpha * (SPKI - NPKI);\n  const peaks = [],\n    peakVals = [];\n  let lastR = -1;\n  let subMaxIdx = -1,\n    subMaxVal = -Infinity;\n  const rrBuf = [];\n  for (let i = 1; i < N - 1; i++) {\n    if (!(w[i] > w[i - 1] && w[i] >= w[i + 1])) continue;\n    const pIdx = i,\n      pVal = w[i];\n    if (peaks.length) {\n      const rr = pIdx - lastR,\n        rrMed = rrMedian(rrBuf);\n      if (rrMed > 0 && rr > Math.round(sbFactor * rrMed)) {\n        if (subMaxIdx > lastR + refrSamp) {\n          peaks.push(subMaxIdx);\n          peakVals.push(subMaxVal);\n          rrBufPush(rrBuf, subMaxIdx - lastR);\n          lastR = subMaxIdx;\n          SPKI = 0.125 * subMaxVal + 0.875 * SPKI;\n          THR = NPKI + alpha * (SPKI - NPKI);\n          subMaxIdx = -1;\n          subMaxVal = -Infinity;\n        }\n      }\n    }\n    if (pVal > THR) {\n      if (lastR >= 0 && pIdx - lastR <= refrSamp) {\n        if (pVal > peakVals[peakVals.length - 1]) {\n          peaks[peaks.length - 1] = pIdx;\n          peakVals[peakVals.length - 1] = pVal;\n          lastR = pIdx;\n        }\n      } else {\n        peaks.push(pIdx);\n        peakVals.push(pVal);\n        if (lastR >= 0) rrBufPush(rrBuf, pIdx - lastR);\n        lastR = pIdx;\n      }\n      SPKI = 0.125 * pVal + 0.875 * SPKI;\n      THR = NPKI + alpha * (SPKI - NPKI);\n      subMaxIdx = -1;\n      subMaxVal = -Infinity;\n    } else {\n      NPKI = 0.125 * pVal + 0.875 * NPKI;\n      THR = NPKI + alpha * (SPKI - NPKI);\n      if (pVal > subMaxVal) {\n        subMaxVal = pVal;\n        subMaxIdx = pIdx;\n      }\n    }\n  }\n  return Int32Array.from(peaks);\n}\n\nexport function refineOnRaw(xRaw, candIdx, fs, opts = {}) {\n  const x = toFloat32(xRaw);\n  const N = x.length;\n  const idxIn = toInt32Array(candIdx);\n  const HALF = msToSamples(fs, opts.winMs != null ? opts.winMs : 75);\n  const MICRO = Math.max(1, opts.microWin != null ? opts.microWin : 3);\n  const PRE = msToSamples(fs, 40);\n  const POST = msToSamples(fs, 40);\n  const MADW = Math.max(21, msToSamples(fs, 200) | 1);\n  const ZC_WIN = Math.max(2, msToSamples(fs, 12));\n  const hasBP = opts.xBandpass && opts.xBandpass.length === N;\n  const ref = hasBP ? opts.xBandpass : x;\n  const out = [];\n  for (let k = 0; k < idxIn.length; k++) {\n    const c = clamp(idxIn[k], 0, N - 1);\n    const L = Math.max(0, c - HALF),\n      R = Math.min(N - 1, c + HALF);\n    const rough = argmaxInRange(ref, L, R, c);\n    const l2 = Math.max(L, rough - MICRO),\n      r2 = Math.min(R, rough + MICRO);\n    let i = argmaxInRange(x, l2, r2, rough);\n    i = snapToHillZeroCross(ref, i, ZC_WIN);\n    if (i < 1 || i > N - 2) continue;\n    if (!positiveProminence(x, i, MADW)) continue;\n    if (!sidedSlopeCheck(ref, i, PRE, POST)) continue;\n    out.push(i);\n  }\n  return Int32Array.from(out);\n}\n\nexport function rrPostprocess(xRef, rIdxIn, fs, opts = {}) {\n  const x = xRef instanceof Float32Array ? xRef : Float32Array.from(xRef);\n  let r = sortUniqueInt32(rIdxIn);\n  const N = x.length;\n  if (!r.length) return r;\n  const feat = opts.feat && opts.feat.length === N ? opts.feat : null;\n  const refr = msToSamples(fs, opts.refractoryMs != null ? opts.refractoryMs : 200);\n  const minRR = msToSamples(fs, opts.minRRMs != null ? opts.minRRMs : 240);\n  const tWin = msToSamples(fs, opts.tSuppressMs != null ? opts.tSuppressMs : 200);\n  const preW = msToSamples(fs, opts.preSlopeMs != null ? opts.preSlopeMs : 40);\n  const frac = opts.tSlopeFrac != null ? opts.tSlopeFrac : 0.4;\n  const sbF = opts.sbFactor != null ? opts.sbFactor : 1.5;\n  const sbK = opts.sbK != null ? opts.sbK : 3.0;\n\n  {\n    const kept = [];\n    const base = feat || x;\n    let last = r[0];\n    for (let i = 1; i < r.length; i++) {\n      const cur = r[i];\n      if (cur - last < minRR) last = base[last] >= base[cur] ? last : cur;\n      else {\n        kept.push(last);\n        last = cur;\n      }\n    }\n    kept.push(last);\n    r = Int32Array.from(kept);\n  }\n  if (r.length <= 1) return r;\n\n  {\n    const kept = [r[0]];\n    for (let i = 1; i < r.length; i++) {\n      const prev = kept[kept.length - 1],\n        cur = r[i];\n      if (cur - prev <= tWin) {\n        const sPrev = preSlopeMag(x, prev, preW),\n          sCur = preSlopeMag(x, cur, preW);\n        if (sCur < frac * sPrev) continue;\n      }\n      kept.push(cur);\n    }\n    r = Int32Array.from(kept);\n  }\n  if (r.length <= 1) return r;\n\n  {\n    const base = feat || x;\n    const out = [r[0]];\n    const rrBuf = [];\n    for (let i = 1; i < r.length; i++) {\n      const prev = out[out.length - 1],\n        cur = r[i],\n        rr = cur - prev;\n      const rrMed = rrMedian(rrBuf),\n        needSB = rrMed > 0 && rr > Math.round(sbF * rrMed);\n      if (needSB) {\n        const L = Math.max(prev + refr, prev + 1),\n          R = Math.min(cur - refr, cur - 1);\n        if (R > L + 2) {\n          const mid = (L + R) >> 1;\n          let ins = argmaxInRange(base, L, R, mid);\n          ins = snapToHillZeroCross(base, ins, Math.max(2, msToSamples(fs, 12)));\n          if (positiveProminence(base, ins, Math.max(21, msToSamples(fs, 200) | 1))) {\n            const seg = base.subarray ? base.subarray(L, R + 1) : base.slice(L, R + 1);\n            const med = quantile(seg, 0.5);\n            const mad = quantile(absMinus(seg, med), 0.5);\n            const thr = med + sbK * (mad || 0);\n            if (base[ins] > thr) {\n              out.push(ins);\n              rrBufPush(rrBuf, ins - prev);\n              rrBufPush(rrBuf, cur - ins);\n              out.push(cur);\n              continue;\n            }\n          }\n        }\n      }\n      rrBufPush(rrBuf, rr);\n      out.push(cur);\n    }\n    r = sortUniqueInt32(out);\n  }\n  return r;\n}\n\nexport function tkeoFeature(xIn, fs, opts = {}) {\n  const x = toFloat32(xIn);\n  const N = x.length;\n  if (!N) return new Float32Array(0);\n  const xp = reflectPad(x, 1);\n  const u = new Float32Array(N);\n  for (let n = 0; n < N; n++) {\n    const a = xp[n + 1],\n      prev = xp[n],\n      next = xp[n + 2];\n    u[n] = Math.abs(a * a - prev * next);\n  }\n  const W = ensureOdd(\n    Math.max(3, Math.round(((opts.winMs != null ? opts.winMs : 120) * fs) / 1000)),\n  );\n  return centeredMovingAverage(u, W);\n}\n\nexport function tkeoCandidatePeaks(xIn, fs, opts = {}) {\n  const s = tkeoFeature(xIn, fs, { winMs: opts.winMs });\n  const sample = makeSampleView(s, opts.maxSample != null ? opts.maxSample : 200000);\n  const med = quantile(sample, 0.5);\n  const mad = quantile(mapAbsMinus(sample, med), 0.5);\n  const thr = med + (opts.k != null ? opts.k : 4.0) * (mad || 0);\n  const N = s.length,\n    refr = msToSamples(fs, opts.refractoryMs != null ? opts.refractoryMs : 200);\n  const peaks = [],\n    peakVals = [];\n  let last = -1;\n  for (let i = 1; i < N - 1; i++) {\n    if (!(s[i] > s[i - 1] && s[i] >= s[i + 1])) continue;\n    if (s[i] < thr) continue;\n    if (last >= 0 && i - last <= refr) {\n      if (s[i] > peakVals[peakVals.length - 1]) {\n        peaks[peaks.length - 1] = i;\n        peakVals[peakVals.length - 1] = s[i];\n        last = i;\n      }\n    } else {\n      peaks.push(i);\n      peakVals.push(s[i]);\n      last = i;\n    }\n  }\n  const idx = Int32Array.from(peaks);\n  return opts.returnFeature ? { indices: idx, feature: s, thr } : idx;\n}\n\nexport function fuseCandidates(lists, fs, opts = {}) {\n  const tol = msToSamples(fs, opts.mergeTolMs != null ? opts.mergeTolMs : 100);\n  const feats = Array.isArray(opts.feats) ? opts.feats : null;\n  const xRef = opts.xRef || null;\n  const all = [];\n  for (let s = 0; s < lists.length; s++) {\n    const arr = sortUniqueInt32(lists[s] || []);\n    for (let k = 0; k < arr.length; k++) {\n      const idx = arr[k];\n      const score =\n        feats && feats[s] && feats[s].length > idx\n          ? Math.abs(feats[s][idx])\n          : xRef && xRef.length > idx\n          ? Math.abs(xRef[idx])\n          : 0;\n      all.push({ idx, src: s, score });\n    }\n  }\n  if (!all.length)\n    return opts.returnMeta ? { indices: new Int32Array(0), meta: [] } : new Int32Array(0);\n  all.sort((a, b) => a.idx - b.idx);\n  const out = [],\n    meta = [];\n  let group = [all[0]];\n  for (let i = 1; i < all.length; i++) {\n    const prev = group[group.length - 1],\n      cur = all[i];\n    if (cur.idx - prev.idx <= tol) group.push(cur);\n    else {\n      flushGroup(group, out, meta);\n      group = [cur];\n    }\n  }\n  flushGroup(group, out, meta);\n  const indices = Int32Array.from(out);\n  return opts.returnMeta ? { indices, meta } : indices;\n\n  function flushGroup(g, out, meta) {\n    if (!g || !g.length) return;\n    let best = g[0];\n    for (let j = 1; j < g.length; j++) if (g[j].score > best.score) best = g[j];\n    out.push(best.idx);\n    if (opts.returnMeta) {\n      const sources = new Set();\n      for (const e of g) sources.add(e.src);\n      meta.push({\n        i: best.idx,\n        votes: Array.from(sources).length,\n        sources: Array.from(sources).sort((a, b) => a - b),\n      });\n    }\n  }\n}\n\nexport function scoreConfidence(rIdxIn, ctx, fs, opts = {}) {\n  const r = sortUniqueInt32(rIdxIn);\n  const M = r.length;\n  const xRef = toFloat32(ctx.xRef || []);\n  const wPT = ctx.wPT ? toFloat32(ctx.wPT) : null;\n  const sTK = ctx.sTKEO ? toFloat32(ctx.sTKEO) : null;\n  const meta = Array.isArray(ctx.meta) ? ctx.meta : null;\n  const N = xRef.length;\n  if (!M) return [];\n  const featWin = msToSamples(fs, opts.featWinMs != null ? opts.featWinMs : 800);\n  const ampWin = msToSamples(fs, opts.ampWinMs != null ? opts.ampWinMs : 800);\n  const voteTol = msToSamples(fs, opts.voteTolMs != null ? opts.voteTolMs : 60);\n  const kVote = opts.kVote != null ? opts.kVote : 3.0;\n  const W = Object.assign({ energy: 0.5, votes: 0.25, rr: 0.25 }, opts.weights || {});\n  const wsum = Math.max(1e-12, W.energy + W.votes + W.rr);\n  W.energy /= wsum;\n  W.votes /= wsum;\n  W.rr /= wsum;\n  const Z = Object.assign({ z0: 2.0, zMax: 8.0, tauRR: 1.0 }, opts.z || {});\n  const eps = 1e-12;\n\n  const rr = [];\n  for (let i = 1; i < M; i++) rr.push(r[i] - r[i - 1]);\n  const rrArr = Float32Array.from(rr);\n  const rrMed = rrArr.length ? quantile(rrArr, 0.5) : 0;\n  const rrMAD = rrArr.length ? quantile(mapAbsMinus(rrArr, rrMed), 0.5) : 0;\n  const rrMADs = rrMAD * 1.4826 || (10 * fs) / 1000;\n\n  function clip01(v) {\n    return v < 0 ? 0 : v > 1 ? 1 : v;\n  }\n  function zToScoreLinear(z, z0, zMax) {\n    return clip01((z - z0) / Math.max(1e-6, zMax - z0));\n  }\n  function devToScoreGaussian(zdev, tau) {\n    return Math.exp(-0.5 * Math.pow(zdev / Math.max(1e-6, tau), 2));\n  }\n  function nearestMetaVotes(meta, idx, tolSamp) {\n    if (!meta) return -1;\n    let best = -1,\n      bestD = tolSamp + 1;\n    for (let j = 0; j < meta.length; j++) {\n      const d = Math.abs((meta[j].i | 0) - idx);\n      if (d <= tolSamp && d < bestD) {\n        bestD = d;\n        best = j;\n      }\n    }\n    return best >= 0 ? Math.min(2, Math.max(0, meta[best].votes | 0)) : -1;\n  }\n  function localZAt(arr, idx, halfWin, useAbs) {\n    if (!arr || !arr.length) return 0;\n    const L = Math.max(0, idx - halfWin),\n      R = Math.min(arr.length - 1, idx + halfWin);\n    if (R <= L) return 0;\n    const seg = useAbs\n      ? absSlice(arr, L, R)\n      : Float32Array.from(arr.subarray ? arr.subarray(L, R + 1) : arr.slice(L, R + 1));\n    const med = quantile(seg, 0.5);\n    const mad = quantile(mapAbsMinus(seg, med), 0.5) * 1.4826 || 1e-9;\n    const val = useAbs ? Math.abs(arr[idx]) : arr[idx];\n    return (val - med) / mad;\n  }\n  function voteFromFeat(feat, idx, halfWin, k) {\n    if (!feat || !feat.length) return 0;\n    const L = Math.max(0, idx - halfWin),\n      R = Math.min(feat.length - 1, idx + halfWin);\n    const j = argmaxAbsInRange(feat, L, R, idx);\n    const seg = absSlice(feat, L, R);\n    const med = quantile(seg, 0.5);\n    const mad = quantile(mapAbsMinus(seg, med), 0.5);\n    const thr = med + k * (mad || 0);\n    return Math.abs(feat[j]) > thr ? 1 : 0;\n  }\n\n  const out = new Array(M);\n  for (let k = 0; k < M; k++) {\n    const idx = r[k];\n    let ptScore = 0,\n      tkScore = 0;\n    const featHalf = Math.max(1, Math.floor(featWin / 2));\n    if (wPT && wPT.length) {\n      const j = argmaxAbsInRange(\n        wPT,\n        Math.max(0, idx - featHalf),\n        Math.min(wPT.length - 1, idx + featHalf),\n        idx,\n      );\n      const z = localZAt(wPT, j, featHalf, false);\n      ptScore = zToScoreLinear(Math.abs(z), Z.z0, Z.zMax);\n    }\n    if (sTK && sTK.length) {\n      const j = argmaxAbsInRange(\n        sTK,\n        Math.max(0, idx - featHalf),\n        Math.min(sTK.length - 1, idx + featHalf),\n        idx,\n      );\n      const z = localZAt(sTK, j, featHalf, false);\n      tkScore = zToScoreLinear(Math.abs(z), Z.z0, Z.zMax);\n    }\n    const featScore = Math.max(ptScore, tkScore);\n    const ampHalf = Math.max(1, Math.floor(ampWin / 2));\n    const zAmp = localZAt(xRef, idx, ampHalf, true);\n    const ampScore = zToScoreLinear(Math.abs(zAmp), Z.z0, Z.zMax);\n    const energy = 0.7 * featScore + 0.3 * ampScore;\n\n    let votes = -1;\n    if (meta) {\n      const v = nearestMetaVotes(meta, idx, voteTol);\n      if (v >= 0) votes = v;\n    }\n    if (votes < 0) {\n      const half = Math.max(1, Math.floor(msToSamples(fs, 60) / 2));\n      let v = 0;\n      if (wPT) v += voteFromFeat(wPT, idx, half, kVote);\n      if (sTK) v += voteFromFeat(sTK, idx, half, kVote);\n      votes = Math.min(2, v);\n    }\n    const voteScore = votes / 2;\n    const rrPrev = k > 0 ? r[k] - r[k - 1] : NaN;\n    const rrNext = k < M - 1 ? r[k + 1] - r[k] : NaN;\n    const devPrev = isFinite(rrPrev) ? Math.abs(rrPrev - rrMed) / (rrMADs + eps) : Infinity;\n    const devNext = isFinite(rrNext) ? Math.abs(rrNext - rrMed) / (rrMADs + eps) : Infinity;\n    const devZ = Math.min(devPrev, devNext);\n    const rrScore = isFinite(devZ) ? devToScoreGaussian(devZ, Z.tauRR) : 0.7;\n    const conf = Math.max(0, Math.min(1, W.energy * energy + W.votes * voteScore + W.rr * rrScore));\n    out[k] = {\n      i: idx,\n      tMs: (idx * 1000) / fs,\n      conf,\n      parts: { energy, votes: voteScore, rr: rrScore },\n      votes,\n    };\n  }\n  return out;\n}\n\nexport function notch(ecg, fs, opts = {}) {\n  const f0 = opts.f0 != null ? opts.f0 : 50;\n  const Q = opts.Q != null ? opts.Q : 30;\n  const order = opts.order === 4 ? 4 : 2;\n  if (!(fs > 0)) throw new Error('notch: fs must be > 0');\n  if (!(f0 > 0 && f0 < fs * 0.5)) throw new Error('notch: f0 must be in (0, Nyquist)');\n  const x = toFloat32(ecg);\n  if (x.length < 4) return x.slice();\n  const sos = designNotch_SOS(f0, fs, Q, order);\n  return filtfiltBiquad(x, sos);\n}\n\nfunction designNotchBiquad(f0, fs, Q) {\n  const w0 = (2 * Math.PI * f0) / fs,\n    cosw0 = Math.cos(w0),\n    sinw0 = Math.sin(w0);\n  const alpha = sinw0 / (2 * Q);\n  let b0 = 1,\n    b1 = -2 * cosw0,\n    b2 = 1,\n    a0 = 1 + alpha,\n    a1 = -2 * cosw0,\n    a2 = 1 - alpha;\n  b0 /= a0;\n  b1 /= a0;\n  b2 /= a0;\n  a1 /= a0;\n  a2 /= a0;\n  return { b0, b1, b2, a1, a2 };\n}\nfunction designNotch_SOS(f0, fs, Q, order) {\n  if (order === 4) return [designNotchBiquad(f0, fs, Q), designNotchBiquad(f0, fs, Q)];\n  return [designNotchBiquad(f0, fs, Q)];\n}\n\nexport function keepHillsOnlyV2(xRefIn, rIdxIn, fs) {\n  const LOCAL_MS = 8,\n    PRE_MS = 40,\n    POST_MS = 40,\n    DER_MS = 12,\n    MAD_MS = 200;\n  const RISE_RATIO = 0.55,\n    FALL_RATIO = 0.55,\n    PROM_FLOOR = 0.03,\n    PROM_KMAD = 1.5;\n  const x = toFloat32(xRefIn);\n  const idx = sortUniqueInt32(rIdxIn);\n  const N = x.length;\n  if (!N || !idx.length) return new Int32Array(0);\n  const Wloc = Math.max(1, msToSamples(fs, LOCAL_MS));\n  const Lpre = Math.max(1, msToSamples(fs, PRE_MS));\n  const Rpost = Math.max(1, msToSamples(fs, POST_MS));\n  const Wder = Math.max(3, ensureOdd(msToSamples(fs, DER_MS)));\n  const Wmad = Math.max(21, ensureOdd(msToSamples(fs, MAD_MS)));\n  const d = smoothDiff(x, Wder);\n  const out = [];\n  for (let k = 0; k < idx.length; k++) {\n    const i = idx[k] | 0;\n    if (i <= 0 || i >= N - 1) continue;\n    const Lm = Math.max(0, i - Wloc),\n      Rm = Math.min(N - 1, i + Wloc);\n    if (!isLocalMax(x, i, Lm, Rm)) continue;\n    const Ll = Math.max(1, i - Lpre),\n      Rr = Math.min(N - 1, i + Rpost);\n    let upPos = 0,\n      upTot = 0;\n    for (let j = Ll; j <= i; j++) {\n      const dj = d[j];\n      if (dj !== 0) {\n        upTot++;\n        if (dj > 0) upPos++;\n      }\n    }\n    let dnNeg = 0,\n      dnTot = 0;\n    for (let j = i + 1; j <= Rr; j++) {\n      const dj = d[j];\n      if (dj !== 0) {\n        dnTot++;\n        if (dj < 0) dnNeg++;\n      }\n    }\n    const fracUp = upTot ? upPos / upTot : 0,\n      fracDn = dnTot ? dnNeg / dnTot : 0;\n    if (fracUp < RISE_RATIO || fracDn < FALL_RATIO) continue;\n    const Lm2 = Math.max(0, i - ((Wmad - 1) >> 1)),\n      Rm2 = Math.min(N - 1, i + ((Wmad - 1) >> 1));\n    const seg = x.subarray ? x.subarray(Lm2, Rm2 + 1) : x.slice(Lm2, Rm2 + 1);\n    const med = quantile(seg, 0.5);\n    const mad = quantile(absMinus(seg, med), 0.5);\n    const promThr = Math.max(PROM_FLOOR, PROM_KMAD * (mad || 0));\n    const mid = i - Lm2;\n    const leftMed = quantile(\n      seg.subarray ? seg.subarray(0, Math.max(1, mid)) : seg.slice(0, Math.max(1, mid)),\n      0.5,\n    );\n    const rightMed = quantile(\n      seg.subarray\n        ? seg.subarray(Math.min(seg.length - 1, mid + 1))\n        : seg.slice(Math.min(seg.length - 1, mid + 1)),\n      0.5,\n    );\n    const base = Math.max(leftMed, rightMed);\n    if (x[i] - base < promThr) continue;\n    out.push(i);\n  }\n  return Int32Array.from(out);\n\n  function isLocalMax(arr, i, L, R) {\n    const v = arr[i];\n    for (let j = L; j <= R; j++) if (arr[j] > v) return false;\n    return true;\n  }\n  function smoothDiff(x, W) {\n    const N = x.length,\n      L = (W - 1) >> 1,\n      xp = reflectPad(x, L),\n      out = new Float32Array(N);\n    for (let n = 0; n < N; n++) {\n      const i = n + L;\n      let s = 0;\n      for (let k = 1; k <= L; k++) s += xp[i + k] - xp[i - k];\n      out[n] = s / W;\n    }\n    return out;\n  }\n}\n","import {\n  adaptivePeakPick,\n  bandpassQRS,\n  fuseCandidates,\n  keepHillsOnlyV2,\n  ptFeature,\n  refineOnRaw,\n  removeBaseline,\n  robustNormalize,\n  rrPostprocess,\n  tkeoCandidatePeaks,\n  tkeoFeature,\n} from './signalConversionGPT';\nimport { toFloat32 } from './utils';\n\nexport function detectRPeaks(signal, opts = {}) {\n  const fs = 400;\n  const signalData = signal[0].data.map((item) => item[1]);\n  const signalTime = signal[0].data.map((item) => item[0]);\n  const x0 = toFloat32(signalData);\n  const xBaseRemoved = removeBaseline(x0, fs, opts.baseline || { method: 'hp' });\n  const xBP = bandpassQRS(xBaseRemoved, fs, opts.bandpass || { hp: 8, lp: 40 });\n  const xNR =\n    robustNormalize(xBP, opts.normalize || {}).signal || robustNormalize(xBP, opts.normalize || {});\n  const wPT = ptFeature(xNR, fs, opts.pt || {});\n  const sTKEO = tkeoFeature(xNR, fs, opts.tkeo || {});\n  const candPT = adaptivePeakPick(wPT, fs, opts.pick || {});\n  const candTK = tkeoCandidatePeaks(\n    xNR,\n    fs,\n    Object.assign({ returnFeature: false }, opts.tkeoPick || {}),\n  );\n  const fusedMeta = fuseCandidates([candPT, candTK], fs, {\n    feats: [wPT, sTKEO],\n    xRef: xNR,\n    mergeTolMs: (opts.fuse && opts.fuse.mergeTolMs) || 100,\n    returnMeta: true,\n  });\n  const fusedIdx = fusedMeta.indices;\n  const refined = refineOnRaw(x0, fusedIdx, fs, { xBandpass: xBP, ...(opts.refine || {}) });\n  const rr = rrPostprocess(xNR, refined, fs, { feat: wPT, ...(opts.rr || {}) });\n  const rClean = keepHillsOnlyV2(xNR, rr, fs);\n  return {\n    series: signalTime.map((item, i) => [item, rClean.includes(i) ? 100 : 0]),\n    data: Array.from(rClean),\n  };\n}\n","export function zeros(n) {\n  return new Array(n).fill(0);\n}\n\nexport function sign(x) {\n  if (x === 0) return 0;\n  return x > 0 ? 1 : -1;\n}\n\nexport function find(arr, predicate) {\n  const idx = [];\n  if (typeof predicate === 'function') {\n    for (let i = 0; i < arr.length; i++) if (predicate(arr[i], i, arr)) idx.push(i);\n  } else {\n    for (let i = 0; i < arr.length; i++) if (arr[i]) idx.push(i);\n  }\n  return idx;\n}\n\nexport function diff(arr) {\n  if (!Array.isArray(arr) || arr.length === 0) return [];\n  const out = new Array(arr.length - 1);\n  for (let i = 0; i < arr.length - 1; i++) out[i] = arr[i + 1] - arr[i];\n  return out;\n}\n\nexport function conv(x, h) {\n  const N = x.length,\n    M = h.length;\n  const y = zeros(N + M - 1);\n  for (let n = 0; n < y.length; n++) {\n    let acc = 0;\n    const kmin = Math.max(0, n - (M - 1));\n    const kmax = Math.min(n, N - 1);\n    for (let k = kmin; k <= kmax; k++) {\n      acc += x[k] * h[n - k];\n    }\n    y[n] = acc;\n  }\n  return y;\n}\n\nfunction hamming(N) {\n  const win = new Array(N);\n  for (let n = 0; n < N; n++) {\n    win[n] = 0.54 - 0.46 * Math.cos((2 * Math.PI * n) / (N - 1));\n  }\n  return win;\n}\n\nfunction sinc(x) {\n  if (x === 0) return 1;\n  const pix = Math.PI * x;\n  return Math.sin(pix) / pix;\n}\n\nexport function fir1Bandpass(order, wl, wh, window = 'hamming') {\n  if (!Array.isArray(wl)) {\n    wh = arguments[2];\n    window = arguments[3] ?? 'hamming';\n  }\n  const Wl = Array.isArray(wl) ? wl[0] : wl;\n  const Wh = Array.isArray(wl) ? wl[1] : wh;\n\n  const N = order + 1;\n  const M = order / 2;\n  const win = window === 'hamming' ? hamming(N) : hamming(N);\n  const h = new Array(N);\n  for (let n = 0; n < N; n++) {\n    const k = n - M;\n    const ideal = 2 * Wh * sinc(2 * Wh * k) - 2 * Wl * sinc(2 * Wl * k);\n    h[n] = ideal * win[n];\n  }\n  return h;\n}\n\nexport function designBandpassForECG({ A = 26, fs = 400, f1 = 5, f2 = 30 } = {}) {\n  const nyq = fs / 2;\n  const wl = f1 / nyq;\n  const wh = f2 / nyq;\n  return fir1Bandpass(A, [wl, wh]);\n}\n\nconst A = 26;\nconst fs = 400;\nexport const bp = designBandpassForECG({ A, fs, f1: 5, f2: 30 });\n\nexport function removeGroupDelayAfterConv(fullConv, A_even_order) {\n  const delay = A_even_order / 2;\n  return fullConv.slice(delay, fullConv.length - delay);\n}\n","import { getTopValue } from '../utils';\r\nimport { conv, designBandpassForECG, removeGroupDelayAfterConv, sign, zeros } from './utils';\r\n\r\nexport function processSignal(ecg, fs = 400) {\r\n  const A = 26;\r\n  const gain = 4;\r\n  const lambda = 0.99;\r\n  const bp = designBandpassForECG({ A, fs, f1: 5, f2: 30 });\r\n  const filter_signal_delay = conv(bp, ecg);\r\n  const filter_signal = removeGroupDelayAfterConv(filter_signal_delay, A);\r\n  const nonlinear = filter_signal.map((v) => sign(v) * v ** 2);\r\n  const K = zeros(nonlinear.length);\r\n  for (let j = 0; j < nonlinear.length - 1; j++) {\r\n    K[j + 1] = lambda * K[j] + (1 - lambda) * gain * Math.abs(nonlinear[j + 1]);\r\n  }\r\n  const b = K.map((v, j) => (j % 2 === 0 ? 1 : -1) * v);\r\n  const new_signal = nonlinear.map((v, i) => v + b[i]);\r\n  return {\r\n    filter_signal: filter_signal,\r\n    nonlinear: nonlinear,\r\n    new_signal: new_signal,\r\n  };\r\n}\r\n\r\nexport function getFinalResult(new_signal, nonlinear) {\r\n  const d = new Array(new_signal.length).fill(0);\r\n\r\n  for (let j = 0; j < new_signal.length - 1; j++) {\r\n    d[j + 1] = 0.5 * Math.abs(Math.sign(new_signal[j + 1]) - Math.sign(new_signal[j]));\r\n  }\r\n\r\n  const lambda2 = 0.99;\r\n  const D = new Array(new_signal.length).fill(0);\r\n\r\n  for (let j = 0; j < new_signal.length - 1; j++) {\r\n    D[j + 1] = lambda2 * D[j] + (1 - lambda2) * d[j + 1];\r\n  }\r\n\r\n  const lambda3 = 0.97;\r\n  const threshold = new Array(new_signal.length).fill(0);\r\n\r\n  for (let j = 0; j < new_signal.length - 1; j++) {\r\n    threshold[j + 1] = lambda3 * threshold[j] + (1 - lambda3) * D[j + 1];\r\n  }\r\n\r\n  const positive = new Array(D.length).fill(0);\r\n  const negative = new Array(D.length).fill(0);\r\n\r\n  for (let j = 0; j < d.length; j++) {\r\n    if (d[j] < threshold[j]) {\r\n      positive[j] = 1;\r\n    } else {\r\n      negative[j] = 1;\r\n    }\r\n  }\r\n  const locs_pos = [];\r\n  const locs_neg = [];\r\n  for (let j = 0; j < positive.length; j++) {\r\n    if (positive[j] === 1) locs_pos.push(j);\r\n    if (negative[j] === 1) locs_neg.push(j);\r\n  }\r\n\r\n  const difference_pos = [];\r\n  for (let i = 1; i < locs_pos.length; i++) {\r\n    difference_pos.push(locs_pos[i] - locs_pos[i - 1]);\r\n  }\r\n\r\n  const difference_neg = [];\r\n  for (let i = 1; i < locs_neg.length; i++) {\r\n    difference_neg.push(locs_neg[i] - locs_neg[i - 1]);\r\n  }\r\n\r\n  const ind_pos = [];\r\n  difference_pos.forEach((diff, i) => {\r\n    if (diff > 1) ind_pos.push(i);\r\n  });\r\n\r\n  const ind_neg = [];\r\n\r\n  difference_neg.forEach((diff, i) => {\r\n    if (diff > 1) ind_neg.push(i);\r\n  });\r\n\r\n  const upper_limit = ind_pos.map((i) => locs_pos[i + 1]);\r\n  const lower_limit = ind_neg.map((i) => locs_neg[i + 1]);\r\n\r\n  const event = [];\r\n\r\n  for (let j = 0; j < upper_limit.length; j++) {\r\n    event.push([lower_limit[j], upper_limit[j]]);\r\n  }\r\n  const new_event = [];\r\n  const dist_event = [];\r\n\r\n  for (let j = 0; j < event.length - 1; j++) {\r\n    dist_event.push(event[j + 1][0] - event[j][1]);\r\n\r\n    if (dist_event[j] <= 30) {\r\n      new_event.push([event[j][0], event[j + 1][1]]);\r\n    } else {\r\n      new_event.push(event[j]);\r\n      if (j === event.length - 2) {\r\n        new_event.push(event[event.length - 1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  const new_new_event = [];\r\n  const new_dist_event = [];\r\n  for (let j = 0; j < new_event.length - 1; j++) {\r\n    new_dist_event.push(new_event[j + 1][0] - new_event[j][1]);\r\n\r\n    new_new_event.push(new_event[j]);\r\n    if (j === new_event.length - 2) {\r\n      new_new_event.push(new_event[new_event.length - 1]);\r\n    }\r\n  }\r\n  const new_new_event_filtered = new_new_event.filter((item) => item !== null);\r\n  for (let j = 0; j < new_new_event.length - 1; j++) {\r\n    if (new_new_event_filtered[j][1] === new_new_event_filtered[j + 1][1]) {\r\n      new_new_event[j + 1] = null;\r\n    }\r\n  }\r\n\r\n  const filtered_events = new_new_event.filter((e) => e !== null);\r\n\r\n  const final_event = [];\r\n  for (let j = 0; j < filtered_events.length; j++) {\r\n    const start = filtered_events[j][0];\r\n    const end = filtered_events[j][1];\r\n    const event_size = end - start;\r\n\r\n    if (event_size >= 30) {\r\n      final_event.push([start, end]);\r\n    }\r\n  }\r\n\r\n  const abs_max = [];\r\n  const abs_min = [];\r\n  for (let j = 0; j < final_event.length; j++) {\r\n    const [start, end] = final_event[j];\r\n    const segment = nonlinear.slice(start, end + 1).filter((item) => item > 0);\r\n    abs_max.push(getTopValue(segment, 'max'));\r\n    abs_min.push(getTopValue(segment, 'min'));\r\n  }\r\n\r\n  const RR_amp = [];\r\n  for (let j = 0; j < final_event.length; j++) {\r\n    if (abs_min[j] - abs_max[j] > 10) {\r\n      RR_amp.push(abs_min[j]);\r\n    } else {\r\n      RR_amp.push(abs_max[j]);\r\n    }\r\n  }\r\n\r\n  // const abs_nonlinear = nonlinear.map(Math.abs);  !!!!!!\r\n  const abs_nonlinear = nonlinear.map((item) => (item > 0 ? item : 0));\r\n  const RR_location = [];\r\n\r\n  for (let j = 0; j < final_event.length; j++) {\r\n    const [start, end] = final_event[j];\r\n    const segment = abs_nonlinear.slice(start, end + 1);\r\n    const idx = segment.findIndex((value) => value === RR_amp[j]);\r\n    RR_location.push(start + idx);\r\n  }\r\n\r\n  const RR_amp_values = RR_location.map((idx) => abs_nonlinear[idx]);\r\n\r\n  let RR_time = [...RR_location];\r\n\r\n  for (let j = 0; j < RR_time.length - 1; j++) {\r\n    const minDistance = 100;\r\n    if (RR_time[j + 1] - RR_time[j] < minDistance) {\r\n      if (RR_amp_values[j] < RR_amp_values[j + 1]) {\r\n        RR_time[j] = null;\r\n      } else {\r\n        RR_time[j + 1] = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  return { finalPeaks: (RR_time = RR_time.filter((v) => v !== null)), d, D, threshold };\r\n}\r\n","export const preprocessKHO = (signal) => {\n  const signalData = signal[0].data.map((obj) => obj[1]);\n  const MWMFiltered = mwmFilter(signalData);\n  return MWMFiltered;\n};\n\nfunction mwmFilter(signal, fs = 400) {\n  const L1 = Math.round(0.1 * fs);\n  const L2 = Math.round(0.4 * fs);\n  const flen1 = Math.floor(L1 / 2);\n  const flen2 = Math.floor(L2 / 2);\n  const N = signal.length;\n\n  const ch = Array.from(signal, Number);\n\n  const x1 = movingMedian(ch, flen1);\n  const x2 = movingMedian(x1, flen2);\n  const filtered = new Array(N);\n  for (let i = 0; i < N; i++) filtered[i] = ch[i] - x2[i];\n\n  return filtered;\n  function movingMedian(arr, half) {\n    const out = new Array(arr.length);\n    for (let j = 0; j < arr.length; j++) {\n      const start = Math.max(0, j - half);\n      const end = Math.min(arr.length - 1, j + half);\n      const win = arr.slice(start, end + 1).sort((a, b) => a - b);\n      const m = Math.floor(win.length / 2);\n      out[j] = win.length % 2 === 1 ? win[m] : 0.5 * (win[m - 1] + win[m]);\n    }\n    return out;\n  }\n}\n","import { getFinalResult, processSignal } from './SignalConversionKHO';\r\nimport { preprocessKHO } from './preprocessKHO';\r\n\r\nexport function analyzeECGKHO(signal, fs = 400) {\r\n  const signalTime = signal[0].data.map((obj) => obj[0]);\r\n  const signalData = signal[0].data.map((obj) => obj[1]);\r\n  const transformSignal = (filtered) => signalTime.map((item, i) => [item, filtered[i]]);\r\n  const preFiltered = preprocessKHO(signal);\r\n  const { filter_signal, nonlinear, new_signal } = processSignal(preFiltered, fs);\r\n  const { finalPeaks, D } = getFinalResult(new_signal, nonlinear, preFiltered);\r\n  return {\r\n    filteredSignal: transformSignal(filter_signal),\r\n    nonlinearizedSignal: transformSignal(nonlinear),\r\n    HFSignal: transformSignal(new_signal),\r\n    zeroCrossingSignal: transformSignal(D),\r\n    preFiltered: transformSignal(preFiltered),\r\n    peaks: {\r\n      series: signalTime.map((item, i) => [\r\n        item,\r\n        finalPeaks.includes(i) && signalData[i] > 0 ? 50 : 0,\r\n      ]),\r\n      data: finalPeaks,\r\n    },\r\n  };\r\n}\r\n","function toF64(arr) {\n  if (arr instanceof Float64Array) return arr.slice();\n  const out = new Float64Array(arr.length);\n  for (let i = 0; i < arr.length; i++) out[i] = arr[i];\n  return out;\n}\n\nfunction reflectIndex(i, N) {\n  if (N === 1) return 0;\n  while (i < 0 || i >= N) {\n    if (i < 0) i = -i - 1;\n    if (i >= N) i = 2 * N - i - 1;\n  }\n  return i;\n}\n\nfunction oddWindowSize(samples) {\n  const s = Math.max(1, Math.round(samples));\n  return s % 2 === 0 ? s + 1 : s;\n}\n\nfunction highPassOnePole(x, fs, fc = 0.5) {\n  const dt = 1 / fs;\n  const RC = 1 / (2 * Math.PI * fc);\n  const alpha = RC / (RC + dt);\n\n  const N = x.length;\n  const xin = toF64(x);\n  const y = new Float64Array(N);\n  y[0] = 0;\n  for (let n = 1; n < N; n++) {\n    y[n] = alpha * (y[n - 1] + xin[n] - xin[n - 1]);\n  }\n  return y;\n}\n\nfunction medianFilter(x, windowSamples) {\n  const N = x.length;\n  const xin = toF64(x);\n  const W = oddWindowSize(windowSamples);\n  const half = (W - 1) >> 1;\n  const y = new Float64Array(N);\n  const buf = new Float64Array(W);\n\n  for (let n = 0; n < N; n++) {\n    for (let k = -half, j = 0; k <= half; k++, j++) {\n      buf[j] = xin[reflectIndex(n + k, N)];\n    }\n\n    const arr = Array.from(buf);\n    arr.sort((a, b) => a - b);\n    y[n] = arr[half];\n  }\n  return y;\n}\n\nfunction doubleMedianBaselineSubtract(x, fs, win1_ms = 200, win2_ms = 600) {\n  const w1 = Math.round((win1_ms / 1000) * fs);\n  const w2 = Math.round((win2_ms / 1000) * fs);\n\n  const m1 = medianFilter(x, w1);\n  const baseline = medianFilter(m1, w2);\n\n  const N = baseline.length;\n  const xin = toF64(x);\n  const corrected = new Float64Array(N);\n  for (let i = 0; i < N; i++) corrected[i] = xin[i] - baseline[i];\n\n  return { baseline, corrected };\n}\n\nfunction stage1_preprocess(ecg, fs = 400) {\n  const hpf = highPassOnePole(ecg, fs, 0.5);\n  const { baseline, corrected } = doubleMedianBaselineSubtract(hpf, fs, 200, 600);\n  return {\n    hpf,\n    baseline,\n    detrended: corrected,\n  };\n}\nfunction reflectPad(x, pad) {\n  const N = x.length;\n  const out = new Float64Array(N + 2 * pad);\n  for (let i = 0; i < pad; i++) {\n    out[i] = x[reflectIndex(pad - i - 1, N)];\n  }\n  for (let i = 0; i < N; i++) out[pad + i] = x[i];\n  for (let i = 0; i < pad; i++) {\n    out[pad + N + i] = x[reflectIndex(N - 2 - i, N)];\n  }\n  return out;\n}\n\nfunction biquadFilter(x, coeffs) {\n  const { b0, b1, b2, a1, a2 } = coeffs;\n  const N = x.length;\n  const xin = toF64(x);\n  const y = new Float64Array(N);\n\n  let x1 = 0,\n    x2 = 0;\n  let y1 = 0,\n    y2 = 0;\n\n  for (let n = 0; n < N; n++) {\n    const xn = xin[n];\n    const yn = b0 * xn + b1 * x1 + b2 * x2 - a1 * y1 - a2 * y2;\n    y[n] = yn;\n    x2 = x1;\n    x1 = xn;\n    y2 = y1;\n    y1 = yn;\n  }\n  return y;\n}\n\nfunction rbjLowpassCoeffs(fs, fc, Q = 1 / Math.SQRT2) {\n  const w0 = 2 * Math.PI * (fc / fs);\n  const cosw0 = Math.cos(w0);\n  const sinw0 = Math.sin(w0);\n  const alpha = sinw0 / (2 * Q);\n\n  let b0 = (1 - cosw0) / 2;\n  let b1 = 1 - cosw0;\n  let b2 = (1 - cosw0) / 2;\n  let a0 = 1 + alpha;\n  let a1 = -2 * cosw0;\n  let a2 = 1 - alpha;\n  b0 /= a0;\n  b1 /= a0;\n  b2 /= a0;\n  a1 /= a0;\n  a2 /= a0;\n\n  return { b0, b1, b2, a1, a2 };\n}\n\nfunction biquadCascadeForward(x, sections) {\n  let y = toF64(x);\n  for (const s of sections) y = biquadFilter(y, s);\n  return y;\n}\n\nfunction filtfiltCascade(x, sections, fs = 400, padSeconds = 0.25) {\n  const N = x.length;\n  if (N < 3) return toF64(x);\n\n  const pad = Math.min(N - 1, Math.max(12, Math.round(fs * padSeconds)));\n  const padded = reflectPad(x, pad);\n  let y = biquadCascadeForward(padded, sections);\n  y = y.reverse();\n  y = biquadCascadeForward(y, sections);\n  y = y.reverse();\n  const out = new Float64Array(N);\n  for (let i = 0; i < N; i++) out[i] = y[pad + i];\n  return out;\n}\n\nfunction rbjHighpassCoeffs(fs, fc, Q = 1 / Math.SQRT2) {\n  const w0 = 2 * Math.PI * (fc / fs);\n  const cosw0 = Math.cos(w0);\n  const sinw0 = Math.sin(w0);\n  const alpha = sinw0 / (2 * Q);\n\n  let b0 = (1 + cosw0) / 2;\n  let b1 = -(1 + cosw0);\n  let b2 = (1 + cosw0) / 2;\n  let a0 = 1 + alpha;\n  let a1 = -2 * cosw0;\n  let a2 = 1 - alpha;\n\n  b0 /= a0;\n  b1 /= a0;\n  b2 /= a0;\n  a1 /= a0;\n  a2 /= a0;\n  return { b0, b1, b2, a1, a2 };\n}\n\nconst BUTTER_QS_4 = [0.541196100146197, 1.3065629648763766];\n\nfunction hpSections(fs, fc, order = 2) {\n  if (order === 2) return [rbjHighpassCoeffs(fs, fc, 1 / Math.SQRT2)];\n  if (order === 4) return BUTTER_QS_4.map((q) => rbjHighpassCoeffs(fs, fc, q));\n}\n\nfunction lpSections(fs, fc, order = 4) {\n  if (order === 2) return [rbjLowpassCoeffs(fs, fc, 1 / Math.SQRT2)];\n  if (order === 4) return BUTTER_QS_4.map((q) => rbjLowpassCoeffs(fs, fc, q));\n}\n\nfunction bandpass5to18(\n  ecg,\n  fs = 400,\n  { hpOrder = 2, lpOrder = 4, zeroPhase = true, padSeconds = 0.25 } = {},\n) {\n  const sections = [...hpSections(fs, 5, hpOrder), ...lpSections(fs, 18, lpOrder)];\n  if (zeroPhase) {\n    return filtfiltCascade(ecg, sections, fs, padSeconds);\n  } else {\n    return sections.reduce((sig, sec) => biquadFilter(sig, sec), toF64(ecg));\n  }\n}\n\nexport function biggestPreprocessFilter(signal, fs = 400) {\n  const { detrended } = stage1_preprocess(signal, fs);\n  let bp = bandpass5to18(detrended, fs, { hpOrder: 4, lpOrder: 4, zeroPhase: true });\n\n  return {\n    bp,\n    detrended,\n  };\n}\n","export function mwmFilter(ecg) {\n  const N = ecg.length;\n  const L1 = 40;\n  const L2 = 160;\n  const flen1 = Math.floor(L1 / 2);\n  const flen2 = Math.floor(L2 / 2);\n  const x1 = new Array(N);\n  for (let j = 0; j < N; j++) {\n    const start = Math.max(0, j - flen1);\n    const end = Math.min(N - 1, j + flen1);\n    x1[j] = medianOfRange(ecg, start, end);\n  }\n  const baseline = new Array(N);\n  for (let j = 0; j < N; j++) {\n    const start = Math.max(0, j - flen2);\n    const end = Math.min(N - 1, j + flen2);\n    baseline[j] = medianOfRange(x1, start, end);\n  }\n\n  const corrected = new Array(N);\n  for (let i = 0; i < N; i++) {\n    const x = ecg[i];\n    const b = baseline[i];\n    corrected[i] = Number.isNaN(x) || Number.isNaN(b) ? NaN : x - b;\n  }\n\n  return corrected;\n\n  function medianOfRange(arr, start, end) {\n    const k = end - start + 1;\n    const tmp = new Array(k);\n    for (let i = 0; i < k; i++) tmp[i] = arr[start + i];\n    tmp.sort((a, b) => a - b);\n    const mid = Math.floor(k / 2);\n    if (k % 2 === 1) {\n      return tmp[mid];\n    } else {\n      return 0.5 * (tmp[mid - 1] + tmp[mid]);\n    }\n  }\n}\nexport function lpFilterMatlab(sig) {\n  const N = sig.length;\n  if (N === 0) return [];\n  const b = [1, 0, 0, 0, 0, 0, -2, 0, 0, 0, 0, 0, 1];\n  const a = [1, -2, 1];\n  const h = impulseResponse13(b, a);\n  const yc = conv(sig, h);\n  const start = 6;\n  const out = yc.slice(start, start + N);\n  return out;\n\n  function impulseResponse13(b, a) {\n    const M = 13;\n    const y = new Array(M).fill(0);\n    const a1 = a[1],\n      a2 = a[2];\n\n    for (let n = 0; n < M; n++) {\n      let acc = n === 0 ? b[0] : 0;\n      for (let k = 1; k < b.length; k++) {\n        const idx = n - k;\n        if (idx === 0) acc += b[k];\n      }\n      const yn1 = n - 1 >= 0 ? y[n - 1] : 0;\n      const yn2 = n - 2 >= 0 ? y[n - 2] : 0;\n      y[n] = acc - a1 * yn1 - a2 * yn2;\n    }\n    return y;\n  }\n\n  function conv(x, h) {\n    const Nx = x.length,\n      Nh = h.length;\n    const Ny = Nx + Nh - 1;\n    const y = new Array(Ny).fill(0);\n    for (let n = 0; n < Ny; n++) {\n      let s = 0;\n      const kmin = Math.max(0, n - (Nx - 1));\n      const kmax = Math.min(n, Nh - 1);\n      for (let k = kmin; k <= kmax; k++) {\n        s += h[k] * x[n - k];\n      }\n      y[n] = s;\n    }\n    return y;\n  }\n}\n\nexport function hpFilterMatlab(sig) {\n  const N = sig.length;\n\n  const b = (() => {\n    const arr = new Array(33).fill(0);\n    arr[0] = -1;\n    arr[16] = 32;\n    arr[17] = -32;\n    arr[32] = 1;\n    return arr;\n  })();\n  const a = [1, -1];\n  const h = impulseResponse(b, a, 33);\n\n  const yc = conv(sig, h);\n  const out = yc.slice(16, 16 + N);\n  return out;\n  function impulseResponse(b, a, M) {\n    const y = new Array(M).fill(0);\n    const a1 = a[1];\n    for (let n = 0; n < M; n++) {\n      let acc = n < b.length ? b[n] : 0;\n      const yn1 = n > 0 ? y[n - 1] : 0;\n      y[n] = acc - a1 * yn1;\n    }\n    return y;\n  }\n\n  function conv(x, h) {\n    const Nx = x.length,\n      Nh = h.length;\n    const Ny = Nx + Nh - 1;\n    const y = new Array(Ny).fill(0);\n    for (let n = 0; n < Ny; n++) {\n      let s = 0;\n      const kmin = Math.max(0, n - (Nx - 1));\n      const kmax = Math.min(n, Nh - 1);\n      for (let k = kmin; k <= kmax; k++) s += h[k] * x[n - k];\n      y[n] = s;\n    }\n    return y;\n  }\n}\n\nexport function notch50HzCombFILT(x) {\n  const fs = 400;\n  const Fo = 50;\n  const Q = 35;\n  const doNorm = false;\n  const Nf = fs / Fo;\n  const N = Math.max(2, Math.round(Nf));\n  const BW = Fo / (fs / 2) / Q;\n  const r = clamp(1 - BW, 0.0, 0.999999);\n  const a1 = Math.pow(r, 1 / N);\n  const b = new Array(N).fill(1);\n  const a = Array.from({ length: N }, (_, k) => Math.pow(a1, k));\n  const y = filtfiltIIR(b, a, x);\n\n  if (!doNorm) return y;\n  const m = y.reduce((M, v) => Math.max(M, Math.abs(v)), 0) || 1;\n  return y.map((v) => v / m);\n\n  function clamp(v, lo, hi) {\n    return Math.max(lo, Math.min(hi, v));\n  }\n  function lfilter(b, a, x) {\n    const nb = b.length,\n      na = a.length;\n    const y = new Array(x.length).fill(0);\n    for (let n = 0; n < x.length; n++) {\n      let acc = 0;\n      for (let k = 0; k < nb; k++) {\n        const xn = n - k;\n        if (xn >= 0) acc += b[k] * x[xn];\n      }\n      for (let k = 1; k < na; k++) {\n        const yn = n - k;\n        if (yn >= 0) acc -= a[k] * y[yn];\n      }\n      y[n] = acc;\n    }\n    return y;\n  }\n  function filtfiltIIR(b, a, x) {\n    const nfact = 3 * (Math.max(b.length, a.length) - 1);\n    const N = x.length;\n    if (N <= nfact + 1) {\n      const y1 = lfilter(b, a, x);\n      return lfilter(b, a, y1.slice().reverse()).reverse();\n    }\n    const pre = reflectPad(x, nfact, true);\n    const post = reflectPad(x, nfact, false);\n    const xx = pre.concat(x, post);\n    const y1 = lfilter(b, a, xx);\n    const y2 = lfilter(b, a, y1.slice().reverse()).reverse();\n    return y2.slice(nfact, nfact + N);\n\n    function reflectPad(arr, L, atStart) {\n      const out = new Array(L);\n      if (atStart) {\n        for (let i = 0; i < L; i++) out[i] = 2 * arr[0] - arr[1 + i];\n        return out.reverse();\n      } else {\n        for (let i = 0; i < L; i++) out[i] = 2 * arr[N - 1] - arr[N - 2 - i];\n        return out;\n      }\n    }\n  }\n}\n\nexport function savGolayFilter(data, mode) {\n  let K, F, dt, deriv, nl, nr, M;\n  if (mode === 'centered') {\n    K = 2;\n    F = 25;\n    dt = 0.05;\n    deriv = 0;\n  } else if (mode === 'asymmetric') {\n    nl = 16;\n    nr = 16;\n    M = 4;\n    deriv = 0;\n    dt = 0.05;\n  }\n  function transpose(M) {\n    const r = M.length,\n      c = M[0].length;\n    const T = Array.from({ length: c }, () => Array(r));\n    for (let i = 0; i < r; i++) for (let j = 0; j < c; j++) T[j][i] = M[i][j];\n    return T;\n  }\n\n  function matMul(A, B) {\n    const aR = A.length,\n      aC = A[0].length;\n    const bR = B.length,\n      bC = B[0].length;\n    const C = Array.from({ length: aR }, () => Array(bC).fill(0));\n    for (let i = 0; i < aR; i++) {\n      for (let k = 0; k < aC; k++) {\n        const aik = A[i][k];\n        for (let j = 0; j < bC; j++) C[i][j] += aik * B[k][j];\n      }\n    }\n    return C;\n  }\n\n  function invertMatrix(M) {\n    const n = M.length;\n    const A = M.map((r) => r.slice());\n    const I = Array.from({ length: n }, (_, i) =>\n      Array.from({ length: n }, (_, j) => (i === j ? 1 : 0)),\n    );\n    for (let col = 0; col < n; col++) {\n      let piv = col;\n      for (let r = col + 1; r < n; r++) if (Math.abs(A[r][col]) > Math.abs(A[piv][col])) piv = r;\n      const pivotVal = A[piv][col];\n      if (piv !== col) {\n        [A[col], A[piv]] = [A[piv], A[col]];\n        [I[col], I[piv]] = [I[piv], I[col]];\n      }\n      for (let j = 0; j < n; j++) {\n        A[col][j] /= pivotVal;\n        I[col][j] /= pivotVal;\n      }\n      for (let r = 0; r < n; r++) {\n        if (r === col) continue;\n        const factor = A[r][col];\n        if (factor === 0) continue;\n        for (let j = 0; j < n; j++) {\n          A[r][j] -= factor * A[col][j];\n          I[r][j] -= factor * I[col][j];\n        }\n      }\n    }\n    return I;\n  }\n  const factorial = (n) => {\n    let r = 1;\n    for (let i = 2; i <= n; i++) r *= i;\n    return r;\n  };\n  function designMatrixCentered(K, F) {\n    const m = (F - 1) >> 1;\n    const A = Array.from({ length: F }, () => Array(K + 1).fill(0));\n    for (let i = 0; i < F; i++) {\n      const n = i - m;\n      let p = 1;\n      for (let j = 0; j <= K; j++) {\n        A[i][j] = p;\n        p *= n;\n      }\n    }\n    return A;\n  }\n  function designMatrixAsym(M, nl, nr) {\n    const F = nl + nr + 1;\n    const A = Array.from({ length: F }, () => Array(M + 1).fill(0));\n    for (let i = 0; i < F; i++) {\n      const n = i - nl;\n      let p = 1;\n      for (let j = 0; j <= M; j++) {\n        A[i][j] = p;\n        p *= n;\n      }\n    }\n    return A;\n  }\n  function sgDesign(K, F) {\n    const A = designMatrixCentered(K, F);\n    const AT = transpose(A);\n    const ATA = matMul(AT, A);\n    const ATA_inv = invertMatrix(ATA);\n    const pinv = matMul(ATA_inv, AT);\n\n    const G = Array.from({ length: F }, () => Array(K + 1).fill(0));\n    for (let d = 0; d <= K; d++) {\n      const scale = factorial(d);\n      for (let j = 0; j < F; j++) G[j][d] = scale * pinv[d][j];\n    }\n    return G;\n  }\n  function sgDesignAsym(M, nl, nr) {\n    const F = nl + nr + 1;\n    const A = designMatrixAsym(M, nl, nr);\n    const AT = transpose(A);\n    const ATA = matMul(AT, A);\n    const ATA_inv = invertMatrix(ATA);\n    const pinv = matMul(ATA_inv, AT);\n\n    const GA = Array.from({ length: F }, () => Array(M + 1).fill(0));\n    for (let d = 0; d <= M; d++) {\n      const scale = factorial(d);\n      for (let j = 0; j < F; j++) GA[j][d] = scale * pinv[d][j];\n    }\n    return GA;\n  }\n  function convSame(signal, kernel) {\n    const N = signal.length;\n    const F = kernel.length;\n    const m = Math.floor(F / 2);\n    const y = new Array(N).fill(0);\n    for (let i = 0; i < N; i++) {\n      let acc = 0;\n      for (let j = 0; j < F; j++) {\n        const idx = i + j - m;\n        if (idx >= 0 && idx < N) acc += signal[idx] * kernel[j];\n      }\n      y[i] = acc;\n    }\n    return y;\n  }\n  function convAlign(signal, kernel, centerIndex) {\n    const N = signal.length,\n      F = kernel.length;\n    const y = new Array(N).fill(0);\n    for (let i = 0; i < N; i++) {\n      let acc = 0;\n      for (let j = 0; j < F; j++) {\n        const idx = i + j - centerIndex;\n        if (idx >= 0 && idx < N) acc += signal[idx] * kernel[j];\n      }\n      y[i] = acc;\n    }\n    return y;\n  }\n\n  function sgApply(signal, K, F, opts = {}) {\n    const { dt = 1, deriv = 0 } = opts;\n    const G = sgDesign(K, F);\n    const h = getColumn(G, deriv);\n    const y = convSame(signal, h);\n    if (deriv === 0) return y;\n    const scale = Math.pow(dt, deriv);\n    return y.map((v) => v / scale);\n  }\n  function savGolSmooth(f, nl, nr, M) {\n    const GA = sgDesignAsym(M, nl, nr);\n    const c = getColumn(GA, 0);\n    const n = f.length;\n    const y = convAlign(f, c, nl);\n    const g = y.slice();\n    const F = nl + nr + 1;\n    for (let i = nl; i <= n - nr - 1; i++) g[i] = y[i + nr];\n    for (let i = 0; i < nl && i < n; i++) g[i] = f[i];\n    for (let i = Math.max(n - nr, 0); i < n; i++) g[i] = f[i];\n    return g;\n  }\n  function getColumn(M, j) {\n    return M.map((row) => row[j]);\n  }\n  function scaleArray(a, s) {\n    return a.map((v) => v * s);\n  }\n\n  if (mode === 'centered') {\n    return sgApply(data, K, F, { dt, deriv });\n  }\n\n  if (mode === 'asymmetric') {\n    if (deriv === 0) {\n      return savGolSmooth(data, nl, nr, M);\n    }\n    const GA = sgDesignAsym(M, nl, nr);\n    const h = GA.map((r) => r[deriv]);\n    const y = convAlign(data, h, nl);\n    const scale = Math.pow(dt, deriv);\n    return y.map((v) => v / scale);\n  }\n}\n","import { biggestPreprocessFilter } from './biggestPreprocess';\nimport {\n  hpFilterMatlab,\n  lpFilterMatlab,\n  mwmFilter,\n  notch50HzCombFILT,\n  savGolayFilter,\n} from './mainConversions';\n\nexport const preprocessSignal = (signal) => {\n  const signalData = signal[0].data.map((item) => item[1]);\n  const signalTime = signal[0].data.map((item) => item[0]);\n  const transformData = (data) => signalTime.map((item, i) => [item, data[i]]);\n  const mvmFiltered = mwmFilter(signalData);\n  const lowPassFilteredML = lpFilterMatlab(mvmFiltered);\n  const highPassFilteredML = hpFilterMatlab(lowPassFilteredML);\n  const notchFilteredML = notch50HzCombFILT(highPassFilteredML);\n  const savGolayFilteredMLC = savGolayFilter(lowPassFilteredML, 'centered');\n  const biggestPreprocess = biggestPreprocessFilter(signalData);\n\n  return {\n    mvmFiltered: transformData(mvmFiltered),\n    lowPassFilteredML: transformData(lowPassFilteredML),\n    highPassFilteredML: transformData(highPassFilteredML),\n    notchFilteredML: transformData(notchFilteredML),\n    savGolayFilteredMLC: transformData(savGolayFilteredMLC),\n    biggestPreprocess: {\n      bp: transformData(biggestPreprocess.bp),\n      detrended: transformData(biggestPreprocess.detrended),\n    },\n  };\n};\n","import { getTopValue } from '../utils';\n\nfunction filter(b, a, x) {\n  const y = new Array(x.length).fill(0);\n  for (let n = 0; n < x.length; n++) {\n    for (let i = 0; i < b.length; i++) {\n      if (n - i >= 0) y[n] += b[i] * x[n - i];\n    }\n    for (let i = 1; i < a.length; i++) {\n      if (n - i >= 0) y[n] -= a[i] * y[n - i];\n    }\n    y[n] /= a[0];\n  }\n  return y;\n}\n\nfunction normalize(signal) {\n  const maxVal = getTopValue(signal, 'max') || 1;\n  const minVal = getTopValue(signal, 'min') || 1;\n  const correctVal = Math.abs(maxVal) > Math.abs(minVal) ? maxVal : minVal;\n  return signal.map((val) => val / correctVal);\n}\n\nexport function getLowPassFilterSignal(signal) {\n  const a1 = [1, -2, 1];\n  const b1 = [1, 0, 0, 0, 0, 0, -2, 0, 0, 0, 0, 0, 1];\n  let lowPassFilterSignal = filter(b1, a1, signal);\n  lowPassFilterSignal = normalize(lowPassFilterSignal);\n  return lowPassFilterSignal;\n}\n\nexport function getHighPassFilterSignal(signal) {\n  const a2 = [1, -1];\n  const b2 = [\n    -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 32, -32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n    0, 1,\n  ];\n\n  let highPassFilterSignal = filter(b2, a2, signal);\n  highPassFilterSignal = normalize(highPassFilterSignal);\n  return highPassFilterSignal;\n}\n\nexport function getDifferentiatedSignal(signal) {\n  const h = [-1, -2, 0, 2, 1].map((v) => v / 8);\n  const half = Math.floor(h.length / 2);\n  let differentiatedSignal = [];\n  for (let i = 0; i < signal.length; i++) {\n    let sum = 0;\n    for (let j = 0; j < h.length; j++) {\n      const idx = i + j - half;\n      const x = idx >= 0 && idx < signal.length ? signal[idx] : 0;\n      sum += h[j] * x;\n    }\n    differentiatedSignal.push(sum);\n  }\n\n  differentiatedSignal = normalize(differentiatedSignal);\n  return differentiatedSignal;\n}\n\nexport function getSquaredSignal(signal) {\n  let squaredSignal = signal.map((x) => x * x);\n  squaredSignal = normalize(squaredSignal);\n  return squaredSignal;\n}\n\nexport function getMovingWindowSignal(signal) {\n  let movedWindowSignal = [];\n  const windowSize = 51;\n  let sum = 0;\n  for (let i = 0; i < signal.length; i++) {\n    sum += signal[i];\n    if (i >= windowSize) {\n      sum -= signal[i - windowSize];\n    }\n    if (i >= windowSize - 1) {\n      movedWindowSignal.push(sum / windowSize);\n    } else {\n      movedWindowSignal.push(0);\n    }\n  }\n  movedWindowSignal = normalize(movedWindowSignal);\n  return movedWindowSignal;\n}\n\nexport function getRPeaks(signal, dataSignal) {\n  const maxValue = getTopValue(signal, 'max');\n  const avgValue = signal.reduce((sum, val) => sum + val, 0) / signal.length;\n  const threshold = avgValue * maxValue;\n  const binary = signal.map((val) => (val > threshold ? 1 : 0));\n  const left = [];\n  const right = [];\n  for (let i = 1; i < binary.length; i++) {\n    if (binary[i - 1] === 0 && binary[i] === 1) {\n      left.push(i);\n    } else if (binary[i - 1] === 1 && binary[i] === 0) {\n      right.push(i);\n    }\n  }\n  const shift = 21;\n  for (let i = 0; i < left.length; i++) {\n    left[i] = Math.max(0, left[i] - shift);\n    right[i] = Math.min(dataSignal.length - 1, right[i] - shift);\n  }\n\n  const R_locs = [];\n\n  for (let i = 0; i < left.length; i++) {\n    const start = left[i];\n    const end = right[i];\n    let maxVal = -Infinity;\n    let maxIdx = start;\n\n    for (let j = start; j <= end; j++) {\n      if (dataSignal[j] > maxVal) {\n        maxVal = dataSignal[j];\n        maxIdx = j;\n      }\n    }\n\n    R_locs.push(maxIdx);\n  }\n\n  const fs = 400;\n  const minDistance = 0.25 * fs;\n\n  const filteredRLocs = [];\n\n  for (let i = 0; i < R_locs.length; i++) {\n    if (filteredRLocs.length === 0) {\n      filteredRLocs.push(R_locs[i]);\n    } else {\n      const lastAccepted = filteredRLocs[filteredRLocs.length - 1];\n      if (R_locs[i] - lastAccepted >= minDistance) {\n        filteredRLocs.push(R_locs[i]);\n      }\n    }\n  }\n  return filteredRLocs;\n}\n","const MIN_DIST_SEC = 0.1;\nconst SEARCH_WIN_SEC = 0.15;\nconst T_WAVE_SLOPE_RATIO = 0.9;\nconst RESCUE_SCALE = 0.5;\nconst GAPFILL_LONG_SEC = 0.9;\nconst GAPFILL_RR_FACTOR = 0.95;\nconst GAPFILL_LOW_SCALE = 0.1;\nconst DEDUP_SEC = 0.18;\n\nconst MICRO_R_ENABLE = true;\nconst MICRO_R_LO_SEC = 0.28;\nconst MICRO_R_HI_SEC = 0.52;\nconst MICRO_R_PROM_FRAC = 0.25;\nconst MICRO_R_MIN_POS_FRAC = 0.15;\nconst MICRO_R_SIDE_SEC = 0.06;\n\nfunction mean(a) {\n  if (!a.length) return 0;\n  let s = 0;\n  for (const v of a) s += v;\n  return s / a.length;\n}\nfunction median(a) {\n  if (!a.length) return 0;\n  const s = [...a].sort((x, y) => x - y);\n  const m = s.length >> 1;\n  return s.length % 2 ? s[m] : (s[m - 1] + s[m]) / 2;\n}\nfunction maxAbs(a) {\n  let m = 0;\n  for (const v of a) {\n    const u = Math.abs(v);\n    if (u > m) m = u;\n  }\n  return m;\n}\nfunction zeros(n) {\n  return new Array(n).fill(0);\n}\nfunction ones(n) {\n  return new Array(n).fill(1);\n}\nfunction pyRound(x) {\n  return Math.round(x);\n}\nfunction convolveFull(x, h) {\n  const n = x.length,\n    m = h.length,\n    y = new Array(n + m - 1).fill(0);\n  for (let i = 0; i < n; i++) {\n    const xi = x[i];\n    for (let j = 0; j < m; j++) y[i + j] += xi * h[j];\n  }\n  return y;\n}\nfunction lfilter(b, a, x) {\n  const y = new Array(x.length).fill(0);\n  for (let n = 0; n < x.length; n++) {\n    let acc = 0;\n    for (let i = 0; i < b.length; i++) if (n - i >= 0) acc += b[i] * x[n - i];\n    for (let j = 1; j < a.length; j++) if (n - j >= 0) acc -= a[j] * y[n - j];\n    y[n] = acc / a[0];\n  }\n  return y;\n}\nfunction filtfilt(b, a, x, padlen = null) {\n  const edge = Math.max(b.length, a.length) - 1;\n  const pl = padlen == null ? 3 * edge : padlen;\n  const n = x.length;\n  const left = new Array(pl),\n    right = new Array(pl);\n  for (let i = 0; i < pl; i++) {\n    left[i] = 2 * x[0] - x[Math.min(pl - i, n - 1)];\n    right[i] = 2 * x[n - 1] - x[Math.max(n - 2 - i, 0)];\n  }\n  const xp = left.concat(x, right);\n  const y1 = lfilter(b, a, xp);\n  const y2 = lfilter(b, a, y1.slice().reverse()).reverse();\n  return y2.slice(pl, pl + n);\n}\nfunction flattop(M) {\n  const a0 = 1.0,\n    a1 = 1.93,\n    a2 = 1.29,\n    a3 = 0.388,\n    a4 = 0.028;\n  const w = new Array(M),\n    N = M - 1;\n  for (let n = 0; n < M; n++) {\n    const p = (2 * Math.PI * n) / N;\n    w[n] =\n      a0 - a1 * Math.cos(p) + a2 * Math.cos(2 * p) - a3 * Math.cos(3 * p) + a4 * Math.cos(4 * p);\n  }\n  return w;\n}\nfunction smoother({ signal, kernel = 'flattop', size = 10, mirror = true }) {\n  if (!signal) throw new TypeError('signal required');\n  if (size > signal.length) size = signal.length - 1;\n  if (size < 1) size = 1;\n  if (kernel !== 'flattop') throw new Error('only flattop');\n  const win = flattop(size);\n  const sumw = win.reduce((a, b) => a + b, 0),\n    w = win.map((v) => v / sumw);\n  const left = mirror ? new Array(size).fill(signal[0]) : [];\n  const right = mirror ? new Array(size).fill(signal[signal.length - 1]) : [];\n  const src = left.concat(signal, right);\n  const y = convolveFull(src, w);\n  return mirror\n    ? y.slice(size, size + signal.length)\n    : y.slice(Math.floor((w.length - 1) / 2), Math.floor((w.length - 1) / 2) + signal.length);\n}\nfunction peakIndexes(y, thres = 0, min_dist = 1) {\n  if (!y.length) return [];\n  const ymin = Math.min(...y),\n    ymax = Math.max(...y);\n  const absThres = ymin + thres * (ymax - ymin);\n  const cand = [];\n  for (let i = 1; i < y.length - 1; i++) {\n    if (y[i] > absThres && y[i] > y[i - 1] && y[i] > y[i + 1]) cand.push(i);\n  }\n  if (!cand.length) return [];\n  cand.sort((i, j) => y[j] - y[i]);\n  const taken = [],\n    bad = new Array(y.length).fill(false);\n  for (const idx of cand) {\n    if (bad[idx]) continue;\n    taken.push(idx);\n    const s = Math.max(0, idx - min_dist),\n      e = Math.min(y.length - 1, idx + min_dist);\n    for (let k = s; k <= e; k++) bad[k] = true;\n  }\n  return taken.sort((a, b) => a - b);\n}\nfunction argmaxRange(x, s, e) {\n  s = Math.max(0, s);\n  e = Math.min(e, x.length);\n  if (e <= s) return { idx: -1, val: -Infinity };\n  let im = s,\n    vm = x[s];\n  for (let i = s + 1; i < e; i++)\n    if (x[i] > vm) {\n      vm = x[i];\n      im = i;\n    }\n  return { idx: im, val: vm };\n}\nfunction dedupPeaks(idxs, minDist) {\n  if (!idxs.length) return [];\n  const out = [idxs[0]];\n  for (let i = 1; i < idxs.length; i++) {\n    if (idxs[i] - out[out.length - 1] >= minDist) out.push(idxs[i]);\n    else if (i + 1 < idxs.length && idxs[i + 1] - out[out.length - 1] >= minDist) continue;\n  }\n  return out;\n}\n\nfunction isUphillPeak(sig, idx, pre = 4, post = 4) {\n  const i0 = Math.max(0, idx - pre),\n    i1 = Math.min(sig.length - 1, idx + post);\n  if (i1 - i0 < 3) return true;\n  const left = sig[idx] - sig[i0];\n  const right = sig[i1] - sig[idx];\n  return left > 0 && right < 0;\n}\n\nfunction localProminence(sig, idx, side) {\n  const L = Math.max(0, idx - side);\n  const R = Math.min(sig.length - 1, idx + side);\n  let minLeft = +Infinity,\n    minRight = +Infinity;\n  for (let i = L; i <= idx; i++) if (sig[i] < minLeft) minLeft = sig[i];\n  for (let i = idx; i <= R; i++) if (sig[i] < minRight) minRight = sig[i];\n  const base = Math.max(minLeft, minRight);\n  return sig[idx] - base;\n}\n\nfunction sinc(x) {\n  return x === 0 ? 1 : Math.sin(Math.PI * x) / (Math.PI * x);\n}\nfunction hamming(N) {\n  const w = new Array(N);\n  for (let n = 0; n < N; n++) w[n] = 0.54 - 0.46 * Math.cos((2 * Math.PI * n) / (N - 1));\n  return w;\n}\n\nfunction designFIRLowpass(numTaps, fc, fs) {\n  const M = numTaps - 1,\n    w = hamming(numTaps),\n    h = new Array(numTaps);\n  const norm = (2 * fc) / fs;\n  for (let n = 0; n < numTaps; n++) {\n    const m = n - M / 2;\n    h[n] = norm * sinc(norm * m) * w[n];\n  }\n  const sum = h.reduce((a, b) => a + b, 0);\n  for (let n = 0; n < numTaps; n++) h[n] /= sum;\n  return h;\n}\nfunction firFilterSame(x, h) {\n  const y = convolveFull(x, h);\n  const off = Math.floor(h.length / 2);\n  return y.slice(off, off + x.length);\n}\nfunction downsample400to200(x) {\n  const h = designFIRLowpass(129, 80, 400);\n  const y = filtfilt(h, [1], x, 3 * (h.length - 1));\n  const z = new Array(Math.floor(y.length / 2));\n  for (let k = 0; k < z.length; k++) z[k] = y[2 * k];\n  return z;\n}\n\nconst BUTTER_200_LOW_12HZ = {\n  b: [0.00475052, 0.01425157, 0.01425157, 0.00475052],\n  a: [1.0, -2.25008508, 1.75640138, -0.46831211],\n};\nconst BUTTER_200_HIGH_5HZ = {\n  b: [0.85449723, -2.56349169, 2.56349169, -0.85449723],\n  a: [1.0, -2.6861574, 2.41965511, -0.73016535],\n};\n\nfunction rpeak_detection_200_pos(ecg, fs) {\n  const ecg0 = ecg.map((v) => v - mean(ecg));\n  let ecg_l = filtfilt(BUTTER_200_LOW_12HZ.b, BUTTER_200_LOW_12HZ.a, ecg0);\n  const m1 = maxAbs(ecg_l);\n  if (m1 > 0) ecg_l = ecg_l.map((v) => v / m1);\n  let ecg_h = filtfilt(\n    BUTTER_200_HIGH_5HZ.b,\n    BUTTER_200_HIGH_5HZ.a,\n    ecg_l,\n    3 * (Math.max(BUTTER_200_HIGH_5HZ.b.length, BUTTER_200_HIGH_5HZ.a.length) - 1),\n  );\n  const m2 = maxAbs(ecg_h);\n  if (m2 > 0) ecg_h = ecg_h.map((v) => v / m2);\n  const b_diff = [1, 2, 0, -2, -1].map((v) => (v * fs) / 8);\n  const pad =\n    3 * (Math.max(BUTTER_200_HIGH_5HZ.b.length, BUTTER_200_HIGH_5HZ.a.length, b_diff.length) - 1);\n  let ecg_d = filtfilt(b_diff, [1.0], ecg_h, pad);\n  const md = maxAbs(ecg_d);\n  if (md > 0) ecg_d = ecg_d.map((v) => v / md);\n\n  let ecg_s = ecg_d.map((v) => v * v);\n  const sm_size = pyRound(0.06 * fs);\n  ecg_s = smoother({ signal: ecg_s, kernel: 'flattop', size: sm_size, mirror: true });\n\n  const winLen = pyRound(0.15 * fs);\n  const ecg_m = convolveFull(\n    ecg_s,\n    ones(winLen).map((v) => v / winLen),\n  );\n\n  const locs = peakIndexes(ecg_m, 0, pyRound(MIN_DIST_SEC * fs));\n  const pks = locs.map((i) => ecg_m[i]);\n  const LLp = pks.length;\n\n  let qrs_c = zeros(LLp),\n    qrs_i = zeros(LLp),\n    qrs_i_raw = zeros(LLp);\n  const twoSec = 2 * fs + 1;\n  let THR_SIG = Math.max(...ecg_m.slice(0, Math.min(twoSec, ecg_m.length))) * (1 / 3);\n  let THR_NOISE = mean(ecg_m.slice(0, Math.min(twoSec, ecg_m.length))) * (1 / 2);\n  let SIG_LEV = THR_SIG,\n    NOISE_LEV = THR_NOISE;\n\n  let THR_SIG1 = Math.max(...ecg_h.slice(0, Math.min(twoSec, ecg_h.length))) * (1 / 3);\n  let THR_NOISE1 = mean(ecg_h.slice(0, Math.min(twoSec, ecg_h.length))) * (1 / 2);\n  let SIG_LEV1 = THR_SIG1,\n    NOISE_LEV1 = THR_NOISE1;\n\n  let Beat_C = 0,\n    Beat_C1 = 0,\n    mean_RR = 0,\n    m_selected_RR = 0,\n    Check_Flag = 0,\n    skip = 0;\n\n  for (let i = 0; i < LLp; i++) {\n    const half = Math.round(SEARCH_WIN_SEC * fs);\n    const s = Math.max(0, locs[i] - half);\n    const e = Math.min(ecg_h.length, locs[i] + half + 1);\n    const locH = argmaxRange(ecg_h, s, e);\n    let x_i_abs = locH.idx,\n      y_i = locH.val;\n    if (Beat_C >= 9) {\n      const diffs = [];\n      for (let k = Beat_C - 9; k < Beat_C - 1; k++) diffs.push(qrs_i[k + 1] - qrs_i[k]);\n      mean_RR = mean(diffs);\n      m_selected_RR = mean_RR;\n    }\n    const test_m = m_selected_RR || mean_RR || 0;\n    let accepted = false;\n    const acceptQRS = (locIdx, amp_m, absIdx_h, amp_h) => {\n      if (amp_h <= 0) return;\n      if (!isUphillPeak(ecg_h, absIdx_h, 4, 4)) return;\n      Beat_C += 1;\n      qrs_c[Beat_C - 1] = amp_m;\n      qrs_i[Beat_C - 1] = locIdx;\n      if (amp_h >= THR_SIG1) {\n        Beat_C1 += 1;\n        qrs_i_raw[Beat_C1 - 1] = absIdx_h;\n        SIG_LEV1 = 0.125 * amp_h + 0.875 * SIG_LEV1;\n      }\n      SIG_LEV = 0.125 * amp_m + 0.875 * SIG_LEV;\n      accepted = true;\n    };\n\n    if (pks[i] >= THR_SIG) {\n      if (Beat_C >= 3) {\n        if (test_m && locs[i] - qrs_i[Beat_C - 1] <= pyRound(0.5 * test_m)) Check_Flag = 1;\n        if (locs[i] - qrs_i[Beat_C - 1] <= pyRound(0.36 * fs) || Check_Flag === 1) {\n          const s1 = Math.max(0, locs[i] - pyRound(0.07 * fs));\n          const seg1 = ecg_m.slice(s1, locs[i] + 1);\n          const Slope1 = seg1.length > 1 ? mean(seg1.slice(1).map((v, k) => v - seg1[k])) : 0;\n\n          const s2 = Math.max(0, qrs_i[Beat_C - 1] - pyRound(0.07 * fs) - 1);\n          const seg2 = ecg_m.slice(s2, qrs_i[Beat_C - 1] + 1);\n          const Slope2 = seg2.length > 1 ? mean(seg2.slice(1).map((v, k) => v - seg2[k])) : 0;\n\n          if (Math.abs(Slope1) <= Math.abs(T_WAVE_SLOPE_RATIO * Slope2)) skip = 1;\n          else skip = 0;\n        }\n      }\n      if (skip === 0) acceptQRS(locs[i], pks[i], x_i_abs, y_i);\n    }\n    if (MICRO_R_ENABLE && !accepted) {\n      const sinceLast = Beat_C > 0 ? locs[i] - qrs_i[Beat_C - 1] : Infinity;\n      const inMicroWindow =\n        sinceLast >= Math.round(MICRO_R_LO_SEC * fs) &&\n        sinceLast <= Math.round(MICRO_R_HI_SEC * fs);\n\n      if (inMicroWindow && y_i > 0) {\n        const side = Math.round(MICRO_R_SIDE_SEC * fs);\n        const prom = localProminence(ecg_h, x_i_abs, side);\n        const promThr = Math.max(\n          MICRO_R_PROM_FRAC * Math.max(1e-9, SIG_LEV1 - NOISE_LEV1),\n          MICRO_R_MIN_POS_FRAC * Math.max(1e-9, SIG_LEV1),\n        );\n\n        if (prom > promThr && isUphillPeak(ecg_h, x_i_abs, 4, 4)) {\n          acceptQRS(locs[i], pks[i], x_i_abs, y_i);\n        }\n      }\n    }\n\n    if (!accepted) {\n      const sinceLast = Beat_C > 0 ? locs[i] - qrs_i[Beat_C - 1] : Infinity;\n      const okShortRR = sinceLast >= pyRound(0.2 * fs) && sinceLast <= pyRound(0.6 * fs);\n      if (pks[i] >= RESCUE_SCALE * THR_SIG && okShortRR && y_i >= RESCUE_SCALE * THR_SIG1) {\n        acceptQRS(locs[i], pks[i], x_i_abs, y_i);\n      }\n    }\n    if (MICRO_R_ENABLE && !accepted) {\n      const sinceLast = Beat_C > 0 ? locs[i] - qrs_i[Beat_C - 1] : Infinity;\n      const inMicroWindow =\n        sinceLast >= Math.round(MICRO_R_LO_SEC * fs) &&\n        sinceLast <= Math.round(MICRO_R_HI_SEC * fs);\n\n      if (inMicroWindow && y_i > 0) {\n        const side = Math.round(MICRO_R_SIDE_SEC * fs);\n        const prom = localProminence(ecg_h, x_i_abs, side);\n        const promThr = Math.max(\n          MICRO_R_PROM_FRAC * Math.max(1e-9, SIG_LEV1 - NOISE_LEV1),\n          MICRO_R_MIN_POS_FRAC * Math.max(1e-9, SIG_LEV1),\n        );\n        if (prom > promThr && isUphillPeak(ecg_h, x_i_abs, 4, 4)) {\n          acceptQRS(locs[i], pks[i], x_i_abs, y_i);\n        }\n      }\n    }\n\n    if (!accepted) {\n      NOISE_LEV1 = 0.125 * Math.max(0, y_i) + 0.875 * NOISE_LEV1;\n      NOISE_LEV = 0.125 * pks[i] + 0.875 * NOISE_LEV;\n    }\n    if (NOISE_LEV !== 0 || SIG_LEV !== 0) {\n      THR_SIG = NOISE_LEV + 0.25 * Math.abs(SIG_LEV - NOISE_LEV);\n      THR_NOISE = 0.4 * THR_SIG;\n    }\n    if (NOISE_LEV1 !== 0 || SIG_LEV1 !== 0) {\n      THR_SIG1 = NOISE_LEV1 + 0.25 * Math.abs(SIG_LEV1 - NOISE_LEV1);\n      THR_NOISE1 = 0.4 * THR_SIG1;\n    }\n    skip = 0;\n    Check_Flag = 0;\n  }\n\n  qrs_i_raw = qrs_i_raw.slice(\n    0,\n    qrs_i_raw.findLastIndex ? qrs_i_raw.findLastIndex(() => true) + 1 : qrs_i_raw.length,\n  );\n  (function gapFill() {\n    let peaks = qrs_i_raw.slice();\n    if (peaks.length < 2) {\n      qrs_i_raw = peaks;\n      return;\n    }\n    const rrs = [];\n    for (let k = 1; k < peaks.length; k++) rrs.push(peaks[k] - peaks[k - 1]);\n    let RRexp = median(rrs);\n    if (!RRexp || !isFinite(RRexp)) RRexp = Math.round(0.8 * fs);\n\n    const added = [];\n    for (let k = 1; k < peaks.length; k++) {\n      const prev = peaks[k - 1],\n        next = peaks[k],\n        gap = next - prev;\n      if (gap > Math.max(GAPFILL_LONG_SEC * fs, GAPFILL_RR_FACTOR * RRexp)) {\n        const sM = prev + Math.round(0.25 * gap),\n          eM = prev + Math.round(0.75 * gap);\n        const candM = argmaxRange(ecg_m, sM, eM);\n        if (candM.idx >= 0) {\n          const half = Math.round(SEARCH_WIN_SEC * fs);\n          const locH = argmaxRange(ecg_h, candM.idx - half, candM.idx + half + 1);\n          const ampM = candM.val,\n            ampH = locH.val;\n          const okM = ampM >= GAPFILL_LOW_SCALE * THR_SIG;\n          const okH = ampH >= GAPFILL_LOW_SCALE * THR_SIG1;\n          if (okM && okH && ampH > 0 && isUphillPeak(ecg_h, locH.idx, 4, 4)) added.push(locH.idx);\n        }\n      }\n    }\n    if (added.length) {\n      peaks = peaks.concat(added).sort((a, b) => a - b);\n      peaks = dedupPeaks(peaks, Math.round(DEDUP_SEC * fs));\n    }\n    qrs_i_raw = peaks;\n  })();\n\n  return qrs_i_raw.map((v) => Math.max(0, Math.min(ecg.length - 1, Math.round(v))));\n}\nclass Pan_Tompkins_Plus_Plus_Plus {\n  get_name() {\n    return 'Pan_Tompkins_Plus_Plus_Plus';\n  }\n\n  rpeak_detection(ecg400, fs) {\n    if (fs !== 400) throw new Error('Эта версия принимает только fs = 400 Гц.');\n    if (!ecg400 || !ecg400.length) return [];\n\n    const ecg200 = downsample400to200(ecg400);\n\n    const r200 = rpeak_detection_200_pos(ecg200, 200);\n\n    const refined = [];\n    for (const i200 of r200) {\n      const guess = i200 * 2;\n      const win = 2;\n      const s = Math.max(0, guess - win);\n      const e = Math.min(ecg400.length, guess + win + 1);\n      const loc = argmaxRange(ecg400, s, e);\n      const idx =\n        loc.idx >= 0 && loc.val > 0 && isUphillPeak(ecg400, loc.idx, 4, 4) ? loc.idx : guess;\n      refined.push(idx);\n    }\n\n    const out = dedupPeaks(\n      refined.sort((a, b) => a - b),\n      Math.round(DEDUP_SEC * 400),\n    );\n    return out;\n  }\n}\n\nexport { Pan_Tompkins_Plus_Plus_Plus };\n","import {\n  getDifferentiatedSignal,\n  getHighPassFilterSignal,\n  getLowPassFilterSignal,\n  getMovingWindowSignal,\n  getRPeaks,\n  getSquaredSignal,\n} from './signalConversionPT';\nimport { Pan_Tompkins_Plus_Plus_Plus } from './signalConversionPT+++';\n\nexport const analyzePT = (signal) => {\n  const signalTime = signal[0].data.map((obj) => obj[0]);\n  const signalData = signal[0].data.map((obj) => obj[1]);\n  const signalTransform = (data) => signalTime.map((item, i) => [item, data[i]]);\n  const lowPassSignal = getLowPassFilterSignal(signalData);\n  const highPassSignal = getHighPassFilterSignal(lowPassSignal);\n  const differentiatedSignal = getDifferentiatedSignal(signalData);\n  const squaredSignal = getSquaredSignal(differentiatedSignal);\n  const movingWindowSignal = getMovingWindowSignal(squaredSignal);\n  const peaks = getRPeaks(movingWindowSignal, signalData);\n\n  const newDetector = new Pan_Tompkins_Plus_Plus_Plus();\n  const peaksPlusPlus = newDetector.rpeak_detection(signalData, 400);\n\n  return {\n    lowPassSignal: signalTransform(lowPassSignal),\n    highPassSignal: signalTransform(highPassSignal),\n    differentiatedSignal: signalTransform(differentiatedSignal),\n    squaredSignal: signalTransform(squaredSignal),\n    movingWindowSignal: signalTransform(movingWindowSignal),\n    peaks: {\n      series: signalTime.map((item, i) => [item, peaks.includes(i) ? 50 : 0]),\n      data: peaks,\n    },\n    peaksPlusPlus: {\n      series: signalTime.map((item, i) => [item, peaksPlusPlus.includes(i) ? 50 : 0]),\n      data: peaksPlusPlus,\n    },\n  };\n};\n","/* eslint-env worker */\n/* eslint-disable no-restricted-globals */\n\nimport { analyzeATN } from '../ATNAlgorithm/mainSignalConversion.js';\nimport { analyzeCMD } from '../CMDAlgorithm/mainConversionCMD.js';\nimport { detectRPeaks } from '../GPTAlgorithm/mainConversionGPT.js';\nimport { analyzeECGKHO } from '../KHOAlgorithm/mainSignalConversion.js';\nimport { preprocessSignal } from '../preprocessSignal/preprocessSignal.js';\nimport { analyzePT } from '../PTAlgorithm/mainConversionPT.js';\n\nconst registry = {\n  PT: (series) => analyzePT(series).peaks.data,\n  PTPlus: (series) => analyzePT(series).peaksPlusPlus.data,\n  KHO: (series) => analyzeECGKHO(series).peaks.data,\n  ATN: (series) => analyzeATN(series).peaks.data,\n  CMD1: (series) => analyzeCMD(series, 1).data,\n  CMD2: (series) => analyzeCMD(series, 2).data,\n  GPT: (series) => detectRPeaks([{ data: preprocessSignal(series).biggestPreprocess.bp }]).data,\n};\n\naddEventListener('message', (e) => {\n  const { name, input } = e.data;\n  try {\n    const fn = registry[name];\n    if (!fn) throw new Error(`Unknown task name: ${name}`);\n    const result = fn(input);\n    postMessage({ ok: true, name, result });\n  } catch (err) {\n    postMessage({ ok: false, name, error: String(err), stack: err?.stack });\n  }\n});\n"],"names":["getTopValue","data","condition","max","Infinity","min","i","length","BANDS","clamp","x","lo","hi","Math","sinc","sin","PI","firLowpass","wc","M","w","L","Array","n","cos","hamming","h","k","firBandpass","f1","f2","fs","arguments","undefined","w1","w2","h2","h1","runFilterBank","signal","filtered","map","_ref","band","_ref2","y","m","pad","floor","acc","xi","convSame","decimated","out","ceil","j","downsample","analyzeATN","signalTime","obj","signalData","signalTransform","item","filteredSignal1","filteredSignal2","filteredSignal3","filteredSignal4","newPeaks","filteredSignal","threshold1","eps","a","b","v","o","push","history","ynm1","median","arr","s","sort","mad","abs","bandEnergyAt","w3","w4","positiveMaximaIndex","raw","best","bestI","aa","bb","slopeAround","rad","round","c","w1i","w2i","w3i","w4i","Number","isNaN","mean","from","_","s1","s2","s3","s4","y2","slice","y3","y4","y5","Ld","P1","P2","P4","a2","a3","a4","a5","neighborAvg","P","FL1","FL2","FL4","allEvents","idx","findPeaks","fineRad","EventsL1","p","base","meanL1","reduce","NL","SL","detectionBlock","mwi","Events","NL0","SL0","thr","sumSig","sumNoi","Signal","Noise","VDs","Class","Ds","B1","B2","ClassL3","C1","C2","SignalL3","NoiseL3","SL4","NL4","SignalL4","NoiseL4","SignalL5","periods","meanperiod","movingAverage","fill","peaks0","eIdx","eBest","ev","posI","peaks","Set","refr","refractoryMs","keep","filter","dsVal","weakDs","bins","total","mT","bestT","bestVar","t","w0","m0","m1","vb","otsuThreshold","ampsStrong","medAmpStrong","slopesStrong","slopeCut","localAmpBaseline","pos","mid","to","neigh","extra","dsOk","baseAmp","ampOk","slopeOk","nearest","d","concat","newDetectRPeaksATN","series","includes","filtfiltFIR","nPad","xPad","N","Float64Array","_x","_x2","reflectPad","y1","convFIR","reverse","subarray","detectECGPeaksStages","opts","firTaps","mwiSec","refractorySec","refineSec","indices","stages","bpArr","dArr","sArr","mArr","thArr","NaN","taps","win","f","sum","designFIRBandpass","yBP","set","W","dBuf","dpos","dCount","mwiBuf","mpos","msum","mCount","mRingLen","mRing","SPKI","NPKI","TH1","initialized","initMax","initCount","initNeeded","lastR","rrHist","mPrev2","mPrev1","mCurr","mValid","i1","i3","i4","mShow","idxM","meanRR","missRR","start","end","accept","bandpass","differentiated","squared","mVal","_opts$refineSec","delay","refine","guess","R","bestIdx","bestVal","denom","delta","cand","shift","detectQRS_JS","inputSignal","X","variance","medianOf","reflectIndex","movingMedianMirror","sig","half","cubicSplineEval","xk","yk","xs","x0","x1","y0","dy","alpha","l","mu","z","ii","dx","findExtrema","maxima","minima","unshift","emd","_maxImfs","_maxSiftings","imfs","residue","tol","sqrt","ex","it","ex2","upper","lower","hNext","exA","gaussianRandomArray","u1","random","u2","mag","log","z0","z1","X1","Xmean","maxabs","yy_pre","idxs","thrIdx","yy","modes","noiseStd","ensembleSize","runs","maxCount","e","noise","noisy","avg","r","ensembleEMD","K","y_signal","y_pos","posVals","peakObjs","minH","minD","minProm","promWin","val","kept","some","leftMin","rightMin","prom","findPositivePeaks","minPeakDistanceSec","locs","analyzeCMD","type","transformPeaks","result","tempResult","MIN_GAP","Float32Array","newF32","countZeroCrossings","prev","countExtrema","c0","buildEnvelope","outEnv","firstIdx","firstVal","i2","v1","v2","slope","lastIdx","lastVal","siftOnce","upperEnv","lowerEnv","meanEnv","maxIdx","minIdx","sdChange","curr","num","extractIMF","work","okSift","sd","ext","zc","isIMFshape","imf","newResidue","useStart","useEndExclusive","used","candIdx","candAmp","maxAmp","tmp","u","med","fIdx","fAmp","keepIdx","keepAmp","curIdx","curAmp","amp","k2","center","bestV","i0","dedup","detectRPeaks","toFloat32","ensureOdd","designHPBiquad","fc","Q","cosw0","b0","b1","b2","a0","a1","designButterworthHP_SOS","order","SQRT2","biquadCascade","sos","z2","xn","yn","filtfiltBiquad","designLPBiquad","mapAbsMinus","quantile","q","minOf","maxOf","frac","vK","selectKthInPlace","left","right","swap","pivot","makeSampleView","maxSample","stride","centeredMovingAverage","xp","ps","msToSamples","ms","rrMedian","rrBuf","rrBufPush","rr","preSlopeMag","preW","maxd","sortUniqueInt32","last","Int32Array","absMinus","argmaxInRange","bi","bv","snapToHillZeroCross","bestD","dL","dR","D","positiveProminence","seg","leftMed","rightMed","sidedSlopeCheck","postW","up","nL","dj","dn","nR","centeredSlidingMedian","nOut","Heap","cmp","this","prototype","size","peek","pop","top","delayed","Map","loSize","hiSize","prune","heap","cnt","get","delete","rebalance","add","remove","outIdx","slidingMedianCausal","bandpassQRS","ecg","hp","lp","orderHP","orderLP","sosHP","sosLP","designButterworthLP_SOS","robustNormalize","returnStats","stats","centerMode","scaleMode","scale","sample","stdDev","q1","q3","p95","p95abs","invS","clipNsigma","isFinite","C","ptFeature","xIn","deriv","diff1Central","diff5Symmetric","mwiMs","refineOnRaw","xRaw","idxIn","toInt32Array","HALF","winMs","MICRO","microWin","PRE","POST","MADW","ZC_WIN","ref","xBandpass","rough","tkeoFeature","next","xBaseRemoved","method","returnBaseline","baseline","win1","win1Ms","win2","win2Ms","base1","base2","hpHz","removeBaseline","xBP","xNR","normalize","wPT","pt","sTKEO","tkeo","candPT","wIn","refrSamp","initLen","initWinSec","thrAlpha","sbFactor","searchBackFactor","initSeg","THR","peakVals","subMaxIdx","subMaxVal","pIdx","pVal","rrMed","adaptivePeakPick","pick","candTK","returnFeature","feature","tkeoCandidatePeaks","Object","assign","tkeoPick","fusedMeta","lists","mergeTolMs","feats","isArray","xRef","all","score","src","returnMeta","meta","group","cur","flushGroup","g","sources","votes","fuseCandidates","fuse","rIdxIn","feat","minRR","minRRMs","tWin","tSuppressMs","preSlopeMs","tSlopeFrac","sbF","sbK","sPrev","ins","rrPostprocess","rClean","xRefIn","Wloc","Lpre","Rpost","Wder","Wmad","smoothDiff","isLocalMax","Ll","Rr","upPos","upTot","dnNeg","dnTot","Lm2","Rm2","promThr","keepHillsOnlyV2","zeros","pix","designBandpassForECG","A","nyq","wl","wh","window","_arguments$","Wl","Wh","ideal","fir1Bandpass","processSignal","filter_signal","fullConv","A_even_order","removeGroupDelayAfterConv","kmin","kmax","conv","nonlinear","sign","new_signal","preprocessKHO","MWMFiltered","L1","L2","flen1","flen2","ch","movingMedian","x2","mwmFilter","analyzeECGKHO","transformSignal","preFiltered","finalPeaks","threshold","positive","negative","locs_pos","locs_neg","difference_pos","difference_neg","ind_pos","forEach","diff","ind_neg","upper_limit","lower_limit","event","new_event","dist_event","new_new_event","new_dist_event","new_new_event_filtered","filtered_events","final_event","abs_max","abs_min","segment","RR_amp","abs_nonlinear","RR_location","findIndex","value","RR_amp_values","RR_time","minDistance","getFinalResult","nonlinearizedSignal","HFSignal","zeroCrossingSignal","toF64","medianFilter","windowSamples","xin","samples","oddWindowSize","buf","stage1_preprocess","hpf","dt","RC","highPassOnePole","corrected","win1_ms","win2_ms","doubleMedianBaselineSubtract","detrended","biquadFilter","coeffs","rbjLowpassCoeffs","biquadCascadeForward","sections","filtfiltCascade","padSeconds","padded","rbjHighpassCoeffs","BUTTER_QS_4","hpSections","lpSections","biggestPreprocessFilter","bp","hpOrder","lpOrder","zeroPhase","sec","bandpass5to18","savGolayFilter","mode","F","nl","nr","transpose","T","matMul","B","aR","aC","bC","aik","invertMatrix","I","col","piv","pivotVal","factor","factorial","sgDesign","designMatrixCentered","AT","ATA","pinv","G","sgDesignAsym","designMatrixAsym","GA","convAlign","kernel","centerIndex","getColumn","row","pow","sgApply","savGolSmooth","preprocessSignal","transformData","mvmFiltered","medianOfRange","lowPassFilteredML","yn1","yn2","impulseResponse13","Nx","Nh","Ny","lpFilterMatlab","highPassFilteredML","impulseResponse","hpFilterMatlab","notchFilteredML","Fo","nfact","lfilter","pre","post","atStart","filtfiltIIR","nb","na","notch50HzCombFILT","savGolayFilteredMLC","biggestPreprocess","maxVal","minVal","correctVal","maxAbs","pyRound","convolveFull","filtfilt","padlen","edge","pl","smoother","mirror","TypeError","Error","flattop","sumw","argmaxRange","im","vm","dedupPeaks","minDist","isUphillPeak","localProminence","side","minLeft","minRight","designFIRLowpass","numTaps","norm","BUTTER_200_LOW_12HZ","BUTTER_200_HIGH_5HZ","rpeak_detection_200_pos","ecg0","ecg_l","ecg_h","m2","b_diff","ecg_d","md","ecg_s","winLen","ecg_m","thres","min_dist","ymin","absThres","taken","bad","peakIndexes","pks","LLp","qrs_c","qrs_i","qrs_i_raw","twoSec","THR_SIG","THR_NOISE","SIG_LEV","NOISE_LEV","THR_SIG1","THR_NOISE1","SIG_LEV1","NOISE_LEV1","Beat_C","Beat_C1","mean_RR","m_selected_RR","Check_Flag","skip","locH","x_i_abs","y_i","diffs","test_m","accepted","acceptQRS","locIdx","amp_m","absIdx_h","amp_h","seg1","Slope1","seg2","Slope2","sinceLast","okShortRR","findLastIndex","rrs","RRexp","added","gap","sM","eM","candM","ampM","ampH","Pan_Tompkins_Plus_Plus_Plus","get_name","rpeak_detection","ecg400","r200","downsample400to200","refined","i200","loc","DEDUP_SEC","analyzePT","lowPassSignal","lowPassFilterSignal","getLowPassFilterSignal","highPassSignal","highPassFilterSignal","getHighPassFilterSignal","differentiatedSignal","getDifferentiatedSignal","squaredSignal","getSquaredSignal","movingWindowSignal","movedWindowSignal","windowSize","getMovingWindowSignal","dataSignal","maxValue","binary","R_locs","filteredRLocs","lastAccepted","getRPeaks","peaksPlusPlus","registry","PT","PTPlus","KHO","ATN","CMD1","CMD2","GPT","addEventListener","name","input","fn","postMessage","ok","err","error","String","stack"],"sourceRoot":""}